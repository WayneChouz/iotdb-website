<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> </title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content=" ">
    <meta name="Description" content="Apache IoTDB: Time Series Database for IoT">
    <meta name="Keywords" content="TSDB, time series, time series database, IoTDB, IoT database, IoT data management,时序数据库, 时间序列管理, IoTDB, 物联网数据库, 实时数据库, 物联网数据管理, 物联网数据">
    <meta name="baidu-site-verification" content="wfKETzB3OT">
    <meta name="google-site-verification" content="mZWAoRY0yj_HAr-s47zHCGHzx5Ju-RVm5wDbPnwQYFo">
    
    <link rel="preload" href="/assets/css/0.styles.53b4846f.css" as="style"><link rel="preload" href="/assets/js/app.7e8d0fee.js" as="script"><link rel="preload" href="/assets/js/3.187083c5.js" as="script"><link rel="preload" href="/assets/js/38.0d46b6a1.js" as="script"><link rel="prefetch" href="/assets/js/10.1c603655.js"><link rel="prefetch" href="/assets/js/100.dab6e75e.js"><link rel="prefetch" href="/assets/js/101.d7637f69.js"><link rel="prefetch" href="/assets/js/102.4b31669b.js"><link rel="prefetch" href="/assets/js/103.df8a636e.js"><link rel="prefetch" href="/assets/js/104.f8b25f0c.js"><link rel="prefetch" href="/assets/js/105.a836abb5.js"><link rel="prefetch" href="/assets/js/106.62b870a3.js"><link rel="prefetch" href="/assets/js/107.f0bd827e.js"><link rel="prefetch" href="/assets/js/108.c6eec2f2.js"><link rel="prefetch" href="/assets/js/109.7a339e3c.js"><link rel="prefetch" href="/assets/js/11.cc3f9ffd.js"><link rel="prefetch" href="/assets/js/110.a0f4b386.js"><link rel="prefetch" href="/assets/js/111.002e30f1.js"><link rel="prefetch" href="/assets/js/112.e124c29e.js"><link rel="prefetch" href="/assets/js/113.fab59901.js"><link rel="prefetch" href="/assets/js/114.e5335893.js"><link rel="prefetch" href="/assets/js/115.be4e1fe4.js"><link rel="prefetch" href="/assets/js/116.c0dd7d85.js"><link rel="prefetch" href="/assets/js/117.81bb9bd1.js"><link rel="prefetch" href="/assets/js/118.eab6d5d4.js"><link rel="prefetch" href="/assets/js/119.8b54e7ae.js"><link rel="prefetch" href="/assets/js/12.b8a206cd.js"><link rel="prefetch" href="/assets/js/120.463b32a1.js"><link rel="prefetch" href="/assets/js/121.2ff179d1.js"><link rel="prefetch" href="/assets/js/122.4c390b2a.js"><link rel="prefetch" href="/assets/js/123.cd83f28a.js"><link rel="prefetch" href="/assets/js/124.113d9fba.js"><link rel="prefetch" href="/assets/js/125.c47a236e.js"><link rel="prefetch" href="/assets/js/126.cb13b873.js"><link rel="prefetch" href="/assets/js/127.b873082f.js"><link rel="prefetch" href="/assets/js/128.721d8520.js"><link rel="prefetch" href="/assets/js/129.0705d848.js"><link rel="prefetch" href="/assets/js/13.5c4247f9.js"><link rel="prefetch" href="/assets/js/130.b08ee2d9.js"><link rel="prefetch" href="/assets/js/131.eb1d2143.js"><link rel="prefetch" href="/assets/js/132.7fc7790c.js"><link rel="prefetch" href="/assets/js/133.87ec58e5.js"><link rel="prefetch" href="/assets/js/134.5b4d2b78.js"><link rel="prefetch" href="/assets/js/135.4b41db8a.js"><link rel="prefetch" href="/assets/js/136.85219757.js"><link rel="prefetch" href="/assets/js/137.3c2decde.js"><link rel="prefetch" href="/assets/js/138.648415d4.js"><link rel="prefetch" href="/assets/js/139.033ce790.js"><link rel="prefetch" href="/assets/js/14.14c0a23e.js"><link rel="prefetch" href="/assets/js/140.6bc7e5cc.js"><link rel="prefetch" href="/assets/js/141.317d3508.js"><link rel="prefetch" href="/assets/js/142.305de246.js"><link rel="prefetch" href="/assets/js/143.9807221d.js"><link rel="prefetch" href="/assets/js/144.1b7ea921.js"><link rel="prefetch" href="/assets/js/145.58d5d173.js"><link rel="prefetch" href="/assets/js/146.2f1ee190.js"><link rel="prefetch" href="/assets/js/147.8de4b5d5.js"><link rel="prefetch" href="/assets/js/148.29aae04a.js"><link rel="prefetch" href="/assets/js/149.6942d809.js"><link rel="prefetch" href="/assets/js/15.42f29f2e.js"><link rel="prefetch" href="/assets/js/150.833ba50d.js"><link rel="prefetch" href="/assets/js/151.fe221764.js"><link rel="prefetch" href="/assets/js/152.8c1abcbd.js"><link rel="prefetch" href="/assets/js/153.36f1af7a.js"><link rel="prefetch" href="/assets/js/154.d79829b5.js"><link rel="prefetch" href="/assets/js/155.f434a865.js"><link rel="prefetch" href="/assets/js/156.d9791f95.js"><link rel="prefetch" href="/assets/js/157.81dfde33.js"><link rel="prefetch" href="/assets/js/158.a4eccc5e.js"><link rel="prefetch" href="/assets/js/159.e18992b6.js"><link rel="prefetch" href="/assets/js/16.2114635f.js"><link rel="prefetch" href="/assets/js/160.2d69e069.js"><link rel="prefetch" href="/assets/js/161.2b986cf2.js"><link rel="prefetch" href="/assets/js/162.a2148c19.js"><link rel="prefetch" href="/assets/js/163.4bd0b3f4.js"><link rel="prefetch" href="/assets/js/164.e9ba602d.js"><link rel="prefetch" href="/assets/js/165.6d0a70b8.js"><link rel="prefetch" href="/assets/js/166.92f2a067.js"><link rel="prefetch" href="/assets/js/167.fadc6ed7.js"><link rel="prefetch" href="/assets/js/168.be19af7c.js"><link rel="prefetch" href="/assets/js/169.cbaae9e6.js"><link rel="prefetch" href="/assets/js/17.24e8b4f8.js"><link rel="prefetch" href="/assets/js/170.e2c608ba.js"><link rel="prefetch" href="/assets/js/171.0ada7198.js"><link rel="prefetch" href="/assets/js/172.26a85bbd.js"><link rel="prefetch" href="/assets/js/173.2eb7c3bb.js"><link rel="prefetch" href="/assets/js/174.7a120de2.js"><link rel="prefetch" href="/assets/js/175.a93318f6.js"><link rel="prefetch" href="/assets/js/176.6ad35d9c.js"><link rel="prefetch" href="/assets/js/177.30d70860.js"><link rel="prefetch" href="/assets/js/178.2bfe4516.js"><link rel="prefetch" href="/assets/js/179.229d373e.js"><link rel="prefetch" href="/assets/js/18.df811665.js"><link rel="prefetch" href="/assets/js/180.2a5566b7.js"><link rel="prefetch" href="/assets/js/181.8033dea4.js"><link rel="prefetch" href="/assets/js/182.3d4f481d.js"><link rel="prefetch" href="/assets/js/183.071b717c.js"><link rel="prefetch" href="/assets/js/184.5db69127.js"><link rel="prefetch" href="/assets/js/185.64ed7eb9.js"><link rel="prefetch" href="/assets/js/186.a2c59ddc.js"><link rel="prefetch" href="/assets/js/187.935e8efe.js"><link rel="prefetch" href="/assets/js/188.0b366a8d.js"><link rel="prefetch" href="/assets/js/189.7e07e916.js"><link rel="prefetch" href="/assets/js/19.4a1a4263.js"><link rel="prefetch" href="/assets/js/190.02ee3914.js"><link rel="prefetch" href="/assets/js/191.993b3775.js"><link rel="prefetch" href="/assets/js/192.571715fe.js"><link rel="prefetch" href="/assets/js/193.5b7aac46.js"><link rel="prefetch" href="/assets/js/194.3ef7659f.js"><link rel="prefetch" href="/assets/js/195.1741a0c1.js"><link rel="prefetch" href="/assets/js/196.4f334405.js"><link rel="prefetch" href="/assets/js/197.9aeeecbf.js"><link rel="prefetch" href="/assets/js/198.3f6c379f.js"><link rel="prefetch" href="/assets/js/199.5a3d16de.js"><link rel="prefetch" href="/assets/js/20.1b6deffc.js"><link rel="prefetch" href="/assets/js/200.1d2045a3.js"><link rel="prefetch" href="/assets/js/201.55db87cf.js"><link rel="prefetch" href="/assets/js/202.f42da840.js"><link rel="prefetch" href="/assets/js/203.dcc0df47.js"><link rel="prefetch" href="/assets/js/204.1ede630a.js"><link rel="prefetch" href="/assets/js/205.93704d14.js"><link rel="prefetch" href="/assets/js/206.f002fb3f.js"><link rel="prefetch" href="/assets/js/207.154d90f0.js"><link rel="prefetch" href="/assets/js/208.a0da203c.js"><link rel="prefetch" href="/assets/js/209.e0324575.js"><link rel="prefetch" href="/assets/js/21.28cc5d92.js"><link rel="prefetch" href="/assets/js/210.d703707b.js"><link rel="prefetch" href="/assets/js/211.a37a3003.js"><link rel="prefetch" href="/assets/js/212.1cc86b47.js"><link rel="prefetch" href="/assets/js/213.6e7a321e.js"><link rel="prefetch" href="/assets/js/214.582bf30f.js"><link rel="prefetch" href="/assets/js/215.a84ee040.js"><link rel="prefetch" href="/assets/js/216.372ca744.js"><link rel="prefetch" href="/assets/js/217.5fd5f8d2.js"><link rel="prefetch" href="/assets/js/218.b83d58fb.js"><link rel="prefetch" href="/assets/js/219.0ac1318f.js"><link rel="prefetch" href="/assets/js/22.75220083.js"><link rel="prefetch" href="/assets/js/220.4d78c5f4.js"><link rel="prefetch" href="/assets/js/221.cd2acc28.js"><link rel="prefetch" href="/assets/js/222.aaf5340a.js"><link rel="prefetch" href="/assets/js/223.7fd4a659.js"><link rel="prefetch" href="/assets/js/224.ba03cf4f.js"><link rel="prefetch" href="/assets/js/225.99e825d5.js"><link rel="prefetch" href="/assets/js/226.89569d80.js"><link rel="prefetch" href="/assets/js/227.a29c3a08.js"><link rel="prefetch" href="/assets/js/228.6fc8489e.js"><link rel="prefetch" href="/assets/js/229.918432b1.js"><link rel="prefetch" href="/assets/js/23.d200be4a.js"><link rel="prefetch" href="/assets/js/230.b834d921.js"><link rel="prefetch" href="/assets/js/231.12ec6410.js"><link rel="prefetch" href="/assets/js/232.1f1f141f.js"><link rel="prefetch" href="/assets/js/233.a260e8a0.js"><link rel="prefetch" href="/assets/js/234.7185ad8d.js"><link rel="prefetch" href="/assets/js/235.54ca025d.js"><link rel="prefetch" href="/assets/js/236.079080e9.js"><link rel="prefetch" href="/assets/js/237.6b434c25.js"><link rel="prefetch" href="/assets/js/238.9d98999f.js"><link rel="prefetch" href="/assets/js/239.9dbe10a0.js"><link rel="prefetch" href="/assets/js/24.bd10c191.js"><link rel="prefetch" href="/assets/js/240.8c591dd3.js"><link rel="prefetch" href="/assets/js/241.88e26f0b.js"><link rel="prefetch" href="/assets/js/242.2bfda616.js"><link rel="prefetch" href="/assets/js/243.c9f0ff67.js"><link rel="prefetch" href="/assets/js/244.78f7b606.js"><link rel="prefetch" href="/assets/js/245.45b1933a.js"><link rel="prefetch" href="/assets/js/246.a02c461b.js"><link rel="prefetch" href="/assets/js/247.76f0573f.js"><link rel="prefetch" href="/assets/js/248.6ae8c5c7.js"><link rel="prefetch" href="/assets/js/249.ee32bf93.js"><link rel="prefetch" href="/assets/js/25.cf534808.js"><link rel="prefetch" href="/assets/js/250.38d40712.js"><link rel="prefetch" href="/assets/js/251.4f0b12fb.js"><link rel="prefetch" href="/assets/js/252.54e44c81.js"><link rel="prefetch" href="/assets/js/253.f4a0f771.js"><link rel="prefetch" href="/assets/js/254.55bb81a5.js"><link rel="prefetch" href="/assets/js/255.b03e2837.js"><link rel="prefetch" href="/assets/js/256.022ccb19.js"><link rel="prefetch" href="/assets/js/257.fba96473.js"><link rel="prefetch" href="/assets/js/258.b627d685.js"><link rel="prefetch" href="/assets/js/259.28e21856.js"><link rel="prefetch" href="/assets/js/26.5c268ee4.js"><link rel="prefetch" href="/assets/js/260.f320a58f.js"><link rel="prefetch" href="/assets/js/261.442bf05d.js"><link rel="prefetch" href="/assets/js/262.a012b4d6.js"><link rel="prefetch" href="/assets/js/263.232b0668.js"><link rel="prefetch" href="/assets/js/264.9f3b9ebe.js"><link rel="prefetch" href="/assets/js/265.1c544d63.js"><link rel="prefetch" href="/assets/js/266.6a90ae42.js"><link rel="prefetch" href="/assets/js/267.5d57043b.js"><link rel="prefetch" href="/assets/js/268.a0efd2ca.js"><link rel="prefetch" href="/assets/js/269.fb357b46.js"><link rel="prefetch" href="/assets/js/27.c523847e.js"><link rel="prefetch" href="/assets/js/270.f78d8594.js"><link rel="prefetch" href="/assets/js/271.9d7ac7ee.js"><link rel="prefetch" href="/assets/js/272.4c66855d.js"><link rel="prefetch" href="/assets/js/273.48679754.js"><link rel="prefetch" href="/assets/js/274.2ba1afeb.js"><link rel="prefetch" href="/assets/js/275.ddc36b82.js"><link rel="prefetch" href="/assets/js/276.da9d42ba.js"><link rel="prefetch" href="/assets/js/277.8de6668b.js"><link rel="prefetch" href="/assets/js/278.4f40272a.js"><link rel="prefetch" href="/assets/js/279.1e7e051f.js"><link rel="prefetch" href="/assets/js/28.fd9ad585.js"><link rel="prefetch" href="/assets/js/280.7963e7a1.js"><link rel="prefetch" href="/assets/js/281.aa162023.js"><link rel="prefetch" href="/assets/js/282.7c154873.js"><link rel="prefetch" href="/assets/js/283.fce06b4b.js"><link rel="prefetch" href="/assets/js/284.85ba0950.js"><link rel="prefetch" href="/assets/js/285.cb1d1847.js"><link rel="prefetch" href="/assets/js/286.d22e9a94.js"><link rel="prefetch" href="/assets/js/287.1c447fe2.js"><link rel="prefetch" href="/assets/js/29.ae01a76e.js"><link rel="prefetch" href="/assets/js/30.5d12445f.js"><link rel="prefetch" href="/assets/js/31.40d895e0.js"><link rel="prefetch" href="/assets/js/32.d804069c.js"><link rel="prefetch" href="/assets/js/33.986d8626.js"><link rel="prefetch" href="/assets/js/34.6d4f343d.js"><link rel="prefetch" href="/assets/js/35.f3fe9c5b.js"><link rel="prefetch" href="/assets/js/36.e595add3.js"><link rel="prefetch" href="/assets/js/37.0af0dd97.js"><link rel="prefetch" href="/assets/js/39.54cd0bc6.js"><link rel="prefetch" href="/assets/js/4.632d617f.js"><link rel="prefetch" href="/assets/js/40.14f3866f.js"><link rel="prefetch" href="/assets/js/41.9b73489b.js"><link rel="prefetch" href="/assets/js/42.b2dbd5e2.js"><link rel="prefetch" href="/assets/js/43.a2228318.js"><link rel="prefetch" href="/assets/js/44.9b669393.js"><link rel="prefetch" href="/assets/js/45.61f31cb8.js"><link rel="prefetch" href="/assets/js/46.acf45d98.js"><link rel="prefetch" href="/assets/js/47.9fe02aa4.js"><link rel="prefetch" href="/assets/js/48.fb146ee2.js"><link rel="prefetch" href="/assets/js/49.04fad2e1.js"><link rel="prefetch" href="/assets/js/5.cfee286e.js"><link rel="prefetch" href="/assets/js/50.9b60306c.js"><link rel="prefetch" href="/assets/js/51.26406d50.js"><link rel="prefetch" href="/assets/js/52.072a62da.js"><link rel="prefetch" href="/assets/js/53.a47fdb0e.js"><link rel="prefetch" href="/assets/js/54.cc809413.js"><link rel="prefetch" href="/assets/js/55.ba79f41b.js"><link rel="prefetch" href="/assets/js/56.e18205ec.js"><link rel="prefetch" href="/assets/js/57.6387c8cf.js"><link rel="prefetch" href="/assets/js/58.6126efe9.js"><link rel="prefetch" href="/assets/js/59.3ee14771.js"><link rel="prefetch" href="/assets/js/6.32d5e3c9.js"><link rel="prefetch" href="/assets/js/60.e131c84c.js"><link rel="prefetch" href="/assets/js/61.ac70d0fd.js"><link rel="prefetch" href="/assets/js/62.4d78c883.js"><link rel="prefetch" href="/assets/js/63.f1673ed5.js"><link rel="prefetch" href="/assets/js/64.75c1d960.js"><link rel="prefetch" href="/assets/js/65.17f6f270.js"><link rel="prefetch" href="/assets/js/66.c41c79ac.js"><link rel="prefetch" href="/assets/js/67.d436b4bf.js"><link rel="prefetch" href="/assets/js/68.934a6989.js"><link rel="prefetch" href="/assets/js/69.8d7e0582.js"><link rel="prefetch" href="/assets/js/7.09a0a58f.js"><link rel="prefetch" href="/assets/js/70.5478ce89.js"><link rel="prefetch" href="/assets/js/71.47452bed.js"><link rel="prefetch" href="/assets/js/72.d8021923.js"><link rel="prefetch" href="/assets/js/73.ce988899.js"><link rel="prefetch" href="/assets/js/74.eda7e6a9.js"><link rel="prefetch" href="/assets/js/75.c4b54daa.js"><link rel="prefetch" href="/assets/js/76.def7577f.js"><link rel="prefetch" href="/assets/js/77.136b5ce4.js"><link rel="prefetch" href="/assets/js/78.16b0aac6.js"><link rel="prefetch" href="/assets/js/79.d7f87844.js"><link rel="prefetch" href="/assets/js/8.06b4cfd0.js"><link rel="prefetch" href="/assets/js/80.29285523.js"><link rel="prefetch" href="/assets/js/81.ce3f2478.js"><link rel="prefetch" href="/assets/js/82.9d42d270.js"><link rel="prefetch" href="/assets/js/83.c86347a5.js"><link rel="prefetch" href="/assets/js/84.b080e73d.js"><link rel="prefetch" href="/assets/js/85.7d901be3.js"><link rel="prefetch" href="/assets/js/86.574fa4c1.js"><link rel="prefetch" href="/assets/js/87.528e9a78.js"><link rel="prefetch" href="/assets/js/88.87ca45c1.js"><link rel="prefetch" href="/assets/js/89.2e9244aa.js"><link rel="prefetch" href="/assets/js/9.58340067.js"><link rel="prefetch" href="/assets/js/90.a8c05f0c.js"><link rel="prefetch" href="/assets/js/91.ad908c88.js"><link rel="prefetch" href="/assets/js/92.9e2883c0.js"><link rel="prefetch" href="/assets/js/93.07896987.js"><link rel="prefetch" href="/assets/js/94.695b0264.js"><link rel="prefetch" href="/assets/js/95.e35bd0f6.js"><link rel="prefetch" href="/assets/js/96.907c0900.js"><link rel="prefetch" href="/assets/js/97.7a7716d5.js"><link rel="prefetch" href="/assets/js/98.89c3fc09.js"><link rel="prefetch" href="/assets/js/99.b4ae9390.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.27982d69.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53b4846f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt=" " class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Document</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/UserGuide/Master/Get Started/QuickStart.html" class="nav-link">In progress</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.10.x/Get Started/QuickStart.html" class="nav-link">V0.10.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.9.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.9.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.8.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.8.x</a></li></ul></div></div><div class="nav-item"><a href="/SystemDesign/Architecture/Architecture.html" class="nav-link">System design</a></div><div class="nav-item"><a href="/Download/" class="nav-link">Download</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cwiki.apache.org/confluence/display/iotdb" class="nav-link external">
  Wiki
  <!----></a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Project Committers.html" class="nav-link">People</a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Powered By.html" class="nav-link">Powered By</a></li><li class="dropdown-item"><!----> <a href="/Community/Materials.html" class="nav-link">Resources</a></li><li class="dropdown-item"><!----> <a href="/Community/Feedback.html" class="nav-link">Feedback</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development/VoteRelease.html" class="nav-link">How to vote</a></li><li class="dropdown-item"><!----> <a href="/Development/HowToCommit.html" class="nav-link">How to Commit</a></li><li class="dropdown-item"><!----> <a href="/Development/Committer.html" class="nav-link">Become a Committer</a></li><li class="dropdown-item"><!----> <a href="/Development/ContributeGuide.html" class="nav-link">ContributeGuide</a></li><li class="dropdown-item"><!----> <a href="/Development/format-changelist.html" class="nav-link">Changelist of TsFile</a></li><li class="dropdown-item"><!----> <a href="/Development/rpc-changelist.html" class="nav-link">Changelist of RPC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Index.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/Blog/Release0_93.html" class="nav-link">Some Notes on Release 0.9.3 and upcoming 0.10.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ASF</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.apache.org/" class="nav-link external">
  Foundation
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/licenses/" class="nav-link external">
  License
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/security/" class="nav-link external">
  Security
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/sponsorship.html" class="nav-link external">
  Sponsorship
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/thanks.html" class="nav-link external">
  Thanks
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/events/current-event" class="nav-link external">
  Current Events
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SystemDesign/DataQuery/RawDataQuery.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/SystemDesign/DataQuery/RawDataQuery.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/apache/iotdb.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Document</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/UserGuide/Master/Get Started/QuickStart.html" class="nav-link">In progress</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.10.x/Get Started/QuickStart.html" class="nav-link">V0.10.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.9.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.9.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.8.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.8.x</a></li></ul></div></div><div class="nav-item"><a href="/SystemDesign/Architecture/Architecture.html" class="nav-link">System design</a></div><div class="nav-item"><a href="/Download/" class="nav-link">Download</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cwiki.apache.org/confluence/display/iotdb" class="nav-link external">
  Wiki
  <!----></a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Project Committers.html" class="nav-link">People</a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Powered By.html" class="nav-link">Powered By</a></li><li class="dropdown-item"><!----> <a href="/Community/Materials.html" class="nav-link">Resources</a></li><li class="dropdown-item"><!----> <a href="/Community/Feedback.html" class="nav-link">Feedback</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development/VoteRelease.html" class="nav-link">How to vote</a></li><li class="dropdown-item"><!----> <a href="/Development/HowToCommit.html" class="nav-link">How to Commit</a></li><li class="dropdown-item"><!----> <a href="/Development/Committer.html" class="nav-link">Become a Committer</a></li><li class="dropdown-item"><!----> <a href="/Development/ContributeGuide.html" class="nav-link">ContributeGuide</a></li><li class="dropdown-item"><!----> <a href="/Development/format-changelist.html" class="nav-link">Changelist of TsFile</a></li><li class="dropdown-item"><!----> <a href="/Development/rpc-changelist.html" class="nav-link">Changelist of RPC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Index.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/Blog/Release0_93.html" class="nav-link">Some Notes on Release 0.9.3 and upcoming 0.10.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ASF</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.apache.org/" class="nav-link external">
  Foundation
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/licenses/" class="nav-link external">
  License
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/security/" class="nav-link external">
  Security
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/sponsorship.html" class="nav-link external">
  Sponsorship
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/thanks.html" class="nav-link external">
  Thanks
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/events/current-event" class="nav-link external">
  Current Events
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SystemDesign/DataQuery/RawDataQuery.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/SystemDesign/DataQuery/RawDataQuery.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/apache/iotdb.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>System design</span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TsFile</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>QueryEngine</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SchemaManager</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>StorageEngine</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DataQuery</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/SystemDesign/DataQuery/DataQuery.html" class="sidebar-link">DataQuery</a></li><li><a href="/SystemDesign/DataQuery/QueryFundamentals.html" class="sidebar-link">QueryFundamentals</a></li><li><a href="/SystemDesign/DataQuery/SeriesReader.html" class="sidebar-link">SeriesReader</a></li><li><a href="/SystemDesign/DataQuery/RawDataQuery.html" aria-current="page" class="active sidebar-link">RawDataQuery</a></li><li><a href="/SystemDesign/DataQuery/AggregationQuery.html" class="sidebar-link">AggregationQuery</a></li><li><a href="/SystemDesign/DataQuery/GroupByQuery.html" class="sidebar-link">GroupByQuery</a></li><li><a href="/SystemDesign/DataQuery/LastQuery.html" class="sidebar-link">LastQuery</a></li><li><a href="/SystemDesign/DataQuery/AlignByDeviceQuery.html" class="sidebar-link">AlignByDeviceQuery</a></li><li><a href="/SystemDesign/DataQuery/FillFunction.html" class="sidebar-link">FillFunction</a></li><li><a href="/SystemDesign/DataQuery/GroupByFillQuery.html" class="sidebar-link">GroupByFillQuery</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Connector</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="raw-data-query"><a href="#raw-data-query" class="header-anchor">#</a> Raw data query</h1> <h2 id="design-principle"><a href="#design-principle" class="header-anchor">#</a> Design principle</h2> <p>The raw data query can be divided into two categories based on whether it contains value filtering conditions.  When no value filter is included, it can be divided into two categories based on the result set structure.</p> <ul><li>No value filter (no filter or only time filter)
<ul><li>Result set aligned by timestamp (default raw data query)</li> <li>The result set is not aligned with the timestamp (disable align)</li></ul></li> <li>Include value filters
<ul><li>Result set aligned by timestamp</li></ul></li></ul> <p>The above three queries correspond to three different DataSets in the code and encapsulate the execution logic of these three queries.</p> <h2 id="no-value-filter-result-set-aligned-by-timestamp"><a href="#no-value-filter-result-set-aligned-by-timestamp" class="header-anchor">#</a> No value filter + result set aligned by timestamp</h2> <h3 id="org-apache-iotdb-db-query-dataset-rawquerydatasetwithoutvaluefilter"><a href="#org-apache-iotdb-db-query-dataset-rawquerydatasetwithoutvaluefilter" class="header-anchor">#</a> org.apache.iotdb.db.query.dataset.RawQueryDataSetWithoutValueFilter</h3> <p><code>RawQueryDataSetWithoutValueFilter</code> implements query logic that has no value filtering conditions and needs to be aligned according to the timestamp.  Although the final query results require that each time series be aligned according to the timestamp, each time series query can be parallelized.  Here, with the idea of a consumer-producer queue, the operation of obtaining data for each time series is decoupled from the operation of finally aligning all time series.  Each time series corresponds to a producer thread and has its corresponding BlockingQueue. The producer task is responsible for reading the corresponding time series data and putting it into the BlockingQueue; there is only one consumer thread responsible for taking out from each time series BlockingQueue.  After the data is aligned with the timestamp, the results are assembled into a TSQueryDataSet and returned.</p> <p>In specific implementation, considering the resource constraints of the machine, instead of creating a thread for each time series of each query, the thread pool technology is used to submit each time series producer task as a Runnable task  To the thread pool for execution.</p> <p>The following introduces the producer's code first. It is encapsulated in an internal class ReadTask which is a RawQueryDataSetWithoutValueFilter and implements the Runnable interface.</p> <h3 id="org-apache-iotdb-db-query-dataset-rawquerydatasetwithoutvaluefilter-readtask"><a href="#org-apache-iotdb-db-query-dataset-rawquerydatasetwithoutvaluefilter-readtask" class="header-anchor">#</a> org.apache.iotdb.db.query.dataset.RawQueryDataSetWithoutValueFilter.ReadTask</h3> <p><code>ReadTask</code> has two fields</p> <ul><li>private final ManagedSeriesReader reader;</li> <li>private BlockingQueue&lt;BatchData&gt; blockingQueue;</li></ul> <p>The <code>ManagedSeriesReader</code> interface inherits the IBatchReader interface, which is mainly used to read data from a single time series, and adds the following four methods</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>boolean isManagedByQueryManager();

void setManagedByQueryManager(boolean managedByQueryManager);

boolean hasRemaining();

void setHasRemaining(boolean hasRemaining);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The first two methods are used to characterize whether the producer task corresponding to the time series is managed by the query manager, that is, has the producer task exited by itself because the blocking queue is full (the following will explain why it does not block waiting, and  Exit directly); the latter two methods are used to characterize whether there is any data in the reader corresponding to the time series.</p> <p><code>blockingQueue</code> is the blocking queue of the producer task. In fact, the blocking queue will only block unilaterally when the consumer fetches the data. When the producer puts the data, if the queue is full, it will exit directly without blocking.</p> <p>Let ’s take a look at the <code>run ()</code> method of <code>ReadTask</code>. The explanation of the execution process is shown in the code in the form of comments.</p> <h4 id="run"><a href="#run" class="header-anchor">#</a> run()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>public void run() {
  try {
    // The reason for the lock here is to ensure that the judgment of the fullness of the blockingQueue is correctly synchronized.
    synchronized (reader) {
      // Because every time a producer task is submitted (whether the producer submits itself recursively or the consumer finds that the producer task exits and submits itself), the queue is checked to see if it is full.  Producer task
      // So once the producer task is submitted, there must be a free space in the blockingQueue, we do not need to check whether the queue is full
      // If the reader corresponding to the time series still has data, enter the loop body
      while (reader.hasNextBatch()) {
        BatchData batchData = reader.nextBatch();
        // Since the BatchData obtained may be empty, it needs to iterate to the first BatchData that is not empty
        if (batchData.isEmpty()) {
          continue;
        }
        // Put the non-empty batchData into the blocking queue. At this time, the blocking queue must be dissatisfied, so it will not block.
        blockingQueue.put(batchData);
        // If the blocking queue is still not full, the producer task recursively submits itself to the thread pool for the next batchData
        if (blockingQueue.remainingCapacity() &gt; 0) {
          pool.submit(this);
        }
        // If the blocking queue is full, the producer task exits and the managedByQueryManager corresponding to the reader is set to false
        else {
          reader.setManagedByQueryManager(false);
        }
        return;
      }
      // The code is executed here, which means that the previous while loop condition is not satisfied, that is, there is no data in the reader corresponding to the time series.
      // We put a SignalBatchData in the blocking queue to inform consumers that there is no more data in this time series, and there is no need to fetch data from the queue corresponding to this time series
      blockingQueue.put(SignalBatchData.getInstance());
      // Set the reader's hasRemaining field to false
      // Inform consumers that they no longer need to submit producer tasks for this time series
      reader.setHasRemaining(false);
      // Set the reader's managedByQueryManager field to false
      reader.setManagedByQueryManager(false);
    }
  } catch (InterruptedException e) {
    LOGGER.error(&quot;Interrupted while putting into the blocking queue: &quot;, e);
    Thread.currentThread().interrupt();
  } catch (IOException e) {
    LOGGER.error(&quot;Something gets wrong while reading from the series reader: &quot;, e);
  } catch (Exception e) {
    LOGGER.error(&quot;Something gets wrong: &quot;, e);
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Next, introduce the code of the consumer. The main logic of the consumer is to take the value from the queue of each time series, align the timestamps, and then piece together the result set.  The alignment of timestamps is mainly achieved through a minimum heap of timestamps. If the timestamp of the time series is equal to the timestamp at the top of the heap, then the value is taken out; otherwise, the time series value under the timestamp is set to <code>null</code>.</p> <p>First introduce some important fields of consumer tasks</p> <ul><li><p>TreeSet&lt;Long&gt; timeHeap</p> <p>The smallest heap of timestamps for timestamp alignment</p></li> <li><p>BlockingQueue&lt;BatchData&gt;[] blockingQueueArray;</p> <p>An array of blocking queues to store the blocking queues corresponding to each time series</p></li> <li><p>boolean[] noMoreDataInQueueArray</p> <p>There is no value in the blocking queue to represent a certain time series. If it is false, the consumer will not call the <code>take ()</code> method to prevent the consumer thread from being blocked.</p></li> <li><p>BatchData[] cachedBatchDataArray</p> <p>Cache a BatchData fetched from the blocking queue, because the <code>BatchData</code> from<code>take ()</code>in the blocking queue cannot be consumed all at once, so you need to cache</p></li></ul> <p>The <code>init ()</code> method was first called in the constructor of the consumer <code>RawQueryDataSetWithoutValueFilter</code></p> <h4 id="init"><a href="#init" class="header-anchor">#</a> init()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void init() throws InterruptedException {
	timeHeap = new TreeSet&lt;&gt;();
	// Build producer tasks for each time series
	for (int i = 0; i &lt; seriesReaderList.size(); i++) {
	  ManagedSeriesReader reader = seriesReaderList.get(i);
	  reader.setHasRemaining(true);
	  reader.setManagedByQueryManager(true);
	  pool.submit(new ReadTask(reader, blockingQueueArray[i]));
	}
	// Initialize the minimum heap and fill the cache for each time series
	for (int i = 0; i &lt; seriesReaderList.size(); i++) {
	  // Call fillCache (int) method to fill the cache
	  fillCache(i);
	  // Try to put the current minimum timestamp of each time series into the heap
	  if (cachedBatchDataArray[i] != null &amp;&amp; cachedBatchDataArray[i].hasCurrent()) {
	    long time = cachedBatchDataArray[i].currentTime();
	    timeHeap.add(time);
	  }
	}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="fillcache-int"><a href="#fillcache-int" class="header-anchor">#</a> fillCache(int)</h4> <p>This method is responsible for fetching data from the blocking queue and filling the cache. For the specific logic, see the note below.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void fillCache(int seriesIndex) throws InterruptedException {
    // Get data from the blocking queue, if there is no data, it will block waiting for data in the queue
	BatchData batchData = blockingQueueArray[seriesIndex].take();
	// If it is a signal BatchData, set oMoreDataInQueue of the corresponding time series to false
	if (batchData instanceof SignalBatchData) {
	  noMoreDataInQueueArray[seriesIndex] = true;
	}
	else {
	  // Cache the retrieved BatchData into cachedBatchDataArray
	  cachedBatchDataArray[seriesIndex] = batchData;
	
	  // The reason for locking here is the same as that of the producer task, in order to ensure that the judgment of the fullness of the blockingQueue is correctly synchronized.
	  synchronized (seriesReaderList.get(seriesIndex)) {
	    // Only when the blocking queue is not full, do we need to determine whether it is necessary to submit the producer task. This also guarantees that the producer task will be submitted if and only if the blocking queue is not full.
	    if (blockingQueueArray[seriesIndex].remainingCapacity() &gt; 0) {
	      ManagedSeriesReader reader = seriesReaderList.get(seriesIndex);、
	      // If the reader of the time series is not managed by the query manager (that is, the producer task exits because the queue is full), and there is still data in the reader, we need to submit the producer task of the time series again
	      if (!reader.isManagedByQueryManager() &amp;&amp; reader.hasRemaining()) {
	        reader.setManagedByQueryManager(true);
	        pool.submit(new ReadTask(reader, blockingQueueArray[seriesIndex]));
	      }
	    }
	  }
	}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>With the data for each time series, the next step is to align the data for each time stamp and assemble the results into a TSQueryDataSet to return.  The logic here is encapsulated in the fillBuffer () method. This method also contains the logic of limit and offset, and the format of the result set. We will not go into details here, but only analyze the process of data reading and time stamp alignment.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Fetch the current timestamp from the smallest heap
long minTime = timeHeap.pollFirst();
for (int seriesIndex = 0; seriesIndex &lt; seriesNum; seriesIndex++) {
	if (cachedBatchDataArray[seriesIndex] == null
	    || !cachedBatchDataArray[seriesIndex].hasCurrent()
	    || cachedBatchDataArray[seriesIndex].currentTime() != minTime) {
	  // The time series has no data at the current timestamp and is set to null
	  ...
	  
	} else {
	  // The time series has data at the current timestamp, and the data is formatted into a result set format
	  TSDataType type = cachedBatchDataArray[seriesIndex].getDataType();
	  ...
	  
	}
		
  // Move the batchdata cursor of this time series buffer back
  cachedBatchDataArray[seriesIndex].next();
	
  // If the currently cached batchdata is empty and the blocking queue still has data, call the fillCache () method again to fill the cache
  if (!cachedBatchDataArray[seriesIndex].hasCurrent()
      &amp;&amp; !noMoreDataInQueueArray[seriesIndex]) {
    fillCache(seriesIndex);
  }
	
  // Try to put the next timestamp of that time series into the smallest heap
  if (cachedBatchDataArray[seriesIndex].hasCurrent()) {
    long time = cachedBatchDataArray[seriesIndex].currentTime();
    timeHeap.add(time);
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="no-value-filter-result-set-is-not-aligned-by-timestamp"><a href="#no-value-filter-result-set-is-not-aligned-by-timestamp" class="header-anchor">#</a> No value filter + result set is not aligned by timestamp</h2> <h3 id="org-apache-iotdb-db-query-dataset-nonalignenginedataset"><a href="#org-apache-iotdb-db-query-dataset-nonalignenginedataset" class="header-anchor">#</a> org.apache.iotdb.db.query.dataset.NonAlignEngineDataSet</h3> <p><code>NonAlignEngineDataSet</code> implements query logic that has no value filtering conditions and does not need to be aligned by timestamp.  The query logic here is similar to RawQueryDataSetWithoutValueFilter, but its consumer logic is simpler, because it does not need to perform timestamp alignment.  And each producer task can also do more work, not only can take out BatchData from Reader, but can further say that the taken out BatchData is formatted into the output required by the result set, thereby improving the parallelism of the program.  In this way, the consumer only needs to fetch data from each blocking queue and set it into the corresponding position of TSQueryNonAlignDataSet.</p> <p>The specific query logic is not repeated here. You can refer to the query logic analysis of RawQueryDataSetWithoutValueFilter.</p> <h2 id="include-value-filter-result-set-aligned-by-timestamp"><a href="#include-value-filter-result-set-aligned-by-timestamp" class="header-anchor">#</a> Include value filter + result set aligned by timestamp</h2> <h3 id="org-apache-iotdb-db-query-dataset-enginedatasetwithvaluefilter"><a href="#org-apache-iotdb-db-query-dataset-enginedatasetwithvaluefilter" class="header-anchor">#</a> org.apache.iotdb.db.query.dataset.EngineDataSetWithValueFilter</h3> <p><code>EngineDataSetWithValueFilter</code> implements query logic with value filter conditions.</p> <p>Its query logic is to first generate a timestamp that meets the filtering conditions according to the query conditions, query the value of the projection column by the timestamp that meets the conditions, and then return the result set.  It has four fields</p> <ul><li><p>private EngineTimeGenerator timeGenerator;</p> <p>Is used to generate timestamps that satisfy the filter</p></li> <li><p>private List&lt;IReaderByTimestamp&gt; seriesReaderByTimestampList;</p> <p>Reader for each time series, used to get data based on timestamp</p></li> <li><p>private boolean hasCachedRowRecord;</p> <p>Whether data rows are currently cached</p></li> <li><p>private RowRecord cachedRowRecord;</p> <p>Data lines currently cached</p></li></ul> <p>Its main query logic is encapsulated in the <code>cacheRowRecord ()</code> method. For detailed analysis, see the comments in the code.</p> <h4 id="cacherowrecord"><a href="#cacherowrecord" class="header-anchor">#</a> cacheRowRecord()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>private boolean cacheRowRecord() throws IOException {
   // Determine if there is a next eligible timestamp
	while (timeGenerator.hasNext()) {
	  boolean hasField = false;
	  // Get the current eligible timestamp
	  long timestamp = timeGenerator.next();
	  RowRecord rowRecord = new RowRecord(timestamp);
	  for (int i = 0; i &lt; seriesReaderByTimestampList.size(); i++) {
	    // Root to get the value under the current timestamp of each time series
	    IReaderByTimestamp reader = seriesReaderByTimestampList.get(i);
	    Object value = reader.getValueInTimestamp(timestamp);
	    // Null if the time series has no value under the current timestamp
	    if (value == null) {
	      rowRecord.addField(null);
	    } 
	    // Otherwise set hasField to true
	    else {
	      hasField = true;
	      rowRecord.addField(value, dataTypes.get(i));
	    }
	  }
	  // If there is a value in any time series under the timestamp, it means that the timestamp is valid, and the data line is cached
	  if (hasField) {
	    hasCachedRowRecord = true;
	    cachedRowRecord = rowRecord;
	    break;
	  }
	}
	return hasCachedRowRecord;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SystemDesign/DataQuery/SeriesReader.html" class="prev">
          SeriesReader
        </a></span> <span class="next"><a href="/SystemDesign/DataQuery/AggregationQuery.html">
          AggregationQuery
        </a>
        →
      </span></p></div> <p style="text-align: center;">Copyright © 2020 The Apache Software Foundation.<br>
     Apache and the Apache feather logo are trademarks of The Apache Software Foundation</p></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7e8d0fee.js" defer></script><script src="/assets/js/3.187083c5.js" defer></script><script src="/assets/js/38.0d46b6a1.js" defer></script>
  </body>
</html>