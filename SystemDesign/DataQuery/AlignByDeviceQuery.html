<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> </title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content=" ">
    <meta name="Description" content="Apache IoTDB: Time Series Database for IoT">
    <meta name="Keywords" content="TSDB, time series, time series database, IoTDB, IoT database, IoT data management,时序数据库, 时间序列管理, IoTDB, 物联网数据库, 实时数据库, 物联网数据管理, 物联网数据">
    <meta name="baidu-site-verification" content="wfKETzB3OT">
    <meta name="google-site-verification" content="mZWAoRY0yj_HAr-s47zHCGHzx5Ju-RVm5wDbPnwQYFo">
    
    <link rel="preload" href="/assets/css/0.styles.53b4846f.css" as="style"><link rel="preload" href="/assets/js/app.cdf3999a.js" as="script"><link rel="preload" href="/assets/js/3.588efd8d.js" as="script"><link rel="preload" href="/assets/js/31.726da8fb.js" as="script"><link rel="prefetch" href="/assets/js/10.a9e4399a.js"><link rel="prefetch" href="/assets/js/100.8bd957cc.js"><link rel="prefetch" href="/assets/js/101.c1fa8a84.js"><link rel="prefetch" href="/assets/js/102.579834e7.js"><link rel="prefetch" href="/assets/js/103.c7478bad.js"><link rel="prefetch" href="/assets/js/104.f5e7dd53.js"><link rel="prefetch" href="/assets/js/105.1877fc35.js"><link rel="prefetch" href="/assets/js/106.13a83952.js"><link rel="prefetch" href="/assets/js/107.ca50b2df.js"><link rel="prefetch" href="/assets/js/108.14b83f4d.js"><link rel="prefetch" href="/assets/js/109.9e57d132.js"><link rel="prefetch" href="/assets/js/11.43ba1aca.js"><link rel="prefetch" href="/assets/js/110.f75eefba.js"><link rel="prefetch" href="/assets/js/111.24633fba.js"><link rel="prefetch" href="/assets/js/112.fa3f6980.js"><link rel="prefetch" href="/assets/js/113.754e0344.js"><link rel="prefetch" href="/assets/js/114.0a6fa7d5.js"><link rel="prefetch" href="/assets/js/115.81bb384f.js"><link rel="prefetch" href="/assets/js/116.d459a789.js"><link rel="prefetch" href="/assets/js/117.18139bb0.js"><link rel="prefetch" href="/assets/js/118.f9ecd9db.js"><link rel="prefetch" href="/assets/js/119.ec69a9ab.js"><link rel="prefetch" href="/assets/js/12.af3ddb51.js"><link rel="prefetch" href="/assets/js/120.09c2a3de.js"><link rel="prefetch" href="/assets/js/121.6439566f.js"><link rel="prefetch" href="/assets/js/122.ecb201e7.js"><link rel="prefetch" href="/assets/js/123.aa0b00b8.js"><link rel="prefetch" href="/assets/js/124.29c58d16.js"><link rel="prefetch" href="/assets/js/125.c686b04b.js"><link rel="prefetch" href="/assets/js/126.b205474c.js"><link rel="prefetch" href="/assets/js/127.3e2adff6.js"><link rel="prefetch" href="/assets/js/128.2fc3855d.js"><link rel="prefetch" href="/assets/js/129.f12cc937.js"><link rel="prefetch" href="/assets/js/13.821d2576.js"><link rel="prefetch" href="/assets/js/130.1a9d305e.js"><link rel="prefetch" href="/assets/js/131.6b5d0875.js"><link rel="prefetch" href="/assets/js/132.a08e11b1.js"><link rel="prefetch" href="/assets/js/133.38d2e78d.js"><link rel="prefetch" href="/assets/js/134.36883f0a.js"><link rel="prefetch" href="/assets/js/135.28172fcf.js"><link rel="prefetch" href="/assets/js/136.b3cd2325.js"><link rel="prefetch" href="/assets/js/137.1974b706.js"><link rel="prefetch" href="/assets/js/138.e357d9db.js"><link rel="prefetch" href="/assets/js/139.898f0574.js"><link rel="prefetch" href="/assets/js/14.b377a5b4.js"><link rel="prefetch" href="/assets/js/140.da9d0dca.js"><link rel="prefetch" href="/assets/js/141.aa574ada.js"><link rel="prefetch" href="/assets/js/142.109bd571.js"><link rel="prefetch" href="/assets/js/143.a61a84bf.js"><link rel="prefetch" href="/assets/js/144.39e2eb98.js"><link rel="prefetch" href="/assets/js/145.b1c8b517.js"><link rel="prefetch" href="/assets/js/146.1611878d.js"><link rel="prefetch" href="/assets/js/147.2a4483ce.js"><link rel="prefetch" href="/assets/js/148.8c02866a.js"><link rel="prefetch" href="/assets/js/149.85fa92a9.js"><link rel="prefetch" href="/assets/js/15.5279267e.js"><link rel="prefetch" href="/assets/js/150.49b689dc.js"><link rel="prefetch" href="/assets/js/151.3981b21b.js"><link rel="prefetch" href="/assets/js/152.65ce68b7.js"><link rel="prefetch" href="/assets/js/153.a094fee0.js"><link rel="prefetch" href="/assets/js/154.99528d5f.js"><link rel="prefetch" href="/assets/js/155.e889bcac.js"><link rel="prefetch" href="/assets/js/156.8908dffd.js"><link rel="prefetch" href="/assets/js/157.c41f515f.js"><link rel="prefetch" href="/assets/js/158.30b40121.js"><link rel="prefetch" href="/assets/js/159.4c5e89b3.js"><link rel="prefetch" href="/assets/js/16.9d83cb2c.js"><link rel="prefetch" href="/assets/js/160.13f4648d.js"><link rel="prefetch" href="/assets/js/161.e96ce21f.js"><link rel="prefetch" href="/assets/js/162.eafe4b38.js"><link rel="prefetch" href="/assets/js/163.baf65169.js"><link rel="prefetch" href="/assets/js/164.efc7e734.js"><link rel="prefetch" href="/assets/js/165.531e3a21.js"><link rel="prefetch" href="/assets/js/166.83045dff.js"><link rel="prefetch" href="/assets/js/167.221e33e6.js"><link rel="prefetch" href="/assets/js/168.f2779c9c.js"><link rel="prefetch" href="/assets/js/169.8e53ddae.js"><link rel="prefetch" href="/assets/js/17.9ba04d92.js"><link rel="prefetch" href="/assets/js/170.016bb5ee.js"><link rel="prefetch" href="/assets/js/171.eb7d4d69.js"><link rel="prefetch" href="/assets/js/172.c70c741f.js"><link rel="prefetch" href="/assets/js/173.280205cf.js"><link rel="prefetch" href="/assets/js/174.ecb1b06f.js"><link rel="prefetch" href="/assets/js/175.683490a7.js"><link rel="prefetch" href="/assets/js/176.fa841509.js"><link rel="prefetch" href="/assets/js/177.2db91cf7.js"><link rel="prefetch" href="/assets/js/178.ab792d1f.js"><link rel="prefetch" href="/assets/js/179.fbae1afb.js"><link rel="prefetch" href="/assets/js/18.f477ec91.js"><link rel="prefetch" href="/assets/js/180.ffa09c9f.js"><link rel="prefetch" href="/assets/js/181.f2cbed8b.js"><link rel="prefetch" href="/assets/js/182.9595b60d.js"><link rel="prefetch" href="/assets/js/183.7432af40.js"><link rel="prefetch" href="/assets/js/184.dc494197.js"><link rel="prefetch" href="/assets/js/185.ab7a60e4.js"><link rel="prefetch" href="/assets/js/186.0d662568.js"><link rel="prefetch" href="/assets/js/187.8384d86a.js"><link rel="prefetch" href="/assets/js/188.63ddc7bd.js"><link rel="prefetch" href="/assets/js/189.e420e54d.js"><link rel="prefetch" href="/assets/js/19.72d80820.js"><link rel="prefetch" href="/assets/js/190.a8334c8b.js"><link rel="prefetch" href="/assets/js/191.0de48ee4.js"><link rel="prefetch" href="/assets/js/192.ce27c615.js"><link rel="prefetch" href="/assets/js/193.219511cd.js"><link rel="prefetch" href="/assets/js/194.226f7a2a.js"><link rel="prefetch" href="/assets/js/195.e0943064.js"><link rel="prefetch" href="/assets/js/196.fbfe37d8.js"><link rel="prefetch" href="/assets/js/197.7149bb98.js"><link rel="prefetch" href="/assets/js/198.0e7a7650.js"><link rel="prefetch" href="/assets/js/199.1be76b5e.js"><link rel="prefetch" href="/assets/js/20.4bdfbbe8.js"><link rel="prefetch" href="/assets/js/200.f2b2a4b9.js"><link rel="prefetch" href="/assets/js/201.09c58668.js"><link rel="prefetch" href="/assets/js/202.c472c624.js"><link rel="prefetch" href="/assets/js/203.e33d45f2.js"><link rel="prefetch" href="/assets/js/204.76b69f5a.js"><link rel="prefetch" href="/assets/js/205.e108e62c.js"><link rel="prefetch" href="/assets/js/206.68c5cb16.js"><link rel="prefetch" href="/assets/js/207.282be351.js"><link rel="prefetch" href="/assets/js/208.75bb643e.js"><link rel="prefetch" href="/assets/js/209.52929254.js"><link rel="prefetch" href="/assets/js/21.f8b3c5f4.js"><link rel="prefetch" href="/assets/js/210.834316e8.js"><link rel="prefetch" href="/assets/js/211.812f06f3.js"><link rel="prefetch" href="/assets/js/212.31580ccf.js"><link rel="prefetch" href="/assets/js/213.13dbb0f7.js"><link rel="prefetch" href="/assets/js/214.b43ab808.js"><link rel="prefetch" href="/assets/js/215.fe7cb020.js"><link rel="prefetch" href="/assets/js/216.0607ca27.js"><link rel="prefetch" href="/assets/js/217.36694c50.js"><link rel="prefetch" href="/assets/js/218.f1defb63.js"><link rel="prefetch" href="/assets/js/219.a082793e.js"><link rel="prefetch" href="/assets/js/22.ab7a2af8.js"><link rel="prefetch" href="/assets/js/220.088cfac6.js"><link rel="prefetch" href="/assets/js/221.88d6da3a.js"><link rel="prefetch" href="/assets/js/222.45d66b4f.js"><link rel="prefetch" href="/assets/js/223.4509ca59.js"><link rel="prefetch" href="/assets/js/224.f84461b0.js"><link rel="prefetch" href="/assets/js/225.60af6296.js"><link rel="prefetch" href="/assets/js/226.3e1599a2.js"><link rel="prefetch" href="/assets/js/227.776ecb1e.js"><link rel="prefetch" href="/assets/js/228.69465426.js"><link rel="prefetch" href="/assets/js/229.42c575fc.js"><link rel="prefetch" href="/assets/js/23.98a4658a.js"><link rel="prefetch" href="/assets/js/230.a80290a7.js"><link rel="prefetch" href="/assets/js/231.04046432.js"><link rel="prefetch" href="/assets/js/232.d491c773.js"><link rel="prefetch" href="/assets/js/233.298cb6f1.js"><link rel="prefetch" href="/assets/js/234.364a0899.js"><link rel="prefetch" href="/assets/js/235.a142dac9.js"><link rel="prefetch" href="/assets/js/236.fef9edf6.js"><link rel="prefetch" href="/assets/js/237.c00b4e2f.js"><link rel="prefetch" href="/assets/js/238.5a0659b0.js"><link rel="prefetch" href="/assets/js/239.7adcb578.js"><link rel="prefetch" href="/assets/js/24.d23292bc.js"><link rel="prefetch" href="/assets/js/240.d158ca74.js"><link rel="prefetch" href="/assets/js/241.636b16cf.js"><link rel="prefetch" href="/assets/js/242.33a3956b.js"><link rel="prefetch" href="/assets/js/243.4358cb6f.js"><link rel="prefetch" href="/assets/js/244.7a46bd7e.js"><link rel="prefetch" href="/assets/js/245.9de35f82.js"><link rel="prefetch" href="/assets/js/246.0a2cc3cc.js"><link rel="prefetch" href="/assets/js/247.b341a380.js"><link rel="prefetch" href="/assets/js/248.416506e2.js"><link rel="prefetch" href="/assets/js/249.4a9cb0eb.js"><link rel="prefetch" href="/assets/js/25.bc6a97e8.js"><link rel="prefetch" href="/assets/js/250.594e9249.js"><link rel="prefetch" href="/assets/js/251.b0d3f2d1.js"><link rel="prefetch" href="/assets/js/252.230db83f.js"><link rel="prefetch" href="/assets/js/253.5a0fbaf8.js"><link rel="prefetch" href="/assets/js/254.7350340d.js"><link rel="prefetch" href="/assets/js/255.20115004.js"><link rel="prefetch" href="/assets/js/256.6b30fe37.js"><link rel="prefetch" href="/assets/js/257.3b07691d.js"><link rel="prefetch" href="/assets/js/258.31070ecb.js"><link rel="prefetch" href="/assets/js/259.0acb0d1e.js"><link rel="prefetch" href="/assets/js/26.2792deb2.js"><link rel="prefetch" href="/assets/js/260.9aa2b5a1.js"><link rel="prefetch" href="/assets/js/261.fb1beee9.js"><link rel="prefetch" href="/assets/js/262.0c3e97f4.js"><link rel="prefetch" href="/assets/js/263.0bbcc3f2.js"><link rel="prefetch" href="/assets/js/264.e287597f.js"><link rel="prefetch" href="/assets/js/265.4d46e056.js"><link rel="prefetch" href="/assets/js/266.13b19fd3.js"><link rel="prefetch" href="/assets/js/267.83fffa1f.js"><link rel="prefetch" href="/assets/js/268.4b22e6e7.js"><link rel="prefetch" href="/assets/js/269.bfe21579.js"><link rel="prefetch" href="/assets/js/27.0b57c820.js"><link rel="prefetch" href="/assets/js/270.4bdfcc8f.js"><link rel="prefetch" href="/assets/js/271.39822626.js"><link rel="prefetch" href="/assets/js/272.004526d7.js"><link rel="prefetch" href="/assets/js/273.8a77bfd1.js"><link rel="prefetch" href="/assets/js/274.939f1509.js"><link rel="prefetch" href="/assets/js/275.4e2034c9.js"><link rel="prefetch" href="/assets/js/276.6be1a56d.js"><link rel="prefetch" href="/assets/js/277.3bc5131a.js"><link rel="prefetch" href="/assets/js/278.2b3913ec.js"><link rel="prefetch" href="/assets/js/279.3912433a.js"><link rel="prefetch" href="/assets/js/28.902cf242.js"><link rel="prefetch" href="/assets/js/280.00c9e48f.js"><link rel="prefetch" href="/assets/js/281.a9d68720.js"><link rel="prefetch" href="/assets/js/282.7ebec984.js"><link rel="prefetch" href="/assets/js/283.19c9d5ea.js"><link rel="prefetch" href="/assets/js/29.8878a84b.js"><link rel="prefetch" href="/assets/js/30.ee5523ce.js"><link rel="prefetch" href="/assets/js/32.bad93e79.js"><link rel="prefetch" href="/assets/js/33.f3563689.js"><link rel="prefetch" href="/assets/js/34.6b0c9f89.js"><link rel="prefetch" href="/assets/js/35.99f1de20.js"><link rel="prefetch" href="/assets/js/36.3fb8974c.js"><link rel="prefetch" href="/assets/js/37.c72b6907.js"><link rel="prefetch" href="/assets/js/38.eadbf912.js"><link rel="prefetch" href="/assets/js/39.683bc07a.js"><link rel="prefetch" href="/assets/js/4.eafdd42f.js"><link rel="prefetch" href="/assets/js/40.f2d861cf.js"><link rel="prefetch" href="/assets/js/41.65f78a2f.js"><link rel="prefetch" href="/assets/js/42.101ecd13.js"><link rel="prefetch" href="/assets/js/43.b1e97d4d.js"><link rel="prefetch" href="/assets/js/44.abd97f1d.js"><link rel="prefetch" href="/assets/js/45.b93457e4.js"><link rel="prefetch" href="/assets/js/46.21a75107.js"><link rel="prefetch" href="/assets/js/47.2d120101.js"><link rel="prefetch" href="/assets/js/48.d24599f6.js"><link rel="prefetch" href="/assets/js/49.3de3d3a7.js"><link rel="prefetch" href="/assets/js/5.bd72943e.js"><link rel="prefetch" href="/assets/js/50.ef3f7155.js"><link rel="prefetch" href="/assets/js/51.08fc9992.js"><link rel="prefetch" href="/assets/js/52.0598dc9f.js"><link rel="prefetch" href="/assets/js/53.6a71a631.js"><link rel="prefetch" href="/assets/js/54.de56a393.js"><link rel="prefetch" href="/assets/js/55.98bddbab.js"><link rel="prefetch" href="/assets/js/56.d7353ef9.js"><link rel="prefetch" href="/assets/js/57.11f4ec1f.js"><link rel="prefetch" href="/assets/js/58.e357e1b7.js"><link rel="prefetch" href="/assets/js/59.c5f3f24b.js"><link rel="prefetch" href="/assets/js/6.d37d398a.js"><link rel="prefetch" href="/assets/js/60.2d67bc6c.js"><link rel="prefetch" href="/assets/js/61.c44ac685.js"><link rel="prefetch" href="/assets/js/62.12596064.js"><link rel="prefetch" href="/assets/js/63.910cc28d.js"><link rel="prefetch" href="/assets/js/64.3a046b10.js"><link rel="prefetch" href="/assets/js/65.6bc58366.js"><link rel="prefetch" href="/assets/js/66.705c68a4.js"><link rel="prefetch" href="/assets/js/67.f4476669.js"><link rel="prefetch" href="/assets/js/68.1113d56a.js"><link rel="prefetch" href="/assets/js/69.7d61bd69.js"><link rel="prefetch" href="/assets/js/7.8c733af6.js"><link rel="prefetch" href="/assets/js/70.9336ea50.js"><link rel="prefetch" href="/assets/js/71.5e420e3b.js"><link rel="prefetch" href="/assets/js/72.543a898c.js"><link rel="prefetch" href="/assets/js/73.6d1f66ee.js"><link rel="prefetch" href="/assets/js/74.5d0da28f.js"><link rel="prefetch" href="/assets/js/75.86e5e3c8.js"><link rel="prefetch" href="/assets/js/76.b7cb95ff.js"><link rel="prefetch" href="/assets/js/77.8bed890e.js"><link rel="prefetch" href="/assets/js/78.16f18101.js"><link rel="prefetch" href="/assets/js/79.dc208b0a.js"><link rel="prefetch" href="/assets/js/8.c39ee0f7.js"><link rel="prefetch" href="/assets/js/80.716d3f1a.js"><link rel="prefetch" href="/assets/js/81.0d61bd13.js"><link rel="prefetch" href="/assets/js/82.63b774fe.js"><link rel="prefetch" href="/assets/js/83.eb71b7f0.js"><link rel="prefetch" href="/assets/js/84.f8a4906d.js"><link rel="prefetch" href="/assets/js/85.863ab5c0.js"><link rel="prefetch" href="/assets/js/86.a209b575.js"><link rel="prefetch" href="/assets/js/87.64453893.js"><link rel="prefetch" href="/assets/js/88.ee59fcdf.js"><link rel="prefetch" href="/assets/js/89.3d75e5a1.js"><link rel="prefetch" href="/assets/js/9.3e1c4f62.js"><link rel="prefetch" href="/assets/js/90.299d80e8.js"><link rel="prefetch" href="/assets/js/91.ea29b799.js"><link rel="prefetch" href="/assets/js/92.01e0d5a2.js"><link rel="prefetch" href="/assets/js/93.45c069b8.js"><link rel="prefetch" href="/assets/js/94.aa7642bf.js"><link rel="prefetch" href="/assets/js/95.d08edcb5.js"><link rel="prefetch" href="/assets/js/96.eca6c1db.js"><link rel="prefetch" href="/assets/js/97.e062ad6a.js"><link rel="prefetch" href="/assets/js/98.9478a6e3.js"><link rel="prefetch" href="/assets/js/99.5ba76d9a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.262891fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53b4846f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt=" " class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Document</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/UserGuide/Master/Get Started/QuickStart.html" class="nav-link">In progress</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.11.x/Get Started/QuickStart.html" class="nav-link">V0.11.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.10.x/Get Started/QuickStart.html" class="nav-link">V0.10.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.9.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.9.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.8.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.8.x</a></li></ul></div></div><div class="nav-item"><a href="/SystemDesign/Architecture/Architecture.html" class="nav-link">System design</a></div><div class="nav-item"><a href="/Download/" class="nav-link">Download</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cwiki.apache.org/confluence/display/iotdb" class="nav-link external">
  Wiki
  <!----></a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Project Committers.html" class="nav-link">People</a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Powered By.html" class="nav-link">Powered By</a></li><li class="dropdown-item"><!----> <a href="/Community/Materials.html" class="nav-link">Resources</a></li><li class="dropdown-item"><!----> <a href="/Community/Feedback.html" class="nav-link">Feedback</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development/VoteRelease.html" class="nav-link">How to vote</a></li><li class="dropdown-item"><!----> <a href="/Development/HowToCommit.html" class="nav-link">How to Commit</a></li><li class="dropdown-item"><!----> <a href="/Development/Committer.html" class="nav-link">Become a Committer</a></li><li class="dropdown-item"><!----> <a href="/Development/ContributeGuide.html" class="nav-link">ContributeGuide</a></li><li class="dropdown-item"><!----> <a href="/Development/format-changelist.html" class="nav-link">Changelist of TsFile</a></li><li class="dropdown-item"><!----> <a href="/Development/rpc-changelist.html" class="nav-link">Changelist of RPC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Index.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/Blog/Release0_93.html" class="nav-link">Some Notes on Release 0.9.3 and upcoming 0.10.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ASF</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.apache.org/" class="nav-link external">
  Foundation
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/licenses/" class="nav-link external">
  License
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/security/" class="nav-link external">
  Security
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/sponsorship.html" class="nav-link external">
  Sponsorship
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/thanks.html" class="nav-link external">
  Thanks
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/events/current-event" class="nav-link external">
  Current Events
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SystemDesign/DataQuery/AlignByDeviceQuery.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/SystemDesign/DataQuery/AlignByDeviceQuery.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/apache/iotdb.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Document</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/UserGuide/Master/Get Started/QuickStart.html" class="nav-link">In progress</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.11.x/Get Started/QuickStart.html" class="nav-link">V0.11.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.10.x/Get Started/QuickStart.html" class="nav-link">V0.10.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.9.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.9.x</a></li><li class="dropdown-item"><!----> <a href="/UserGuide/V0.8.x/0-Get Started/1-QuickStart.html" class="nav-link">V0.8.x</a></li></ul></div></div><div class="nav-item"><a href="/SystemDesign/Architecture/Architecture.html" class="nav-link">System design</a></div><div class="nav-item"><a href="/Download/" class="nav-link">Download</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cwiki.apache.org/confluence/display/iotdb" class="nav-link external">
  Wiki
  <!----></a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Project Committers.html" class="nav-link">People</a></li><li class="dropdown-item"><!----> <a href="/Community/Community-Powered By.html" class="nav-link">Powered By</a></li><li class="dropdown-item"><!----> <a href="/Community/Materials.html" class="nav-link">Resources</a></li><li class="dropdown-item"><!----> <a href="/Community/Feedback.html" class="nav-link">Feedback</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development/VoteRelease.html" class="nav-link">How to vote</a></li><li class="dropdown-item"><!----> <a href="/Development/HowToCommit.html" class="nav-link">How to Commit</a></li><li class="dropdown-item"><!----> <a href="/Development/Committer.html" class="nav-link">Become a Committer</a></li><li class="dropdown-item"><!----> <a href="/Development/ContributeGuide.html" class="nav-link">ContributeGuide</a></li><li class="dropdown-item"><!----> <a href="/Development/format-changelist.html" class="nav-link">Changelist of TsFile</a></li><li class="dropdown-item"><!----> <a href="/Development/rpc-changelist.html" class="nav-link">Changelist of RPC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/Index.html" class="nav-link">Overview</a></li><li class="dropdown-item"><!----> <a href="/Blog/Release0_93.html" class="nav-link">Some Notes on Release 0.9.3 and upcoming 0.10.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ASF</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.apache.org/" class="nav-link external">
  Foundation
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/licenses/" class="nav-link external">
  License
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/security/" class="nav-link external">
  Security
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/sponsorship.html" class="nav-link external">
  Sponsorship
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/foundation/thanks.html" class="nav-link external">
  Thanks
  <!----></a></li><li class="dropdown-item"><!----> <a href="http://www.apache.org/events/current-event" class="nav-link external">
  Current Events
  <!----></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SystemDesign/DataQuery/AlignByDeviceQuery.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/SystemDesign/DataQuery/AlignByDeviceQuery.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/apache/iotdb.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>System design</span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TsFile</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>QueryEngine</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SchemaManager</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>StorageEngine</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DataQuery</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/SystemDesign/DataQuery/DataQuery.html" class="sidebar-link">DataQuery</a></li><li><a href="/SystemDesign/DataQuery/QueryFundamentals.html" class="sidebar-link">QueryFundamentals</a></li><li><a href="/SystemDesign/DataQuery/SeriesReader.html" class="sidebar-link">SeriesReader</a></li><li><a href="/SystemDesign/DataQuery/RawDataQuery.html" class="sidebar-link">RawDataQuery</a></li><li><a href="/SystemDesign/DataQuery/AggregationQuery.html" class="sidebar-link">AggregationQuery</a></li><li><a href="/SystemDesign/DataQuery/GroupByQuery.html" class="sidebar-link">GroupByQuery</a></li><li><a href="/SystemDesign/DataQuery/LastQuery.html" class="sidebar-link">LastQuery</a></li><li><a href="/SystemDesign/DataQuery/AlignByDeviceQuery.html" aria-current="page" class="active sidebar-link">AlignByDeviceQuery</a></li><li><a href="/SystemDesign/DataQuery/FillFunction.html" class="sidebar-link">FillFunction</a></li><li><a href="/SystemDesign/DataQuery/GroupByFillQuery.html" class="sidebar-link">GroupByFillQuery</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Connector</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="query-by-device-alignment"><a href="#query-by-device-alignment" class="header-anchor">#</a> Query by device alignment</h1> <p>The table structure of AlignByDevice Query is:</p> <table><thead><tr><th>time</th> <th>device</th> <th>sensor1</th> <th>sensor2</th> <th>sensor3</th> <th>...</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <h2 id="design-principle"><a href="#design-principle" class="header-anchor">#</a> Design principle</h2> <p>The implementation principle of the device-by-device query is mainly to calculate the measurement points and filter conditions corresponding to each device in the query, and then the query is performed separately for each device, and the result set is assembled and returned.</p> <h3 id="meaning-of-important-fields-in-alignbydeviceplan"><a href="#meaning-of-important-fields-in-alignbydeviceplan" class="header-anchor">#</a> Meaning of important fields in AlignByDevicePlan</h3> <p>First explain the meaning of some important fields in AlignByDevicePlan:</p> <ul><li><code>List&lt;String&gt; measurements</code>：The list of measurements that appear in the query.</li> <li><code>List&lt;String&gt; devices</code>: The list of devices got from prefix paths.</li> <li><code>Map&lt;String, IExpression&gt; deviceToFilterMap</code>: This field is used to store the filter conditions corresponding to the device.</li> <li><code>Map&lt;String, TSDataType&gt; measurementDataTypeMap</code>：This field is used to record the actual data type of the time series for the actual query, and its key value does not contain the aggregate functions.</li> <li><code>Map&lt;String, TSDataType&gt; columnDataTypeMap</code>：This field is used to record the data type of each column in the result set. It's aim is to construct the header and output the result set, whose key value can contain aggregation functions.</li> <li><code>enum MeasurementType</code>：Three measurement types are recorded.  Measurements that do not exist in any device are of type <code>NonExist</code>; measurements with single or double quotes are of type<code>Constant</code>; measurements that exist are of type <code>Exist</code>.</li> <li><code>Map&lt;String, MeasurementType&gt; measurementTypeMap</code>: This field is used to record all measurement types in the query.</li> <li>groupByTimePlan, fillQueryPlan, aggregationPlan：To avoid redundancy, these three execution plans are set as subclasses of RawDataQueryPlan and set as variables in AlignByDevicePlan.  If the query plan belongs to one of these three plans, the field is assigned and saved.</li></ul> <p>Before explaining the specific implementation process, a relatively complete example is given first, and the following explanation will be used in conjunction with this example.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s1<span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s5 <span class="token keyword">FROM</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span>d1<span class="token punctuation">,</span> root<span class="token punctuation">.</span>sg<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> s1 <span class="token operator">&lt;</span> <span class="token number">25</span> ALIGN <span class="token keyword">BY</span> DEVICE
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Among them, the time series in the system is:</p> <ul><li>root.sg.d1.s1</li> <li>root.sg.d1.s2</li> <li>root.sg.d2.s1</li></ul> <p>The storage group <code>root.sg</code> contains two devices d1 and d2, where d1 has two sensors s1 and s2, d2 has only sensor s1, and the same sensor s1 has the same data type.</p> <p>The following will be explained according to the specific process:</p> <h3 id="logical-plan-generation"><a href="#logical-plan-generation" class="header-anchor">#</a> Logical plan generation</h3> <ul><li>org.apache.iotdb.db.qp.Planner</li></ul> <p>Unlike the original data query, the alignment by device query does not concatenate the suffix paths in the SELECT statement and the WHERE statement at this stage, but when the physical plan is subsequently generated, the mapping value and filter conditions corresponding to each device are calculated.</p> <p>Therefore, the work done at this stage by device alignment only includes optimization of filter conditions in WHERE statements.</p> <p>The optimization of the filtering conditions mainly includes three parts: removing the negation, transforming the disjunction paradigm, and merging the same path filtering conditions.  The corresponding optimizers are: RemoveNotOptimizer, DnfFilterOptimizer, MergeSingleFilterOptimizer.  This part of the logic can refer to:<a href="/SystemDesign/QueryEngine/Planner.html">Planner</a>.</p> <h3 id="physical-plan-generation"><a href="#physical-plan-generation" class="header-anchor">#</a> Physical plan generation</h3> <ul><li>org.apache.iotdb.db.qp.strategy.PhysicalGenerator</li></ul> <p>After the logical plan is generated, the <code>transformToPhysicalPlan ()</code> method in the PhysicalGenerator class is called to convert the logical plan into a physical plan.  For device-aligned queries, the main logic of this method is implemented in the transformQuery () method.</p> <p><strong>The main work done at this stage is to generate the corresponding</strong> <code>AlignByDevicePlan</code>，<strong>Fill in the variable information。</strong></p> <p>It splices the suffix paths obtained in the SELECT statement with the prefix paths in the FROM clause to calculate the measurements of the query including its type and data type. The calculation process is as follows:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">// Traversal suffix path</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> suffixPaths<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Path</span> suffixPath <span class="token operator">=</span> suffixPaths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Used to record the measurements corresponding to a suffix path.</span>
    <span class="token comment">// See the following for an example</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> measurementSetOfGivenSuffix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If a constant. Recording, continue to the next suffix path</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>suffixPath<span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If not constant, it will be spliced with each device to get a complete path</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> device <span class="token operator">:</span> devices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Path</span> fullPath <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">.</span><span class="token function">addPrefixPath</span><span class="token punctuation">(</span>suffixPath<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// Wildcard has been removed from the device list, but suffix paths may still contain it</span>
        <span class="token comment">// Get the actual time series paths by removing wildcards</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> actualPaths <span class="token operator">=</span> <span class="token function">getMatchedTimeseries</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If the path after splicing does not exist, it will be recognized as `NonExist` temporarily</span>
        <span class="token comment">// If the measurement exists in next devices, then override `NonExist` to `Exist`</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actualPaths<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> originAggregations<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Get data types with and without aggregate functions (actual time series) respectively</span>
        <span class="token comment">// Data type with aggregation function `columnDataTypes` is used for:</span>
        <span class="token comment">//  1. Data type consistency check 2. Header calculation, output result set</span>
        <span class="token comment">// The actual data type of the time series `measurementDataTypes` is used for</span>
        <span class="token comment">//  the actual query in the AlignByDeviceDataSet</span>
        <span class="token class-name">String</span> aggregation <span class="token operator">=</span>
            originAggregations <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>originAggregations<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">?</span> originAggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">TSDataType</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">TSDataType</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> pair <span class="token operator">=</span> <span class="token function">getSeriesTypes</span><span class="token punctuation">(</span>actualPaths<span class="token punctuation">,</span>
            aggregation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TSDataType</span><span class="token punctuation">&gt;</span></span> columnDataTypes <span class="token operator">=</span> pair<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TSDataType</span><span class="token punctuation">&gt;</span></span> measurementDataTypes <span class="token operator">=</span> pair<span class="token punctuation">.</span>right<span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> pathIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> pathIdx <span class="token operator">&lt;</span> actualPaths<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> pathIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>actualPaths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pathIdx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Check the data type consistency of the sensors with the same name</span>
          <span class="token class-name">String</span> measurementChecked<span class="token punctuation">;</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
          <span class="token class-name">TSDataType</span> columnDataType <span class="token operator">=</span> columnDataTypes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pathIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Check data type if there is a sensor with the same name</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>columnDataTypeMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>measurementChecked<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// The data types is inconsistent, an exception will be thrown. End</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>columnDataType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>columnDataTypeMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>measurementChecked<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">QueryProcessException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// There is no such measurement, it will be recorded</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// This step indicates that the measurement exists under the device and is correct,</span>
          <span class="token comment">// First, update measurementSetOfGivenSuffix which is distinct</span>
          <span class="token comment">// Then if this measurement is recognized as NonExist before，update it to Exist</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>measurementSetOfGivenSuffix<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>measurementChecked<span class="token punctuation">)</span>
              <span class="token operator">||</span> measurementTypeMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>measurementChecked<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">MeasurementType</span><span class="token punctuation">.</span><span class="token class-name">Exist</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            measurementTypeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>measurementChecked<span class="token punctuation">,</span> <span class="token class-name">MeasurementType</span><span class="token punctuation">.</span><span class="token class-name">Exist</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
          <span class="token comment">// update paths</span>
          paths<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MetadataException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LogicalOptimizeException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// update measurements</span>
    <span class="token comment">// Note that within a suffix path loop, SET is used to avoid duplicate measurements</span>
    <span class="token comment">// While a LIST is used outside the loop to ensure that the output contains all measurements entered by the user</span>
    <span class="token comment">// In the example，for suffix *, measurementSetOfGivenSuffix = {s1,s2}</span>
    <span class="token comment">// for suffix s1, measurementSetOfGivenSuffix = {s1}</span>
    <span class="token comment">// therefore the final measurements is [s1,s2,s1].</span>
    measurements<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>measurementSetOfGivenSuffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">IExpression</span><span class="token punctuation">&gt;</span></span> <span class="token function">concatFilterByDevice</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> devices<span class="token punctuation">,</span>
      <span class="token class-name">FilterOperator</span> operator<span class="token punctuation">)</span>
<span class="token class-name">Input</span>：<span class="token class-name">Deduplicated</span> devices list and un<span class="token operator">-</span>stitched <span class="token class-name">FilterOperator</span>
<span class="token class-name">Input</span>：<span class="token class-name">The</span> deviceToFilterMap after splicing records the <span class="token class-name">Filter</span> information corresponding <span class="token keyword">to</span> <span class="token namespace">each</span> device
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>concatfilterbydevice()</code> method splices the filter conditions according to the devices to get the corresponding filter conditions of each device. The main processing logic of it is in <code>concatFilterPath ()</code>:</p> <p>The <code>concatFilterPath ()</code> method traverses the unspliced FilterOperator binary tree to determine whether the node is a leaf node. If so, the path of the leaf node is taken. If the path starts with time or root, it is not processed, otherwise the device name and node are not processed.  The paths are spliced and returned; if not, all children of the node are iteratively processed.</p> <p>In the example, the result of splicing the filter conditions of device 1 is <code>time = 1 AND root.sg.d1.s1 &lt;25</code>, and device 2 is<code>time = 1 AND root.sg.d2.s1 &lt;25</code>.</p> <p>The following example summarizes the variable information calculated through this stage:</p> <ul><li>measurement list <code>measurements</code>：<code>[s1, '1', s1, s2, s2, s5]</code></li> <li>measurement type <code>measurementTypeMap</code>：
<ul><li><code>s1 -&gt; Exist</code></li> <li><code>s2 -&gt; Exist</code></li> <li><code>'1' -&gt; Constant</code></li> <li><code>s5 -&gt; NonExist</code></li></ul></li> <li>Filter condition <code>deviceToFilterMap</code> for each device:
<ul><li><code>root.sg.d1 -&gt; time = 1 AND root.sg.d1.s1 &lt; 25</code></li> <li><code>root.sg.d2 -&gt; time = 1 AND root.sg.d2.s1 &lt; 25</code></li></ul></li></ul> <h3 id="constructing-a-header-columnheader"><a href="#constructing-a-header-columnheader" class="header-anchor">#</a> Constructing a Header (ColumnHeader)</h3> <ul><li>org.apache.iotdb.db.service.TSServiceImpl</li></ul> <p>After generating the physical plan, you can execute the executeQueryStatement () method in TSServiceImpl to generate a result set and return it. The first step is to construct the header.</p> <p>Query by device alignment After calling the TSServiceImpl.getQueryColumnHeaders () method, enter TSServiceImpl.getAlignByDeviceQueryHeaders () according to the query type to construct the headers.</p> <p>The <code>getAlignByDeviceQueryHeaders ()</code> method is declared as follows:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getAlignByDeviceQueryHeaders</span><span class="token punctuation">(</span>
      <span class="token class-name">AlignByDevicePlan</span> plan<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> respColumns<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> columnTypes<span class="token punctuation">)</span>
<span class="token class-name">Input</span>：<span class="token class-name">The</span> currently executing physical plan <span class="token class-name">AlignByDevicePlan</span> and the column names that need <span class="token keyword">to</span> <span class="token namespace">be</span> output respColumns and their corresponding data types columnTypes
<span class="token class-name">Input</span>：<span class="token class-name">Calculated</span> column name respColumns and data type columnTypes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The specific implementation logic is as follows:</p> <ol><li>First add the <code>Device</code> column, whose data type is<code>TEXT</code>;</li> <li>Traverse the list of measurements without deduplication to determine the type of measurement currently traversed. If it is an <code>Exist</code> type, get its type from the <code>columnDataTypeMap</code>; set the other two types to <code>TEXT</code>, and then add measurement and its type to the header data structure.</li> <li>Deduplicate measurements based on the intermediate variable deduplicatedMeasurements.</li></ol> <p>The resulting header is:</p> <table><thead><tr><th>Time</th> <th>Device</th> <th>s1</th> <th>1</th> <th>s1</th> <th>s2</th> <th>s2</th> <th>s5</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <p>The deduplicated <code>measurements</code> are <code>[s1, '1', s2, s5]</code>.</p> <h3 id="result-set-generation"><a href="#result-set-generation" class="header-anchor">#</a> Result set generation</h3> <p>After the ColumnHeader is generated, the final step is to populate the result set with the results and return.</p> <h4 id="result-set-creation"><a href="#result-set-creation" class="header-anchor">#</a> Result set creation</h4> <ul><li>org.apache.iotdb.db.service.TSServiceImpl</li></ul> <p>At this stage, you need to call <code>TSServiceImpl.createQueryDataSet ()</code> to create a new result set. This part of the implementation logic is relatively simple. For AlignByDeviceQuery, you only need to create a new <code>AlignByDeviceDataSet</code>. In the constructor, the parameters in AlignByDevicePlan  Assign to the newly created result set.</p> <h4 id="result-set-population"><a href="#result-set-population" class="header-anchor">#</a> Result set population</h4> <ul><li>org.apache.iotdb.db.utils.QueryDataSetUtils</li></ul> <p>Next you need to fill the results. AlignByDeviceQuery will call the <code>TSServiceImpl.fillRpcReturnData ()</code> method, and then enter the <code>QueryDataSetUtils.convertQueryDataSetByFetchSize ()</code> method according to the query type.</p> <p>The important method for getting results in the <code>convertQueryDataSetByFetchSize ()</code> method is the <code>hasNext ()</code> method of QueryDataSet.</p> <p>The main logic of the <code>hasNext ()</code> method is as follows:</p> <ol><li>Determine if there is a specified row offset <code>rowOffset</code>, if there is, skip the number of rows that need to be offset; if the total number of results is less than the specified offset, return false.</li> <li>Determines whether there is a specified limit on the number of rows <code>rowLimit</code>, if there is, it compares the current number of output rows, and returns false if the current number of output rows is greater than the limit.</li> <li>Enter <code>AlignByDeviceDataSet.hasNextWithoutConstraint ()</code> method</li></ol> <br> <ul><li>org.apache.iotdb.db.query.dataset.AlignByDeviceDataSet</li></ul> <p>First explain the meaning of the important fields in the result set:</p> <ul><li><code>deviceIterator</code>: Query by device is essentially to calculate the mapping value and filtering conditions corresponding to each device, and then the query is performed separately for each device. This field is an iterator for the device. Each query obtains a device to perform.</li> <li><code>currentDataSet</code>：This field represents the result set obtained by querying a certain device.</li></ul> <p>The work done by the <code>hasNextWithoutConstraint ()</code> method is mainly to determine whether the current result set has the next result, if not, the next device is obtained, the path, data type and filter conditions required by the device to execute the query are calculated, and then executed according to its query type  The result set is obtained after a specific query plan, until no device is available for querying.</p> <p>The specific implementation logic is as follows:</p> <ol><li>First determine whether the current result set is initialized and there is a next result. If it is, it returns true directly, that is, you can call the <code>next()</code> method to get the next <code>RowRecord</code>; otherwise, the result set is not initialized and proceeds to step 2.</li> <li>Iterate <code>deviceIterator</code> to get the devices needed for this execution, and then find the device node from MManger by the device path to get all sensor nodes under it.</li> <li>Compare all measurements in the query and the sensor nodes under the current device to get the <code>executeColumns</code> which need to be queried. Then concatenate the current device name and measurements to calculate the query path, data type, and filter conditions of the current device. The corresponding fields are <code>executePaths</code>,<code>tsDataTypes</code>, and <code>expression</code>. If it is an aggregate query, you need to calculate <code>executeAggregations</code>.</li> <li>Determine whether the current subquery type is GroupByQuery, AggregationQuery, FillQuery or RawDataQuery. Perform the corresponding query and return the result set. The implementation logic <a href="/SystemDesign/DataQuery/RawDataQuery.html">Raw data query</a>，<a href="/SystemDesign/DataQuery/AggregationQuery.html">Aggregate query</a>，<a href="/SystemDesign/DataQuery/GroupByQuery.html">Downsampling query</a> can be referenced.</li></ol> <p>After initializing the result set through the <code>hasNextWithoutConstraint ()</code> method and ensuring that there is a next result, you can call <code>QueryDataSet.next ()</code> method to get the next <code>RowRecord</code>.</p> <p>The <code>next ()</code> method is mainly implemented as the <code>AlignByDeviceDataSet.nextWithoutConstraint ()</code> method.</p> <p>The work done by the <code>nextWithoutConstraint ()</code> method is to ** transform the time-aligned result set form obtained by a single device query into a device-aligned result set form **, and return the transformed <code>RowRecord</code>.</p> <p>The specific implementation logic is as follows:</p> <ol><li>First get the next time-aligned <code>originRowRecord</code> from the result set.</li> <li>Create a new <code>RowRecord</code> with timestamp, add device columns to it, and first create a Map structure<code>currentColumnMap</code> of <code>measurementName-&gt; Field</code> according to<code>executeColumns</code> and the obtained result.</li> <li>After that, you only need to traverse the deduplicated <code>measurements</code> list to determine its type. If the type is<code>Exist</code>, get the corresponding result from the <code>currentColumnMap</code> according to the measurementName. If not, set it to<code>null</code>; if it is <code>NonExist</code>Type is set to<code>null</code> directly; if it is <code>Constant</code> type,<code>measureName</code> is used as the value of this column.</li></ol> <p>After writing the output data stream according to the transformed <code>RowRecord</code>, the result set can be returned.</p></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SystemDesign/DataQuery/LastQuery.html" class="prev">
          LastQuery
        </a></span> <span class="next"><a href="/SystemDesign/DataQuery/FillFunction.html">
          FillFunction
        </a>
        →
      </span></p></div> <p style="text-align: center;">Copyright © 2020 The Apache Software Foundation.<br>
     Apache and the Apache feather logo are trademarks of The Apache Software Foundation</p> <p style="text-align: center; margin-top: 10px; color: #444">
    Contact us: Join QQ Group 659990460 | Add friend <i>tietouqiao</i> and be invited to Wechat Group<br>
    see <a href="https://github.com/apache/iotdb/issues/1995">Join the community</a> for more</p></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cdf3999a.js" defer></script><script src="/assets/js/3.588efd8d.js" defer></script><script src="/assets/js/31.726da8fb.js" defer></script>
  </body>
</html>