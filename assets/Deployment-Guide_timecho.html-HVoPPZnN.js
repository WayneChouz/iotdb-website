import{_ as s,r,o as l,c,a as u,d as e,e as t,b as n,w as i,f as o}from"./app-s_ajYnY6.js";const h={},p=e("h1",{id:"deployment-guide",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#deployment-guide","aria-hidden":"true"},"#"),t(" Deployment Guide")],-1),m=e("h2",{id:"stand-alone-deployment",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#stand-alone-deployment","aria-hidden":"true"},"#"),t(" Stand-Alone Deployment")],-1),f=e("h3",{id:"prerequisites",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#prerequisites","aria-hidden":"true"},"#"),t(" Prerequisites")],-1),g=e("p",null,"To use IoTDB, you need to have:",-1),b=e("ol",null,[e("li",null,"Java >= 1.8 (Please make sure the environment path has been set)"),e("li",null,'Set the max open files num as 65535 to avoid "too many open files" problem.')],-1),v=e("h3",{id:"installation",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#installation","aria-hidden":"true"},"#"),t(" Installation")],-1),_=e("p",null,"IoTDB provides you three installation methods, you can refer to the following suggestions, choose one of them:",-1),y=e("li",null,"Installation from source code. If you need to modify the code yourself, you can use this method.",-1),x=e("li",null,"Installation from binary files. Download the binary files from the official website. This is the recommended method, in which you will get a binary released package which is out-of-the-box.",-1),k={href:"https://github.com/apache/iotdb/blob/master/docker/src/main",target:"_blank",rel:"noopener noreferrer"},w=e("h3",{id:"download",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#download","aria-hidden":"true"},"#"),t(" Download")],-1),N=e("br",null,null,-1),C={href:"https://iotdb.apache.org/Download/",target:"_blank",rel:"noopener noreferrer"},D=o('<h3 id="configurations" tabindex="-1"><a class="header-anchor" href="#configurations" aria-hidden="true">#</a> Configurations</h3><p>Configuration files are under &quot;conf&quot; folder</p><ul><li>environment config module (<code>datanode-env.bat</code>, <code>datanode-env.sh</code>),</li><li>system config module (<code>iotdb-datanode.properties</code>)</li><li>log config module (<code>logback.xml</code>).</li></ul>',3),I=o(`<h3 id="start" tabindex="-1"><a class="header-anchor" href="#start" aria-hidden="true">#</a> Start</h3><p>You can go through the following step to test the installation, if there is no error after execution, the installation is completed.</p><h4 id="start-iotdb" tabindex="-1"><a class="header-anchor" href="#start-iotdb" aria-hidden="true">#</a> Start IoTDB</h4><p>IoTDB is a database based on distributed system. To launch IoTDB, you can first start standalone mode (i.e. 1 ConfigNode and 1 DataNode) to check.</p><p>Users can start IoTDB standalone mode by the start-standalone script under the sbin folder.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Unix/OS X
&gt; bash sbin/start-standalone.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Windows
&gt; sbin\\start-standalone.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Note: Currently, To run standalone mode, you need to ensure that all addresses are set to 127.0.0.1, If you need to access the IoTDB from a machine different from the one where the IoTDB is located, please change the configuration item <code>dn_rpc_address</code> to the IP of the machine where the IoTDB lives. And replication factors set to 1, which is by now the default setting.<br> Besides, it&#39;s recommended to use SimpleConsensus in this mode, since it brings additional efficiency.</p><h2 id="cluster-deployment-cluster-management-tool" tabindex="-1"><a class="header-anchor" href="#cluster-deployment-cluster-management-tool" aria-hidden="true">#</a> Cluster deployment(Cluster management tool)</h2><p>The IoTDB cluster management tool is an easy-to-use operation and maintenance tool (enterprise version tool).<br> It is designed to solve the operation and maintenance problems of multiple nodes in the IoTDB distributed system.<br> It mainly includes cluster deployment, cluster start and stop, elastic expansion, configuration update, data export and other functions, thereby realizing one-click command issuance for complex database clusters, which greatly Reduce management difficulty.<br> This document will explain how to remotely deploy, configure, start and stop IoTDB cluster instances with cluster management tools.</p><h3 id="environment-dependence" tabindex="-1"><a class="header-anchor" href="#environment-dependence" aria-hidden="true">#</a> Environment dependence</h3><p>This tool is a supporting tool for TimechoDB(Enterprise Edition based on IoTDB). You can contact your sales representative to obtain the tool download method.</p><p>The machine where IoTDB is to be deployed needs to rely on jdk 8 and above, lsof, netstat, and unzip functions. If not, please install them yourself. You can refer to the installation commands required for the environment in the last section of the document.</p><p>Tip: The IoTDB cluster management tool requires an account with root privileges</p><h3 id="deployment-method" tabindex="-1"><a class="header-anchor" href="#deployment-method" aria-hidden="true">#</a> Deployment method</h3><h4 id="download-and-install" tabindex="-1"><a class="header-anchor" href="#download-and-install" aria-hidden="true">#</a> Download and install</h4><p>This tool is a supporting tool for TimechoDB(Enterprise Edition based on IoTDB). You can contact your salesperson to obtain the tool download method.</p><p>Note: Since the binary package only supports GLIBC2.17 and above, the minimum version is Centos7.</p><ul><li>After entering the following commands in the iotd directory:</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">bash</span> install-iotd.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The iotd keyword can be activated in the subsequent shell, such as checking the environment instructions required before deployment as follows:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster check example
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>You can also directly use &lt;iotd absolute path&gt;/sbin/iotd without activating iotd to execute commands, such as checking the environment required before deployment:</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&lt;</span>iotd absolute path<span class="token operator">&gt;</span>/sbin/iotd cluster check example
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="introduction-to-cluster-configuration-files" tabindex="-1"><a class="header-anchor" href="#introduction-to-cluster-configuration-files" aria-hidden="true">#</a> Introduction to cluster configuration files</h3><ul><li>There is a cluster configuration yaml file in the <code>iotd/config</code> directory. The yaml file name is the cluster name. There can be multiple yaml files. In order to facilitate users to configure yaml files, a <code>default_cluster.yaml</code> example is provided under the iotd/config directory.</li><li>The yaml file configuration consists of five major parts: <code>global</code>, <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana_server</code>, and <code>prometheus_server</code></li><li><code>global</code> is a general configuration that mainly configures machine username and password, IoTDB local installation files, Jdk configuration, etc. A <code>default_cluster.yaml</code> sample data is provided in the <code>iotd/config</code> directory,<br> Users can copy and modify it to their own cluster name and refer to the instructions inside to configure the IoTDB cluster. In the <code>default_cluster.yaml</code> sample, all uncommented items are required, and those that have been commented are non-required.</li></ul><p>例如要执行<code>default_cluster.yaml</code>检查命令则需要执行命令<code>iotd cluster check default_cluster</code>即可，<br> 更多详细命令请参考下面命令列表。</p>`,27),T=e("thead",null,[e("tr",null,[e("th",null,"parameter name"),e("th",null,"parameter describe"),e("th",null,"required")])],-1),S=e("tr",null,[e("td",null,"iotdb_zip_dir"),e("td",null,[t("IoTDB deployment distribution directory, if the value is empty, it will be downloaded from the address specified by "),e("code",null,"iotdb_download_url")]),e("td",null,"NO")],-1),B=e("tr",null,[e("td",null,"iotdb_download_url"),e("td",null,[t("IoTDB download address, if "),e("code",null,"iotdb_zip_dir"),t(" has no value, download from the specified address")]),e("td",null,"NO")],-1),O=e("tr",null,[e("td",null,"jdk_tar_dir"),e("td",null,"jdk local directory, you can use this jdk path to upload and deploy to the target node."),e("td",null,"NO")],-1),E=e("tr",null,[e("td",null,"jdk_deploy_dir"),e("td",null,[t("jdk remote machine deployment directory, jdk will be deployed to this directory, and the following "),e("code",null,"jdk_dir_name"),t(" parameter forms a complete jdk deployment directory, that is, "),e("code",null,"<jdk_deploy_dir>/<jdk_dir_name>")]),e("td",null,"NO")],-1),R=e("tr",null,[e("td",null,"jdk_dir_name"),e("td",null,"The directory name after jdk decompression defaults to jdk_iotdb"),e("td",null,"NO")],-1),F=e("tr",null,[e("td",null,"iotdb_lib_dir"),e("td",null,"The IoTDB lib directory or the IoTDB lib compressed package only supports .zip format and is only used for IoTDB upgrade. It is in the comment state by default. If you need to upgrade, please open the comment and modify the path. If you use a zip file, please use the zip command to compress the iotdb/lib directory, such as zip -r lib.zip apache-iotdb-1.2.0/lib/* d"),e("td",null,"NO")],-1),P=e("tr",null,[e("td",null,"user"),e("td",null,"User name for ssh login deployment machine"),e("td",null,"YES")],-1),q=e("tr",null,[e("td",null,"password"),e("td",null,"The password for ssh login. If the password does not specify the use of pkey to log in, please ensure that the ssh login between nodes has been configured without a key."),e("td",null,"NO")],-1),Y=e("tr",null,[e("td",null,"pkey"),e("td",null,"Key login: If password has a value, password is used first, otherwise pkey is used to log in."),e("td",null,"NO")],-1),j=e("tr",null,[e("td",null,"ssh_port"),e("td",null,"ssh port"),e("td",null,"YES")],-1),A=e("tr",null,[e("td",null,"deploy_dir"),e("td",null,[t("IoTDB deployment directory, IoTDB will be deployed to this directory and the following "),e("code",null,"iotdb_dir_name"),t(" parameter will form a complete IoTDB deployment directory, that is, "),e("code",null,"<deploy_dir>/<iotdb_dir_name>")]),e("td",null,"YES")],-1),V=e("tr",null,[e("td",null,"iotdb_dir_name"),e("td",null,"The directory name after decompression of IoTDB is iotdb by default."),e("td",null,"NO")],-1),G={href:"http://datanode-env.sh",target:"_blank",rel:"noopener noreferrer"},L=e("td",null,[t("Corresponding to "),e("code",null,"iotdb/config/datanode-env.sh"),t(", when "),e("code",null,"global"),t(" and "),e("code",null,"confignode_servers"),t(" are configured at the same time, the value in "),e("code",null,"confignode_servers"),t(" is used first")],-1),U=e("td",null,"NO",-1),z={href:"http://confignode-env.sh",target:"_blank",rel:"noopener noreferrer"},W=e("td",null,[t("Corresponding to "),e("code",null,"iotdb/config/confignode-env.sh"),t(", the value in "),e("code",null,"datanode_servers"),t(" is used first when "),e("code",null,"global"),t(" and "),e("code",null,"datanode_servers"),t(" are configured at the same time")],-1),M=e("td",null,"NO",-1),J=e("tr",null,[e("td",null,"iotdb-common.properties"),e("td",null,[t("Corresponds to "),e("code",null,"<iotdb path>/config/iotdb-common.properties")]),e("td",null,"NO")],-1),X=e("tr",null,[e("td",null,"cn_target_config_node_list"),e("td",null,[t("The cluster configuration address points to the surviving ConfigNode, and it points to confignode_x by default. When "),e("code",null,"global"),t(" and "),e("code",null,"confignode_servers"),t(" are configured at the same time, the value in "),e("code",null,"confignode_servers"),t(" is used first, corresponding to "),e("code",null,"cn_target_config_node_list"),t(" in "),e("code",null,"iotdb/config/iotdb-confignode.properties")]),e("td",null,"YES")],-1),K=e("tr",null,[e("td",null,"dn_target_config_node_list"),e("td",null,[t("The cluster configuration address points to the surviving ConfigNode, and points to confignode_x by default. When configuring values for "),e("code",null,"global"),t(" and "),e("code",null,"datanode_servers"),t(" at the same time, the value in "),e("code",null,"datanode_servers"),t(" is used first, corresponding to "),e("code",null,"dn_target_config_node_list"),t(" in "),e("code",null,"iotdb/config/iotdb-datanode.properties")]),e("td",null,"YES")],-1),H={href:"http://datanode-env.sh",target:"_blank",rel:"noopener noreferrer"},Q={href:"http://confignode-env.sh",target:"_blank",rel:"noopener noreferrer"},$={href:"http://datanode-env.sh",target:"_blank",rel:"noopener noreferrer"},Z={href:"http://confignode-env.sh",target:"_blank",rel:"noopener noreferrer"},ee=e("br",null,null,-1),te={href:"http://datanode-env.sh",target:"_blank",rel:"noopener noreferrer"},ne=e("br",null,null,-1),de=e("br",null,null,-1),oe=e("br",null,null,-1),ae=o(`<ul><li><code>confignode_servers</code> is the configuration for deploying IoTDB Confignodes, in which multiple Confignodes can be configured<br> By default, the first started ConfigNode node node1 is regarded as the Seed-ConfigNode</li></ul><table><thead><tr><th>parameter name</th><th>parameter describe</th><th>required</th></tr></thead><tbody><tr><td>name</td><td>Confignode name</td><td>YES</td></tr><tr><td>deploy_dir</td><td>IoTDB config node deployment directory</td><td>YES｜</td></tr><tr><td>iotdb-confignode.properties</td><td>Corresponding to <code>iotdb/config/iotdb-confignode.properties</code>, please refer to the <code>iotdb-confignode.properties</code> file description for more details.</td><td>NO</td></tr><tr><td>cn_internal_address</td><td>Corresponds to iotdb/internal communication address, corresponding to <code>cn_internal_address</code> in <code>iotdb/config/iotdb-confignode.properties</code></td><td>YES</td></tr><tr><td>cn_target_config_node_list</td><td>The cluster configuration address points to the surviving ConfigNode, and it points to confignode_x by default. When <code>global</code> and <code>confignode_servers</code> are configured at the same time, the value in <code>confignode_servers</code> is used first, corresponding to <code>cn_target_config_node_list</code> in <code>iotdb/config/iotdb-confignode.properties</code></td><td>YES</td></tr><tr><td>cn_internal_port</td><td>Internal communication port, corresponding to <code>cn_internal_port</code> in <code>iotdb/config/iotdb-confignode.properties</code></td><td>YES</td></tr><tr><td>cn_consensus_port</td><td>Corresponds to <code>cn_consensus_port</code> in <code>iotdb/config/iotdb-confignode.properties</code></td><td>NO</td></tr><tr><td>cn_data_dir</td><td>Corresponds to <code>cn_consensus_port</code> in <code>iotdb/config/iotdb-confignode.properties</code> Corresponds to <code>cn_data_dir</code> in <code>iotdb/config/iotdb-confignode.properties</code></td><td>YES</td></tr><tr><td>iotdb-common.properties</td><td>Corresponding to <code>iotdb/config/iotdb-common.properties</code>, when configuring values in <code>global</code> and <code>confignode_servers</code> at the same time, the value in confignode_servers will be used first.</td><td>NO</td></tr></tbody></table><ul><li>datanode_servers 是部署IoTDB Datanodes配置，里面可以配置多个Datanode</li></ul><table><thead><tr><th>parameter name</th><th>parameter describe</th><th>required</th></tr></thead><tbody><tr><td>name</td><td>Datanode name</td><td>YES</td></tr><tr><td>deploy_dir</td><td>IoTDB data node deployment directory</td><td>YES</td></tr><tr><td>iotdb-datanode.properties</td><td>Corresponding to <code>iotdb/config/iotdb-datanode.properties</code>, please refer to the <code>iotdb-datanode.properties</code> file description for more details.</td><td>NO</td></tr><tr><td>dn_rpc_address</td><td>The datanode rpc address corresponds to <code>dn_rpc_address</code> in <code>iotdb/config/iotdb-datanode.properties</code></td><td>YES</td></tr><tr><td>dn_internal_address</td><td>Internal communication address, corresponding to <code>dn_internal_address</code> in <code>iotdb/config/iotdb-datanode.properties</code></td><td>YES</td></tr><tr><td>dn_target_config_node_list</td><td>The cluster configuration address points to the surviving ConfigNode, and points to confignode_x by default. When configuring values for <code>global</code> and <code>datanode_servers</code> at the same time, the value in <code>datanode_servers</code> is used first, corresponding to <code>dn_target_config_node_list</code> in <code>iotdb/config/iotdb-datanode.properties</code>.</td><td>YES</td></tr><tr><td>dn_rpc_port</td><td>Datanode rpc port address, corresponding to <code>dn_rpc_port</code> in <code>iotdb/config/iotdb-datanode.properties</code></td><td>YES</td></tr><tr><td>dn_internal_port</td><td>Internal communication port, corresponding to <code>dn_internal_port</code> in <code>iotdb/config/iotdb-datanode.properties</code></td><td>YES</td></tr><tr><td>iotdb-common.properties</td><td>Corresponding to <code>iotdb/config/iotdb-common.properties</code>, when configuring values in <code>global</code> and <code>datanode_servers</code> at the same time, the value in <code>datanode_servers</code> will be used first.</td><td>NO</td></tr></tbody></table><ul><li>grafana_server is the configuration related to deploying Grafana</li></ul><table><thead><tr><th>parameter name</th><th>parameter describe</th><th>required</th></tr></thead><tbody><tr><td>grafana_dir_name</td><td>Grafana decompression directory name(default grafana_iotdb)</td><td>NO</td></tr><tr><td>host</td><td>Server ip deployed by grafana</td><td>YES</td></tr><tr><td>grafana_port</td><td>The port of grafana deployment machine, default 3000</td><td>NO</td></tr><tr><td>deploy_dir</td><td>grafana deployment server directory</td><td>YES</td></tr><tr><td>grafana_tar_dir</td><td>Grafana compressed package location</td><td>YES</td></tr><tr><td>dashboards</td><td>dashboards directory</td><td>NO</td></tr></tbody></table><ul><li>prometheus_server 是部署Prometheus 相关配置</li></ul><table><thead><tr><th>parameter name</th><th>parameter describe</th><th>required</th></tr></thead><tbody><tr><td>prometheus_dir_name</td><td>prometheus decompression directory name, default prometheus_iotdb</td><td>NO</td></tr><tr><td>host</td><td>Server IP deployed by prometheus</td><td>YES</td></tr><tr><td>prometheus_port</td><td>The port of prometheus deployment machine, default 9090</td><td>NO</td></tr><tr><td>deploy_dir</td><td>prometheus deployment server directory</td><td>YES</td></tr><tr><td>prometheus_tar_dir</td><td>prometheus compressed package path</td><td>YES</td></tr><tr><td>storage_tsdb_retention_time</td><td>The number of days to save data is 15 days by default</td><td>NO</td></tr><tr><td>storage_tsdb_retention_size</td><td>The data size that can be saved by the specified block defaults to 512M. Please note the units are KB, MB, GB, TB, PB, and EB.</td><td>NO</td></tr></tbody></table><p>If metrics are configured in <code>iotdb-datanode.properties</code> and <code>iotdb-confignode.properties</code> of config/xxx.yaml, the configuration will be automatically put into promethues without manual modification.</p><p>Note: How to configure the value corresponding to the yaml key to contain special characters such as: etc. It is recommended to use double quotes for the entire value, and do not use paths containing spaces in the corresponding file paths to prevent abnormal recognition problems.</p><h3 id="scenes-to-be-used" tabindex="-1"><a class="header-anchor" href="#scenes-to-be-used" aria-hidden="true">#</a> scenes to be used</h3><h4 id="clean-data" tabindex="-1"><a class="header-anchor" href="#clean-data" aria-hidden="true">#</a> Clean data</h4><ul><li>Cleaning up the cluster data scenario will delete the data directory in the IoTDB cluster and <code>cn_system_dir</code>, <code>cn_consensus_dir</code>, <code>cn_consensus_dir</code> configured in the yaml file<br><code>dn_data_dirs</code>, <code>dn_consensus_dir</code>, <code>dn_system_dir</code>, <code>logs</code> and <code>ext</code> directories.</li><li>First execute the stop cluster command, and then execute the cluster cleanup command.</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster stop default_cluster
iotd cluster clean default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cluster-destruction" tabindex="-1"><a class="header-anchor" href="#cluster-destruction" aria-hidden="true">#</a> Cluster destruction</h4><ul><li>The cluster destruction scenario will delete <code>data</code>, <code>cn_system_dir</code>, <code>cn_consensus_dir</code>, in the IoTDB cluster<br><code>dn_data_dirs</code>, <code>dn_consensus_dir</code>, <code>dn_system_dir</code>, <code>logs</code>, <code>ext</code>, <code>IoTDB</code> deployment directory,<br> grafana deployment directory and prometheus deployment directory.</li><li>First execute the stop cluster command, and then execute the cluster destruction command.</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster stop default_cluster
iotd cluster destroy default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cluster-upgrade" tabindex="-1"><a class="header-anchor" href="#cluster-upgrade" aria-hidden="true">#</a> Cluster upgrade</h4><ul><li>To upgrade the cluster, you first need to configure <code>iotdb_lib_dir</code> in config/xxx.yaml as the directory path where the jar to be uploaded to the server is located (for example, iotdb/lib).</li><li>If you use zip files to upload, please use the zip command to compress the iotdb/lib directory, such as zip -r lib.zip apache-iotdb-1.2.0/lib/*</li><li>Execute the upload command and then execute the restart IoTDB cluster command to complete the cluster upgrade.</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster upgrade default_cluster
iotd cluster restart default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="hot-deployment" tabindex="-1"><a class="header-anchor" href="#hot-deployment" aria-hidden="true">#</a> hot deployment</h4><ul><li>First modify the configuration in config/xxx.yaml.</li><li>Execute the distribution command, and then execute the hot deployment command to complete the hot deployment of the cluster configuration</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster distribute default_cluster
iotd cluster reload default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cluster-expansion" tabindex="-1"><a class="header-anchor" href="#cluster-expansion" aria-hidden="true">#</a> Cluster expansion</h4><ul><li>First modify and add a datanode or confignode node in config/xxx.yaml.</li><li>Execute the cluster expansion command</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster scaleout default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="cluster-scaling" tabindex="-1"><a class="header-anchor" href="#cluster-scaling" aria-hidden="true">#</a> Cluster scaling</h4><ul><li>First find the node name or ip+port to shrink in config/xxx.yaml (where confignode port is cn_internal_port, datanode port is rpc_port)</li><li>Execute cluster shrink command</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster scalein default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="using-cluster-management-tools-to-manipulate-existing-iotdb-clusters" tabindex="-1"><a class="header-anchor" href="#using-cluster-management-tools-to-manipulate-existing-iotdb-clusters" aria-hidden="true">#</a> Using cluster management tools to manipulate existing IoTDB clusters</h4><ul><li>Configure the server&#39;s <code>user</code>, <code>passwod</code> or <code>pkey</code>, <code>ssh_port</code></li><li>Modify the IoTDB deployment path in config/xxx.yaml, <code>deploy_dir</code> (IoTDB deployment directory), <code>iotdb_dir_name</code> (IoTDB decompression directory name, the default is iotdb)<br> For example, if the full path of IoTDB deployment is <code>/home/data/apache-iotdb-1.1.1</code>, you need to modify the yaml files <code>deploy_dir:/home/data/</code> and <code>iotdb_dir_name:apache-iotdb-1.1.1</code></li><li>If the server is not using java_home, modify <code>jdk_deploy_dir</code> (jdk deployment directory) and <code>jdk_dir_name</code> (the directory name after jdk decompression, the default is jdk_iotdb). If java_home is used, there is no need to modify the configuration.<br> For example, the full path of jdk deployment is <code>/home/data/jdk_1.8.2</code>, you need to modify the yaml files <code>jdk_deploy_dir:/home/data/</code>, <code>jdk_dir_name:jdk_1.8.2</code></li><li>Configure <code>cn_target_config_node_list</code>, <code>dn_target_config_node_list</code></li><li>Configure <code>cn_internal_address</code>, <code>cn_internal_port</code>, <code>cn_consensus_port</code>, <code>cn_system_dir</code>, in <code>iotdb-confignode.properties</code> in <code>confignode_servers</code><br> If the values in <code>cn_consensus_dir</code> and <code>iotdb-common.properties</code> are not the default for IoTDB, they need to be configured, otherwise there is no need to configure them.</li><li>Configure <code>dn_rpc_address</code>, <code>dn_internal_address</code>, <code>dn_data_dirs</code>, <code>dn_consensus_dir</code>, <code>dn_system_dir</code> and <code>iotdb-common.properties</code> in <code>iotdb-datanode.properties</code> in <code>datanode_servers</code></li><li>Execute initialization command</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster init default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="deploy-iotdb-grafana-and-prometheus" tabindex="-1"><a class="header-anchor" href="#deploy-iotdb-grafana-and-prometheus" aria-hidden="true">#</a> Deploy IoTDB, Grafana and Prometheus</h4><ul><li>Configure <code>iotdb-datanode.properties</code>, <code>iotdb-confignode.properties</code> to open the metrics interface</li><li>Configure the Grafana configuration. If there are multiple <code>dashboards</code>, separate them with commas. The names cannot be repeated or they will be overwritten.</li><li>Configure the Prometheus configuration. If the IoTDB cluster is configured with metrics, there is no need to manually modify the Prometheus configuration. The Prometheus configuration will be automatically modified according to which node is configured with metrics.</li><li>Start the cluster</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster start default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For more detailed parameters, please refer to the cluster configuration file introduction above</p><h3 id="command" tabindex="-1"><a class="header-anchor" href="#command" aria-hidden="true">#</a> Command</h3><p>The basic usage of this tool is:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>cluster name<span class="token operator">&gt;</span> <span class="token punctuation">[</span>params <span class="token punctuation">(</span>Optional<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>key indicates a specific command.</p></li><li><p>cluster name indicates the cluster name (that is, the name of the yaml file in the <code>iotd/config</code> file).</p></li><li><p>params indicates the required parameters of the command (optional).</p></li><li><p>For example, the command format to deploy the default_cluster cluster is:</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster deploy default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>The functions and parameters of the cluster are listed as follows:</li></ul><table><thead><tr><th>command</th><th>description</th><th>parameter</th></tr></thead><tbody><tr><td>check</td><td>check whether the cluster can be deployed</td><td>Cluster name list</td></tr><tr><td>clean</td><td>cleanup-cluster</td><td>cluster-name</td></tr><tr><td>deploy</td><td>deploy cluster</td><td>Cluster name, -N, module name (optional for iotdb, grafana, prometheus), -op force (optional)</td></tr><tr><td>list</td><td>cluster status list</td><td>None</td></tr><tr><td>start</td><td>start cluster</td><td>Cluster name, -N, node name (nodename, grafana, prometheus optional)</td></tr><tr><td>stop</td><td>stop cluster</td><td>Cluster name, -N, node name (nodename, grafana, prometheus optional), -op force (nodename, grafana, prometheus optional)</td></tr><tr><td>restart</td><td>restart cluster</td><td>Cluster name, -N, node name (nodename, grafana, prometheus optional), -op force (nodename, grafana, prometheus optional)</td></tr><tr><td>show</td><td>view cluster information. The details field indicates the details of the cluster information.</td><td>Cluster name, details (optional)</td></tr><tr><td>destroy</td><td>destroy cluster</td><td>Cluster name, -N, module name (iotdb, grafana, prometheus optional)</td></tr><tr><td>scaleout</td><td>cluster expansion</td><td>Cluster name</td></tr><tr><td>scalein</td><td>cluster shrink</td><td>Cluster name, -N, cluster node name or cluster node ip+port</td></tr><tr><td>reload</td><td>hot loading of cluster configuration files</td><td>Cluster name</td></tr><tr><td>distribute</td><td>cluster configuration file distribution</td><td>Cluster name</td></tr><tr><td>dumplog</td><td>Back up specified cluster logs</td><td>Cluster name, -N, cluster node name -h Back up to target machine ip -pw Back up to target machine password -p Back up to target machine port -path Backup directory -startdate Start time -enddate End time -loglevel Log type -l transfer speed</td></tr><tr><td>dumpdata</td><td>Backup cluster data</td><td>Cluster name, -h backup to target machine ip -pw backup to target machine password -p backup to target machine port -path backup directory -startdate start time -enddate end time -l transmission speed</td></tr><tr><td>upgrade</td><td>lib package upgrade</td><td>Cluster name</td></tr><tr><td>init</td><td>When an existing cluster uses the cluster deployment tool, initialize the cluster configuration</td><td>Cluster name</td></tr><tr><td>status</td><td>View process status</td><td>Cluster name</td></tr></tbody></table><h3 id="detailed-command-execution-process" tabindex="-1"><a class="header-anchor" href="#detailed-command-execution-process" aria-hidden="true">#</a> Detailed command execution process</h3><p>The following commands are executed using default_cluster.yaml as an example, and users can modify them to their own cluster files to execute</p><h4 id="check-cluster-deployment-environment-commands" tabindex="-1"><a class="header-anchor" href="#check-cluster-deployment-environment-commands" aria-hidden="true">#</a> Check cluster deployment environment commands</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster check default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Verify that the target node is able to log in via SSH</p></li><li><p>Verify whether the JDK version on the corresponding node meets IoTDB jdk1.8 and above, and whether the server is installed with unzip, lsof, and netstat.</p></li><li><p>If you see the following prompt <code>Info:example check successfully!</code>, it proves that the server has already met the installation requirements.<br> If <code>Error:example check fail!</code> is output, it proves that some conditions do not meet the requirements. You can check the Error log output above (for example: <code>Error:Server (ip:172.20.31.76) iotdb port(10713) is listening</code>) to make repairs. ,<br> If the jdk check does not meet the requirements, we can configure a jdk1.8 or above version in the yaml file ourselves for deployment without affecting subsequent use.<br> If checking lsof, netstat or unzip does not meet the requirements, you need to install it on the server yourself.</p></li></ul><h4 id="deploy-cluster-command" tabindex="-1"><a class="header-anchor" href="#deploy-cluster-command" aria-hidden="true">#</a> Deploy cluster command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster deploy default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Upload IoTDB compressed package and jdk compressed package according to the node information in <code>confignode_servers</code> and <code>datanode_servers</code> (if <code>jdk_tar_dir</code> and <code>jdk_deploy_dir</code> values ​​are configured in yaml)</p></li><li><p>Generate and upload <code>iotdb-common.properties</code>, <code>iotdb-confignode.properties</code>, <code>iotdb-datanode.properties</code> according to the yaml file node configuration information</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster deploy default_cluster <span class="token parameter variable">-op</span> force
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Note: This command will force the deployment, and the specific process will delete the existing deployment directory and redeploy</p><p><em>deploy a single module</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Deploy grafana module</span>
iotd cluster deploy default_cluster <span class="token parameter variable">-N</span> grafana
<span class="token comment"># Deploy the prometheus module</span>
iotd cluster deploy default_cluster <span class="token parameter variable">-N</span> prometheus
<span class="token comment"># Deploy the iotdb module</span>
iotd cluster deploy default_cluster <span class="token parameter variable">-N</span> iotdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="start-cluster-command" tabindex="-1"><a class="header-anchor" href="#start-cluster-command" aria-hidden="true">#</a> Start cluster command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster start default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Start confignode, start sequentially according to the order in <code>confignode_servers</code> in the yaml configuration file and check whether the confignode is normal according to the process id, the first confignode is seek config</p></li><li><p>Start the datanode in sequence according to the order in <code>datanode_servers</code> in the yaml configuration file and check whether the datanode is normal according to the process id.</p></li><li><p>After checking the existence of the process according to the process id, check whether each service in the cluster list is normal through the cli. If the cli link fails, retry every 10s until it succeeds and retry up to 5 times</p></li><li></li></ul><p>Start a single node command*</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#Start according to the IoTDB node name</span>
iotd cluster start default_cluster <span class="token parameter variable">-N</span> datanode_1
<span class="token comment">#Start according to IoTDB cluster ip+port, where port corresponds to cn_internal_port of confignode and rpc_port of datanode.</span>
iotd cluster start default_cluster <span class="token parameter variable">-N</span> <span class="token number">192.168</span>.1.5:6667
<span class="token comment">#Start grafana</span>
iotd cluster start default_cluster <span class="token parameter variable">-N</span> grafana
<span class="token comment">#Start prometheus</span>
iotd cluster start default_cluster <span class="token parameter variable">-N</span> prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location based on cluster-name</p></li><li><p>Find the node location information based on the provided node name or ip:port. If the started node is <code>data_node</code>, the ip uses <code>dn_rpc_address</code> in the yaml file, and the port uses <code>dn_rpc_port</code> in datanode_servers in the yaml file.<br> If the started node is <code>config_node</code>, the ip uses <code>cn_internal_address</code> in confignode_servers in the yaml file, and the port uses <code>cn_internal_port</code></p></li><li><p>start the node</p></li></ul>`,61),ie={href:"http://start-confignode.sh",target:"_blank",rel:"noopener noreferrer"},re={href:"http://start-datanode.sh",target:"_blank",rel:"noopener noreferrer"},se=e("br",null,null,-1),le=o(`<h4 id="view-iotdb-cluster-status-command" tabindex="-1"><a class="header-anchor" href="#view-iotdb-cluster-status-command" aria-hidden="true">#</a> View IoTDB cluster status command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster show default_cluster
<span class="token comment">#View IoTDB cluster details</span>
iotd cluster show default_cluster details
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Execute <code>show cluster details</code> through cli on datanode in turn. If one node is executed successfully, it will not continue to execute cli on subsequent nodes and return the result directly.</p></li></ul><h4 id="stop-cluster-command" tabindex="-1"><a class="header-anchor" href="#stop-cluster-command" aria-hidden="true">#</a> Stop cluster command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster stop default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>According to the datanode node information in <code>datanode_servers</code>, stop the datanode nodes in order according to the configuration.</p></li><li><p>Based on the confignode node information in <code>confignode_servers</code>, stop the confignode nodes in sequence according to the configuration</p></li></ul><p><em>force stop cluster command</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster stop default_cluster <span class="token parameter variable">-op</span> force
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Will directly execute the kill -9 pid command to forcibly stop the cluster</p><p><em>Stop single node command</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#Stop by IoTDB node name</span>
iotd cluster stop default_cluster <span class="token parameter variable">-N</span> datanode_1
<span class="token comment">#Stop according to IoTDB cluster ip+port (ip+port is to get the only node according to ip+dn_rpc_port in datanode or ip+cn_internal_port in confignode to get the only node)</span>
iotd cluster stop default_cluster <span class="token parameter variable">-N</span> <span class="token number">192.168</span>.1.5:6667
<span class="token comment">#Stop grafana</span>
iotd cluster stop default_cluster <span class="token parameter variable">-N</span> grafana
<span class="token comment">#Stop prometheus</span>
iotd cluster stop default_cluster <span class="token parameter variable">-N</span> prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location based on cluster-name</p></li><li><p>Find the corresponding node location information based on the provided node name or ip:port. If the stopped node is <code>data_node</code>, the ip uses <code>dn_rpc_address</code> in the yaml file, and the port uses <code>dn_rpc_port</code> in datanode_servers in the yaml file.<br> If the stopped node is <code>config_node</code>, the ip uses <code>cn_internal_address</code> in confignode_servers in the yaml file, and the port uses <code>cn_internal_port</code></p></li><li><p>stop the node</p></li></ul>`,12),ce={href:"http://stop-confignode.sh",target:"_blank",rel:"noopener noreferrer"},ue={href:"http://stop-datanode.sh",target:"_blank",rel:"noopener noreferrer"},he=o(`<h4 id="clean-cluster-data-command" tabindex="-1"><a class="header-anchor" href="#clean-cluster-data-command" aria-hidden="true">#</a> Clean cluster data command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster clean default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Based on the information in <code>confignode_servers</code> and <code>datanode_servers</code>, check whether there are still services running,<br> If any service is running, the cleanup command will not be executed.</p></li><li><p>Delete the data directory in the IoTDB cluster and the <code>cn_system_dir</code>, <code>cn_consensus_dir</code>, configured in the yaml file<br><code>dn_data_dirs</code>, <code>dn_consensus_dir</code>, <code>dn_system_dir</code>, <code>logs</code> and <code>ext</code> directories.</p></li></ul><h4 id="restart-cluster-command" tabindex="-1"><a class="header-anchor" href="#restart-cluster-command" aria-hidden="true">#</a> Restart cluster command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster restart default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana</code> and <code>prometheus</code></p></li><li><p>Execute the above stop cluster command (stop), and then execute the start cluster command (start). For details, refer to the above start and stop commands.</p></li></ul><p><em>Force restart cluster command</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster restart default_cluster <span class="token parameter variable">-op</span> force
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Will directly execute the kill -9 pid command to force stop the cluster, and then start the cluster</p><p><em>Restart a single node command</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#Restart datanode_1 according to the IoTDB node name</span>
iotd cluster restart default_cluster <span class="token parameter variable">-N</span> datanode_1
<span class="token comment">#Restart confignode_1 according to the IoTDB node name</span>
iotd cluster restart default_cluster <span class="token parameter variable">-N</span> confignode_1
<span class="token comment">#Restart grafana</span>
iotd cluster restart default_cluster <span class="token parameter variable">-N</span> grafana
<span class="token comment">#Restart prometheus</span>
iotd cluster restart default_cluster <span class="token parameter variable">-N</span> prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cluster-shrink-command" tabindex="-1"><a class="header-anchor" href="#cluster-shrink-command" aria-hidden="true">#</a> Cluster shrink command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#Scale down by node name</span>
iotd cluster scalein default_cluster <span class="token parameter variable">-N</span> nodename
<span class="token comment">#Scale down according to ip+port (ip+port obtains the only node according to ip+dn_rpc_port in datanode, and obtains the only node according to ip+cn_internal_port in confignode)</span>
iotd cluster scalein default_cluster <span class="token parameter variable">-N</span> ip:port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Determine whether there is only one confignode node and datanode to be reduced. If there is only one left, the reduction cannot be performed.</p></li><li><p>Then get the node information to shrink according to ip:port or nodename, execute the shrink command, and then destroy the node directory. If the shrink node is <code>data_node</code>, use <code>dn_rpc_address</code> in the yaml file for ip, and use <code>dn_rpc_address</code> in the port. <code>dn_rpc_port</code> in datanode_servers in yaml file.<br> If the shrinking node is <code>config_node</code>, the ip uses <code>cn_internal_address</code> in confignode_servers in the yaml file, and the port uses <code>cn_internal_port</code></p></li></ul><p>Tip: Currently, only one node scaling is supported at a time</p><h4 id="cluster-expansion-command" tabindex="-1"><a class="header-anchor" href="#cluster-expansion-command" aria-hidden="true">#</a> Cluster expansion command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster scaleout default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Modify the config/xxx.yaml file to add a datanode node or confignode node</p></li><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Find the node to be expanded, upload the IoTDB compressed package and jdb package (if the <code>jdk_tar_dir</code> and <code>jdk_deploy_dir</code> values ​​are configured in yaml) and decompress it</p></li><li><p>Generate and upload <code>iotdb-common.properties</code>, <code>iotdb-confignode.properties</code> or <code>iotdb-datanode.properties</code> according to the yaml file node configuration information</p></li><li><p>Execute the command to start the node and verify whether the node is started successfully</p></li></ul><p>Tip: Currently, only one node expansion is supported at a time</p><h4 id="destroy-cluster-command" tabindex="-1"><a class="header-anchor" href="#destroy-cluster-command" aria-hidden="true">#</a> destroy cluster command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster destroy default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>cluster-name finds the yaml file in the default location</p></li><li><p>Check whether the node is still running based on the node node information in <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana</code>, and <code>prometheus</code>.<br> Stop the destroy command if any node is running</p></li><li><p>Delete <code>data</code> in the IoTDB cluster and <code>cn_system_dir</code>, <code>cn_consensus_dir</code> configured in the yaml file<br><code>dn_data_dirs</code>, <code>dn_consensus_dir</code>, <code>dn_system_dir</code>, <code>logs</code>, <code>ext</code>, <code>IoTDB</code> deployment directory,<br> grafana deployment directory and prometheus deployment directory</p></li></ul><p><em>Destroy a single module</em></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Destroy grafana module</span>
iotd cluster destroy default_cluster <span class="token parameter variable">-N</span> grafana
<span class="token comment"># Destroy prometheus module</span>
iotd cluster destroy default_cluster <span class="token parameter variable">-N</span> prometheus
<span class="token comment"># Destroy iotdb module</span>
iotd cluster destroy default_cluster <span class="token parameter variable">-N</span> iotdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="distribute-cluster-configuration-commands" tabindex="-1"><a class="header-anchor" href="#distribute-cluster-configuration-commands" aria-hidden="true">#</a> Distribute cluster configuration commands</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster distribute default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana</code> and <code>prometheus</code></p></li><li><p>Generate and upload <code>iotdb-common.properties</code>, <code>iotdb-confignode.properties</code>, <code>iotdb-datanode.properties</code> to the specified node according to the node configuration information of the yaml file</p></li></ul><h4 id="hot-load-cluster-configuration-command" tabindex="-1"><a class="header-anchor" href="#hot-load-cluster-configuration-command" aria-hidden="true">#</a> Hot load cluster configuration command</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster reload default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Execute <code>load configuration</code> in the cli according to the node configuration information of the yaml file.</p></li></ul><h4 id="cluster-node-log-backup" tabindex="-1"><a class="header-anchor" href="#cluster-node-log-backup" aria-hidden="true">#</a> Cluster node log backup</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster dumplog default_cluster <span class="token parameter variable">-N</span> datanode_1,confignode_1  <span class="token parameter variable">-startdate</span> <span class="token string">&#39;2023-04-11&#39;</span> <span class="token parameter variable">-enddate</span> <span class="token string">&#39;2023-04-26&#39;</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.9.48 <span class="token parameter variable">-p</span> <span class="token number">36000</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-pw</span> root <span class="token parameter variable">-path</span> <span class="token string">&#39;/iotdb/logs&#39;</span> <span class="token parameter variable">-logs</span> <span class="token string">&#39;/root/data/db/iotdb/logs&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location based on cluster-name</p></li><li><p>This command will verify the existence of datanode_1 and confignode_1 according to the yaml file, and then back up the log data of the specified node datanode_1 and confignode_1 to the specified service <code>192.168.9.48</code> port <code>36000 according to the configured start and end dates (startdate&lt;=logtime&lt;=enddate) </code> The data backup path is <code>/iotdb/logs</code>, and the IoTDB log storage path is <code>/root/data/db/iotdb/logs</code> (not required, if you do not fill in -logs xxx, the default is to backup logs from the IoTDB installation path /logs )</p></li></ul><table><thead><tr><th>command</th><th>description</th><th>required</th></tr></thead><tbody><tr><td>-h</td><td>backup data server ip</td><td>NO</td></tr><tr><td>-u</td><td>backup data server username</td><td>NO</td></tr><tr><td>-pw</td><td>backup data machine password</td><td>NO</td></tr><tr><td>-p</td><td>backup data machine port(default 22)</td><td>NO</td></tr><tr><td>-path</td><td>path to backup data (default current path)</td><td>NO</td></tr><tr><td>-loglevel</td><td>Log levels include all, info, error, warn (default is all)</td><td>NO</td></tr><tr><td>-l</td><td>speed limit (default 1024 speed limit range 0 to 104857601 unit Kbit/s)</td><td>NO</td></tr><tr><td>-N</td><td>multiple configuration file cluster names are separated by commas.</td><td>YES</td></tr><tr><td>-startdate</td><td>start time (including default 1970-01-01)</td><td>NO</td></tr><tr><td>-enddate</td><td>end time (included)</td><td>NO</td></tr><tr><td>-logs</td><td>IoTDB log storage path, the default is ({iotdb}/logs)）</td><td>NO</td></tr></tbody></table><h4 id="cluster-data-backup" tabindex="-1"><a class="header-anchor" href="#cluster-data-backup" aria-hidden="true">#</a> Cluster data backup</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster dumpdata default_cluster <span class="token parameter variable">-granularity</span> partition  <span class="token parameter variable">-startdate</span> <span class="token string">&#39;2023-04-11&#39;</span> <span class="token parameter variable">-enddate</span> <span class="token string">&#39;2023-04-26&#39;</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.9.48 <span class="token parameter variable">-p</span> <span class="token number">36000</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-pw</span> root <span class="token parameter variable">-path</span> <span class="token string">&#39;/iotdb/datas&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>This command will obtain the leader node based on the yaml file, and then back up the data to the /iotdb/datas directory on the 192.168.9.48 service based on the start and end dates (startdate&lt;=logtime&lt;=enddate)</li></ul><table><thead><tr><th>command</th><th>description</th><th>required</th></tr></thead><tbody><tr><td>-h</td><td>backup data server ip</td><td>NO</td></tr><tr><td>-u</td><td>backup data server username</td><td>NO</td></tr><tr><td>-pw</td><td>backup data machine password</td><td>NO</td></tr><tr><td>-p</td><td>backup data machine port(default 22)</td><td>NO</td></tr><tr><td>-path</td><td>path to backup data (default current path)</td><td>NO</td></tr><tr><td>-granularity</td><td>partition</td><td>YES</td></tr><tr><td>-l</td><td>speed limit (default 1024 speed limit range 0 to 104857601 unit Kbit/s)</td><td>NO</td></tr><tr><td>-startdate</td><td>start time (including default 1970-01-01)</td><td>YES</td></tr><tr><td>-enddate</td><td>end time (included)</td><td>YES</td></tr></tbody></table><h4 id="cluster-upgrade-1" tabindex="-1"><a class="header-anchor" href="#cluster-upgrade-1" aria-hidden="true">#</a> Cluster upgrade</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster upgrade default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code> and <code>datanode_servers</code></p></li><li><p>Upload lib package</p></li></ul><p>Note that after performing the upgrade, please restart IoTDB for it to take effect.</p><h4 id="cluster-initialization" tabindex="-1"><a class="header-anchor" href="#cluster-initialization" aria-hidden="true">#</a> Cluster initialization</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster init default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana</code> and <code>prometheus</code></li><li>Initialize cluster configuration</li></ul><h4 id="view-cluster-process-status" tabindex="-1"><a class="header-anchor" href="#view-cluster-process-status" aria-hidden="true">#</a> View cluster process status</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iotd cluster status default_cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Find the yaml file in the default location according to cluster-name and obtain the configuration information of <code>confignode_servers</code>, <code>datanode_servers</code>, <code>grafana</code> and <code>prometheus</code></li><li>Display the survival status of each node in the cluster</li></ul><h3 id="introduction-to-cluster-deployment-tool-samples" tabindex="-1"><a class="header-anchor" href="#introduction-to-cluster-deployment-tool-samples" aria-hidden="true">#</a> Introduction to Cluster Deployment Tool Samples</h3><p>In the cluster deployment tool installation directory config/example, there are three yaml examples. If necessary, you can copy them to config and modify them.</p><table><thead><tr><th>name</th><th>description</th></tr></thead><tbody><tr><td>default_1c1d.yaml</td><td>1 confignode and 1 datanode configuration example</td></tr><tr><td>default_3c3d.yaml</td><td>3 confignode and 3 datanode configuration samples</td></tr><tr><td>default_3c3d_grafa_prome</td><td>3 confignode and 3 datanode, Grafana, Prometheus configuration examples</td></tr></tbody></table><h2 id="manual-deployment" tabindex="-1"><a class="header-anchor" href="#manual-deployment" aria-hidden="true">#</a> Manual Deployment</h2><h3 id="prerequisites-1" tabindex="-1"><a class="header-anchor" href="#prerequisites-1" aria-hidden="true">#</a> Prerequisites</h3><ol><li>JDK&gt;=1.8.</li><li>Max open file 65535.</li><li>Disable the swap memory.</li><li>Ensure that data/confignode directory has been cleared when starting ConfigNode for the first time,<br> and data/datanode directory has been cleared when starting DataNode for the first time</li><li>Turn off the firewall of the server if the entire cluster is in a trusted environment.</li><li>By default, IoTDB Cluster will use ports 10710, 10720 for the ConfigNode and<br> 6667, 10730, 10740, 10750 and 10760 for the DataNode.<br> Please make sure those ports are not occupied, or you will modify the ports in configuration files.</li></ol><h3 id="get-the-installation-package" tabindex="-1"><a class="header-anchor" href="#get-the-installation-package" aria-hidden="true">#</a> Get the Installation Package</h3><p>You can either download the binary release files (see Chap 3.1) or compile with source code (see Chap 3.2).</p><h4 id="download-the-binary-distribution" tabindex="-1"><a class="header-anchor" href="#download-the-binary-distribution" aria-hidden="true">#</a> Download the binary distribution</h4>`,57),pe={href:"https://iotdb.apache.org/Download/",target:"_blank",rel:"noopener noreferrer"},me=e("li",null,"Download the binary distribution.",-1),fe=e("li",null,"Decompress to get the apache-iotdb-1.0.0-all-bin directory.",-1),ge=o(`<h4 id="compile-with-source-code" tabindex="-1"><a class="header-anchor" href="#compile-with-source-code" aria-hidden="true">#</a> Compile with source code</h4><h5 id="download-the-source-code" tabindex="-1"><a class="header-anchor" href="#download-the-source-code" aria-hidden="true">#</a> Download the source code</h5><p><strong>Git</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git clone https://github.com/apache/iotdb.git
git checkout v1.0.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Website</strong></p>`,5),be={href:"https://iotdb.apache.org/Download/",target:"_blank",rel:"noopener noreferrer"},ve=e("li",null,"Download the source code.",-1),_e=e("li",null,"Decompress to get the apache-iotdb-1.0.0 directory.",-1),ye=o(`<h5 id="compile-source-code" tabindex="-1"><a class="header-anchor" href="#compile-source-code" aria-hidden="true">#</a> Compile source code</h5><p>Under the source root folder:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mvn clean package -pl distribution -am -DskipTests
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Then you will get the binary distribution under<br><strong>distribution/target/apache-iotdb-1.0.0-SNAPSHOT-all-bin/apache-iotdb-1.0.0-SNAPSHOT-all-bin</strong>.</p><h3 id="binary-distribution-content" tabindex="-1"><a class="header-anchor" href="#binary-distribution-content" aria-hidden="true">#</a> Binary Distribution Content</h3><table><thead><tr><th><strong>Folder</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>conf</td><td>Configuration files folder, contains configuration files of ConfigNode, DataNode, JMX and logback</td></tr><tr><td>data</td><td>Data files folder, contains data files of ConfigNode and DataNode</td></tr><tr><td>lib</td><td>Jar files folder</td></tr><tr><td>licenses</td><td>Licenses files folder</td></tr><tr><td>logs</td><td>Logs files folder, contains logs files of ConfigNode and DataNode</td></tr><tr><td>sbin</td><td>Shell files folder, contains start/stop/remove shell of ConfigNode and DataNode, cli shell</td></tr><tr><td>tools</td><td>System tools</td></tr></tbody></table><h3 id="cluster-installation-and-configuration" tabindex="-1"><a class="header-anchor" href="#cluster-installation-and-configuration" aria-hidden="true">#</a> Cluster Installation and Configuration</h3><h4 id="cluster-installation" tabindex="-1"><a class="header-anchor" href="#cluster-installation" aria-hidden="true">#</a> Cluster Installation</h4><p><code>apache-iotdb-1.0.0-SNAPSHOT-all-bin</code> contains both the ConfigNode and the DataNode.<br> Please deploy the files to all servers of your target cluster.<br> A best practice is deploying the files into the same directory in all servers.</p>`,9),xe=e("br",null,null,-1),ke=o('<h4 id="cluster-configuration" tabindex="-1"><a class="header-anchor" href="#cluster-configuration" aria-hidden="true">#</a> Cluster Configuration</h4><p>We need to modify the configurations on each server.<br> Therefore, login each server and switch the working directory to <code>apache-iotdb-1.0.0-SNAPSHOT-all-bin</code>.<br> The configuration files are stored in the <code>./conf</code> directory.</p><p>For all ConfigNode servers, we need to modify the common configuration (see Chap 5.2.1)<br> and ConfigNode configuration (see Chap 5.2.2).</p><p>For all DataNode servers, we need to modify the common configuration (see Chap 5.2.1)<br> and DataNode configuration (see Chap 5.2.3).</p><h5 id="common-configuration" tabindex="-1"><a class="header-anchor" href="#common-configuration" aria-hidden="true">#</a> Common configuration</h5>',5),we=e("br",null,null,-1),Ne=e("br",null,null,-1),Ce=o('<table><thead><tr><th><strong>Configuration</strong></th><th><strong>Description</strong></th><th><strong>Default</strong></th></tr></thead><tbody><tr><td>cluster_name</td><td>Cluster name for which the Node to join in</td><td>defaultCluster</td></tr><tr><td>config_node_consensus_protocol_class</td><td>Consensus protocol of ConfigNode</td><td>org.apache.iotdb.consensus.ratis.RatisConsensus</td></tr><tr><td>schema_replication_factor</td><td>Schema replication factor, no more than DataNode number</td><td>1</td></tr><tr><td>schema_region_consensus_protocol_class</td><td>Consensus protocol of schema replicas</td><td>org.apache.iotdb.consensus.ratis.RatisConsensus</td></tr><tr><td>data_replication_factor</td><td>Data replication factor, no more than DataNode number</td><td>1</td></tr><tr><td>data_region_consensus_protocol_class</td><td>Consensus protocol of data replicas. Note that RatisConsensus currently does not support multiple data directories</td><td>org.apache.iotdb.consensus.iot.IoTConsensus</td></tr></tbody></table><p><strong>Notice: The preceding configuration parameters cannot be changed after the cluster is started. Ensure that the common configurations of all Nodes are the same. Otherwise, the Nodes cannot be started.</strong></p><h5 id="confignode-configuration" tabindex="-1"><a class="header-anchor" href="#confignode-configuration" aria-hidden="true">#</a> ConfigNode configuration</h5><p>Open the ConfigNode configuration file ./conf/iotdb-confignode.properties,<br> and set the following parameters based on the IP address and available port of the server or VM:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Description</strong></th><th><strong>Default</strong></th><th><strong>Usage</strong></th></tr></thead><tbody><tr><td>cn_internal_address</td><td>Internal rpc service address of ConfigNode</td><td>127.0.0.1</td><td>Set to the IPV4 address or domain name of the server</td></tr><tr><td>cn_internal_port</td><td>Internal rpc service port of ConfigNode</td><td>10710</td><td>Set to any unoccupied port</td></tr><tr><td>cn_consensus_port</td><td>ConfigNode replication consensus protocol communication port</td><td>10720</td><td>Set to any unoccupied port</td></tr><tr><td>cn_target_config_node_list</td><td>ConfigNode address to which the node is connected when it is registered to the cluster. Note that Only one ConfigNode can be configured.</td><td>127.0.0.1:10710</td><td>For Seed-ConfigNode, set to its own cn_internal_address:cn_internal_port; For other ConfigNodes, set to other one running ConfigNode&#39;s cn_internal_address:cn_internal_port</td></tr></tbody></table><p><strong>Notice: The preceding configuration parameters cannot be changed after the node is started. Ensure that all ports are not occupied. Otherwise, the Node cannot be started.</strong></p><h5 id="datanode-configuration" tabindex="-1"><a class="header-anchor" href="#datanode-configuration" aria-hidden="true">#</a> DataNode configuration</h5><p>Open the DataNode configuration file ./conf/iotdb-datanode.properties,<br> and set the following parameters based on the IP address and available port of the server or VM:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Description</strong></th><th><strong>Default</strong></th><th><strong>Usage</strong></th></tr></thead><tbody><tr><td>dn_rpc_address</td><td>Client RPC Service address</td><td>127.0.0.1</td><td>Set to the IPV4 address or domain name of the server</td></tr><tr><td>dn_rpc_port</td><td>Client RPC Service port</td><td>6667</td><td>Set to any unoccupied port</td></tr><tr><td>dn_internal_address</td><td>Control flow address of DataNode inside cluster</td><td>127.0.0.1</td><td>Set to the IPV4 address or domain name of the server</td></tr><tr><td>dn_internal_port</td><td>Control flow port of DataNode inside cluster</td><td>10730</td><td>Set to any unoccupied port</td></tr><tr><td>dn_mpp_data_exchange_port</td><td>Data flow port of DataNode inside cluster</td><td>10740</td><td>Set to any unoccupied port</td></tr><tr><td>dn_data_region_consensus_port</td><td>Data replicas communication port for consensus</td><td>10750</td><td>Set to any unoccupied port</td></tr><tr><td>dn_schema_region_consensus_port</td><td>Schema replicas communication port for consensus</td><td>10760</td><td>Set to any unoccupied port</td></tr><tr><td>dn_target_config_node_list</td><td>Running ConfigNode of the Cluster</td><td>127.0.0.1:10710</td><td>Set to any running ConfigNode&#39;s cn_internal_address:cn_internal_port. You can set multiple values, separate them with commas(&quot;,&quot;)</td></tr></tbody></table><p><strong>Notice: The preceding configuration parameters cannot be changed after the node is started. Ensure that all ports are not occupied. Otherwise, the Node cannot be started.</strong></p><h3 id="cluster-operation" tabindex="-1"><a class="header-anchor" href="#cluster-operation" aria-hidden="true">#</a> Cluster Operation</h3><h4 id="starting-the-cluster" tabindex="-1"><a class="header-anchor" href="#starting-the-cluster" aria-hidden="true">#</a> Starting the cluster</h4><p>This section describes how to start a cluster that includes several ConfigNodes and DataNodes.<br> The cluster can provide services only by starting at least one ConfigNode<br> and no less than the number of data/schema_replication_factor DataNodes.</p><p>The total process are three steps:</p><ul><li>Start the Seed-ConfigNode</li><li>Add ConfigNode (Optional)</li><li>Add DataNode</li></ul><h5 id="start-the-seed-confignode" tabindex="-1"><a class="header-anchor" href="#start-the-seed-confignode" aria-hidden="true">#</a> Start the Seed-ConfigNode</h5><p><strong>The first Node started in the cluster must be ConfigNode. The first started ConfigNode must follow the tutorial in this section.</strong></p><p>The first ConfigNode to start is the Seed-ConfigNode, which marks the creation of the new cluster.<br> Before start the Seed-ConfigNode, please open the common configuration file ./conf/iotdb-common.properties and check the following parameters:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>cluster_name</td><td>Is set to the expected name</td></tr><tr><td>config_node_consensus_protocol_class</td><td>Is set to the expected consensus protocol</td></tr><tr><td>schema_replication_factor</td><td>Is set to the expected schema replication count</td></tr><tr><td>schema_region_consensus_protocol_class</td><td>Is set to the expected consensus protocol</td></tr><tr><td>data_replication_factor</td><td>Is set to the expected data replication count</td></tr><tr><td>data_region_consensus_protocol_class</td><td>Is set to the expected consensus protocol</td></tr></tbody></table>',19),De=e("strong",null,"Notice:",-1),Ie=e("br",null,null,-1),Te=o(`<p>Then open its configuration file ./conf/iotdb-confignode.properties and check the following parameters:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>cn_internal_address</td><td>Is set to the IPV4 address or domain name of the server</td></tr><tr><td>cn_internal_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>cn_consensus_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>cn_target_config_node_list</td><td>Is set to its own internal communication address, which is cn_internal_address:cn_internal_port</td></tr></tbody></table><p>After checking, you can run the startup script on the server:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux foreground
bash ./sbin/start-confignode.sh

# Linux background
nohup bash ./sbin/start-confignode.sh &gt;/dev/null 2&gt;&amp;1 &amp;

# Windows
.\\sbin\\start-confignode.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Se=e("br",null,null,-1),Be=o(`<h5 id="add-more-confignodes-optional" tabindex="-1"><a class="header-anchor" href="#add-more-confignodes-optional" aria-hidden="true">#</a> Add more ConfigNodes (Optional)</h5><p><strong>The ConfigNode who isn&#39;t the first one started must follow the tutorial in this section.</strong></p><p>You can add more ConfigNodes to the cluster to ensure high availability of ConfigNodes.<br> A common configuration is to add extra two ConfigNodes to make the cluster has three ConfigNodes.</p><p>Ensure that all configuration parameters in the ./conf/iotdb-common.properites are the same as those in the Seed-ConfigNode;<br> otherwise, it may fail to start or generate runtime errors.<br> Therefore, please check the following parameters in common configuration file:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>cluster_name</td><td>Is consistent with the Seed-ConfigNode</td></tr><tr><td>config_node_consensus_protocol_class</td><td>Is consistent with the Seed-ConfigNode</td></tr><tr><td>schema_replication_factor</td><td>Is consistent with the Seed-ConfigNode</td></tr><tr><td>schema_region_consensus_protocol_class</td><td>Is consistent with the Seed-ConfigNode</td></tr><tr><td>data_replication_factor</td><td>Is consistent with the Seed-ConfigNode</td></tr><tr><td>data_region_consensus_protocol_class</td><td>Is consistent with the Seed-ConfigNode</td></tr></tbody></table><p>Then, please open its configuration file ./conf/iotdb-confignode.properties and check the following parameters:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>cn_internal_address</td><td>Is set to the IPV4 address or domain name of the server</td></tr><tr><td>cn_internal_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>cn_consensus_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>cn_target_config_node_list</td><td>Is set to the internal communication address of an other running ConfigNode. The internal communication address of the seed ConfigNode is recommended.</td></tr></tbody></table><p>After checking, you can run the startup script on the server:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux foreground
bash ./sbin/start-confignode.sh

# Linux background
nohup bash ./sbin/start-confignode.sh &gt;/dev/null 2&gt;&amp;1 &amp;

# Windows
.\\sbin\\start-confignode.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),Oe=e("br",null,null,-1),Ee=o(`<h5 id="start-datanode" tabindex="-1"><a class="header-anchor" href="#start-datanode" aria-hidden="true">#</a> Start DataNode</h5><p><strong>Before adding DataNodes, ensure that there exists at least one ConfigNode is running in the cluster.</strong></p><p>You can add any number of DataNodes to the cluster.<br> Before adding a new DataNode,</p><p>please open its common configuration file ./conf/iotdb-common.properties and check the following parameters:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>cluster_name</td><td>Is consistent with the Seed-ConfigNode</td></tr></tbody></table><p>Then open its configuration file ./conf/iotdb-datanode.properties and check the following parameters:</p><table><thead><tr><th><strong>Configuration</strong></th><th><strong>Check</strong></th></tr></thead><tbody><tr><td>dn_rpc_address</td><td>Is set to the IPV4 address or domain name of the server</td></tr><tr><td>dn_rpc_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>dn_internal_address</td><td>Is set to the IPV4 address or domain name of the server</td></tr><tr><td>dn_internal_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>dn_mpp_data_exchange_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>dn_data_region_consensus_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>dn_schema_region_consensus_port</td><td>The port isn&#39;t occupied</td></tr><tr><td>dn_target_config_node_list</td><td>Is set to the internal communication address of other running ConfigNodes. The internal communication address of the seed ConfigNode is recommended.</td></tr></tbody></table><p>After checking, you can run the startup script on the server:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux foreground
bash ./sbin/start-datanode.sh

# Linux background
nohup bash ./sbin/start-datanode.sh &gt;/dev/null 2&gt;&amp;1 &amp;

# Windows
.\\sbin\\start-datanode.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),Re=e("br",null,null,-1),Fe=o(`<p><strong>Notice: The cluster can provide services only if the number of its DataNodes is no less than the number of replicas(max{schema_replication_factor, data_replication_factor}).</strong></p><h4 id="start-cli" tabindex="-1"><a class="header-anchor" href="#start-cli" aria-hidden="true">#</a> Start Cli</h4><p>If the cluster is in local environment, you can directly run the Cli startup script in the ./sbin directory:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
./sbin/start-cli.sh

# Windows
.\\sbin\\start-cli.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Pe=e("br",null,null,-1),qe=o(`<h4 id="verify-cluster" tabindex="-1"><a class="header-anchor" href="#verify-cluster" aria-hidden="true">#</a> Verify Cluster</h4><p>Use a 3C3D(3 ConfigNodes and 3 DataNodes) as an example.<br> Assumed that the IP addresses of the 3 ConfigNodes are 192.168.1.10, 192.168.1.11 and 192.168.1.12, and the default ports 10710 and 10720 are used.<br> Assumed that the IP addresses of the 3 DataNodes are 192.168.1.20, 192.168.1.21 and 192.168.1.22, and the default ports 6667, 10730, 10740, 10750 and 10760 are used.</p><p>After starting the cluster successfully according to chapter 6.1, you can run the <code>show cluster details</code> command on the Cli, and you will see the following results:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>IoTDB&gt; show cluster details
+------+----------+-------+---------------+------------+-------------------+------------+-------+-------+-------------------+-----------------+
|NodeID|  NodeType| Status|InternalAddress|InternalPort|ConfigConsensusPort|  RpcAddress|RpcPort|MppPort|SchemaConsensusPort|DataConsensusPort|
+------+----------+-------+---------------+------------+-------------------+------------+-------+-------+-------------------+-----------------+
|     0|ConfigNode|Running|   192.168.1.10|       10710|              10720|            |       |       |                   |                 |
|     2|ConfigNode|Running|   192.168.1.11|       10710|              10720|            |       |       |                   |                 |
|     3|ConfigNode|Running|   192.168.1.12|       10710|              10720|            |       |       |                   |                 |
|     1|  DataNode|Running|   192.168.1.20|       10730|                   |192.168.1.20|   6667|  10740|              10750|            10760|
|     4|  DataNode|Running|   192.168.1.21|       10730|                   |192.168.1.21|   6667|  10740|              10750|            10760|
|     5|  DataNode|Running|   192.168.1.22|       10730|                   |192.168.1.22|   6667|  10740|              10750|            10760|
+------+----------+-------+---------------+------------+-------------------+------------+-------+-------+-------------------+-----------------+
Total line number = 6
It costs 0.012s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If the status of all Nodes is <strong>Running</strong>, the cluster deployment is successful.<br> Otherwise, read the run logs of the Node that fails to start and<br> check the corresponding configuration parameters.</p><h4 id="stop-iotdb" tabindex="-1"><a class="header-anchor" href="#stop-iotdb" aria-hidden="true">#</a> Stop IoTDB</h4><p>This section describes how to manually shut down the ConfigNode or DataNode process of the IoTDB.</p><h5 id="stop-confignode-by-script" tabindex="-1"><a class="header-anchor" href="#stop-confignode-by-script" aria-hidden="true">#</a> Stop ConfigNode by script</h5><p>Run the stop ConfigNode script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
./sbin/stop-confignode.sh

# Windows
.\\sbin\\stop-confignode.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="stop-datanode-by-script" tabindex="-1"><a class="header-anchor" href="#stop-datanode-by-script" aria-hidden="true">#</a> Stop DataNode by script</h5><p>Run the stop DataNode script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
./sbin/stop-datanode.sh

# Windows
.\\sbin\\stop-datanode.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="kill-node-process" tabindex="-1"><a class="header-anchor" href="#kill-node-process" aria-hidden="true">#</a> Kill Node process</h5><p>Get the process number of the Node:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>jps

# or

ps aux | grep iotdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kill the process：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>kill -9 &lt;pid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Notice Some ports require root access, in which case use sudo</strong></p><h4 id="shrink-the-cluster" tabindex="-1"><a class="header-anchor" href="#shrink-the-cluster" aria-hidden="true">#</a> Shrink the Cluster</h4><p>This section describes how to remove ConfigNode or DataNode from the cluster.</p><h5 id="remove-confignode" tabindex="-1"><a class="header-anchor" href="#remove-confignode" aria-hidden="true">#</a> Remove ConfigNode</h5><p>Before removing a ConfigNode, ensure that there is at least one active ConfigNode in the cluster after the removal.<br> Run the remove-confignode script on an active ConfigNode:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
# Remove the ConfigNode with confignode_id
./sbin/remove-confignode.sh &lt;confignode_id&gt;

# Remove the ConfigNode with address:port
./sbin/remove-confignode.sh &lt;cn_internal_address&gt;:&lt;cn_internal_port&gt;


# Windows
# Remove the ConfigNode with confignode_id
.\\sbin\\remove-confignode.bat &lt;confignode_id&gt;

# Remove the ConfigNode with address:port
.\\sbin\\remove-confignode.bat &lt;cn_internal_address&gt;:&lt;cn_internal_portcn_internal_port&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="remove-datanode" tabindex="-1"><a class="header-anchor" href="#remove-datanode" aria-hidden="true">#</a> Remove DataNode</h5><p>Before removing a DataNode, ensure that the cluster has at least the number of data/schema replicas DataNodes.<br> Run the remove-datanode script on an active DataNode:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Linux
# Remove the DataNode with datanode_id
./sbin/remove-datanode.sh &lt;datanode_id&gt;

# Remove the DataNode with rpc address:port
./sbin/remove-datanode.sh &lt;dn_rpc_address&gt;:&lt;dn_rpc_port&gt;


# Windows
# Remove the DataNode with datanode_id
.\\sbin\\remove-datanode.bat &lt;datanode_id&gt;

# Remove the DataNode with rpc address:port
.\\sbin\\remove-datanode.bat &lt;dn_rpc_address&gt;:&lt;dn_rpc_port&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="faq" tabindex="-1"><a class="header-anchor" href="#faq" aria-hidden="true">#</a> FAQ</h3>`,28);function Ye(je,Ae){const a=r("RouterLink"),d=r("ExternalLinkIcon");return l(),c("div",null,[u(`

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at
    
        http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

`),p,m,e("p",null,[t("This short guide will walk you through the basic process of using IoTDB. For a more-complete guide, please visit our website's "),n(a,{to:"/UserGuide/V1.2.x/IoTDB-Introduction/What-is-IoTDB.html"},{default:i(()=>[t("User Guide")]),_:1}),t(".")]),f,g,b,v,_,e("ul",null,[y,x,e("li",null,[t("Using Docker：The path to the dockerfile is "),e("a",k,[t("github"),n(d)])])]),w,e("p",null,[t("You can download the binary file from:"),N,e("a",C,[t("Download Page"),n(d)])]),D,e("p",null,[t("For more, see "),n(a,{to:"/UserGuide/V1.2.x/Reference/DataNode-Config-Manual.html"},{default:i(()=>[t("Config")]),_:1}),t(" in detail.")]),I,e("table",null,[T,e("tbody",null,[S,B,O,E,R,F,P,q,Y,j,A,V,e("tr",null,[e("td",null,[e("a",G,[t("datanode-env.sh"),n(d)])]),L,U]),e("tr",null,[e("td",null,[e("a",z,[t("confignode-env.sh"),n(d)])]),W,M]),J,X,K])]),e("p",null,[t("Among them, "),e("a",H,[t("datanode-env.sh"),n(d)]),t(" and "),e("a",Q,[t("confignode-env.sh"),n(d)]),t(" can be configured with extra parameters extra_opts. When this parameter is configured, corresponding values will be appended after "),e("a",$,[t("datanode-env.sh"),n(d)]),t(" and "),e("a",Z,[t("confignode-env.sh"),n(d)]),t(". Refer to default_cluster.yaml for configuration examples as follows:"),ee,e("a",te,[t("datanode-env.sh"),n(d)]),t(":"),ne,t(" extra_opts: |"),de,t(' IOTDB_JMX_OPTS="$IOTDB_JMX_OPTS -XX:+UseG1GC"'),oe,t(' IOTDB_JMX_OPTS="$IOTDB_JMX_OPTS -XX:MaxGCPauseMillis=200"')]),ae,e("p",null,[t("Note: Since the cluster deployment tool only calls the "),e("a",ie,[t("start-confignode.sh"),n(d)]),t(" and "),e("a",re,[t("start-datanode.sh"),n(d)]),t(" scripts in the IoTDB cluster,"),se,t(" When the actual output result fails, it may be that the cluster has not started normally. It is recommended to use the status command to check the current cluster status (iotd cluster status xxx)")]),le,e("p",null,[t("Note: Since the cluster deployment tool only calls the "),e("a",ce,[t("stop-confignode.sh"),n(d)]),t(" and "),e("a",ue,[t("stop-datanode.sh"),n(d)]),t(" scripts in the IoTDB cluster, in some cases the iotdb cluster may not be stopped.")]),he,e("ol",null,[e("li",null,[t("Open our website "),e("a",pe,[t("Download Page"),n(d)]),t(".")]),me,fe]),ge,e("ol",null,[e("li",null,[t("Open our website "),e("a",be,[t("Download Page"),n(d)]),t(".")]),ve,_e]),ye,e("p",null,[t("If you want to try the cluster mode on one server, please read"),xe,n(a,{to:"/UserGuide/V1.2.x/QuickStart/ClusterQuickStart.html"},{default:i(()=>[t("Cluster Quick Start")]),_:1}),t(".")]),ke,e("p",null,[t("Open the common configuration file ./conf/iotdb-common.properties,"),we,t(" and set the following parameters base on the"),Ne,n(a,{to:"/UserGuide/V1.2.x/Deployment-and-Maintenance/Deployment-Recommendation.html"},{default:i(()=>[t("Deployment Recommendation")]),_:1}),t(":")]),Ce,e("p",null,[De,t(" Please set these parameters carefully based on the "),n(a,{to:"/UserGuide/V1.2.x/Deployment-and-Maintenance/Deployment-Recommendation.html"},{default:i(()=>[t("Deployment Recommendation")]),_:1}),t("."),Ie,t(" These parameters are not modifiable after the Node first startup.")]),Te,e("p",null,[t("For more details about other configuration parameters of ConfigNode, see the"),Se,n(a,{to:"/UserGuide/V1.2.x/Reference/ConfigNode-Config-Manual.html"},{default:i(()=>[t("ConfigNode Configurations")]),_:1}),t(".")]),Be,e("p",null,[t("For more details about other configuration parameters of ConfigNode, see the"),Oe,n(a,{to:"/UserGuide/V1.2.x/Reference/ConfigNode-Config-Manual.html"},{default:i(()=>[t("ConfigNode Configurations")]),_:1}),t(".")]),Ee,e("p",null,[t("For more details about other configuration parameters of DataNode, see the"),Re,n(a,{to:"/UserGuide/V1.2.x/Reference/DataNode-Config-Manual.html"},{default:i(()=>[t("DataNode Configurations")]),_:1}),t(".")]),Fe,e("p",null,[t("If you want to use the Cli to connect to a cluster in the production environment,"),Pe,t(" Please read the "),n(a,{to:"/UserGuide/V1.2.x/Tools-System/CLI.html"},{default:i(()=>[t("Cli manual")]),_:1}),t(".")]),qe,e("p",null,[t("See "),n(a,{to:"/UserGuide/V1.2.x/FAQ/Frequently-asked-questions.html"},{default:i(()=>[t("FAQ")]),_:1}),t(".")])])}const Ge=s(h,[["render",Ye],["__file","Deployment-Guide_timecho.html.vue"]]);export{Ge as default};
