(window.webpackJsonp=window.webpackJsonp||[]).push([[746],{1150:function(s,t,a){"use strict";a.r(t);var n=a(19),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"查询写回-select-into"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询写回-select-into"}},[s._v("#")]),s._v(" 查询写回（SELECT INTO）")]),s._v(" "),t("p",[t("code",[s._v("SELECT INTO")]),s._v(" 语句用于将查询结果写入一系列指定的时间序列中。")]),s._v(" "),t("p",[s._v("应用场景如下：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("实现 IoTDB 内部 ETL")]),s._v("：对原始数据进行 ETL 处理后写入新序列。")]),s._v(" "),t("li",[t("strong",[s._v("查询结果存储")]),s._v("：将查询结果进行持久化存储，起到类似物化视图的作用。")]),s._v(" "),t("li",[t("strong",[s._v("非对齐序列转对齐序列")]),s._v("：对齐序列从0.13版本开始支持，可以通过该功能将非对齐序列的数据写入新的对齐序列中。")])]),s._v(" "),t("h2",{attrs:{id:"语法定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#语法定义"}},[s._v("#")]),s._v(" 语法定义")]),s._v(" "),t("h3",{attrs:{id:"整体描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#整体描述"}},[s._v("#")]),s._v(" 整体描述")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("selectIntoStatement\n    : "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n        resultColumn "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" resultColumn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" intoItem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" intoItem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" prefixPath "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prefixPath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" whereCondition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" groupByTimeClause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" groupByLevelClause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("FILL {PREVIOUS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LINEAR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" constant}"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" rowLimit "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFFSET")]),s._v(" rowOffset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ALIGN "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" DEVICE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nintoItem\n    : "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ALIGNED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" intoDevicePath "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'('")]),s._v(" intoMeasurementName "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" intoMeasurementName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("')'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"into-子句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#into-子句"}},[s._v("#")]),s._v(" "),t("code",[s._v("INTO")]),s._v(" 子句")]),s._v(" "),t("p",[t("code",[s._v("INTO")]),s._v(" 子句由若干个 "),t("code",[s._v("intoItem")]),s._v(" 构成。")]),s._v(" "),t("p",[s._v("每个 "),t("code",[s._v("intoItem")]),s._v(" 由一个目标设备路径和一个包含若干目标物理量名的列表组成（与 "),t("code",[s._v("INSERT")]),s._v(" 语句中的 "),t("code",[s._v("INTO")]),s._v(" 子句写法类似）。")]),s._v(" "),t("p",[s._v("其中每个目标物理量名与目标设备路径组成一个目标序列，一个 "),t("code",[s._v("intoItem")]),s._v(" 包含若干目标序列。例如："),t("code",[s._v("root.sg_copy.d1(s1, s2)")]),s._v(" 指定了两条目标序列 "),t("code",[s._v("root.sg_copy.d1.s1")]),s._v(" 和 "),t("code",[s._v("root.sg_copy.d1.s2")]),s._v("。")]),s._v(" "),t("p",[t("code",[s._v("INTO")]),s._v(" 子句指定的目标序列要能够与查询结果集的列一一对应。具体规则如下：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("按时间对齐")]),s._v("（默认）：全部 "),t("code",[s._v("intoItem")]),s._v(" 包含的目标序列数量要与查询结果集的列数（除时间列外）一致，且按照表头从左到右的顺序一一对应。")]),s._v(" "),t("li",[t("strong",[s._v("按设备对齐")]),s._v("（使用 "),t("code",[s._v("ALIGN BY DEVICE")]),s._v("）：全部 "),t("code",[s._v("intoItem")]),s._v(" 中指定的目标设备数和查询的设备数（即 "),t("code",[s._v("FROM")]),s._v(" 子句中路径模式匹配的设备数）一致，且按照结果集设备的输出顺序一一对应。\n为每个目标设备指定的目标物理量数量要与查询结果集的列数（除时间和设备列外）一致，且按照表头从左到右的顺序一一对应。")])]),s._v(" "),t("p",[s._v("下面通过示例进一步说明：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("示例 1")]),s._v("（按时间对齐）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IoTDB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1, s2 into root.sg_copy.d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", root.sg_copy.d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1, t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", root.sg_copy.d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from root.sg.d1, root.sg.d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d1.s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d1.t1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d2.s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d2.t1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d1.s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d2.t2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d2.s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d1.t2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+-------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".725s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("该语句将 "),t("code",[s._v("root.sg")]),s._v(" database 下四条序列的查询结果写入到 "),t("code",[s._v("root.sg_copy")]),s._v(" database 下指定的四条序列中。注意，"),t("code",[s._v("root.sg_copy.d2(t1, t2)")]),s._v(" 也可以写做 "),t("code",[s._v("root.sg_copy.d2(t1), root.sg_copy.d2(t2)")]),s._v("。")]),s._v(" "),t("p",[s._v("可以看到，"),t("code",[s._v("INTO")]),s._v(" 子句的写法非常灵活，只要满足组合出的目标序列没有重复，且与查询结果列一一对应即可。")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("CLI")]),s._v(" 展示的结果集中，各列的含义如下：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("source column")]),s._v(" 列表示查询结果的列名。")]),s._v(" "),t("li",[t("code",[s._v("target timeseries")]),s._v(" 表示对应列写入的目标序列。")]),s._v(" "),t("li",[t("code",[s._v("written")]),s._v(" 表示预期写入的数据量。")])])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("示例 2")]),s._v("（按时间对齐）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IoTDB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1 + s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" into root.agg.count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1_add_s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", root.agg.last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from root.sg.d1 group by "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", 10ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------------------------+-------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                         "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+-------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s1 + root.sg.d1.s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.agg.count.s1_add_s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+-------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("             last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   root.agg.last_value.s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+-------------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".375s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("该语句将聚合查询的结果存储到指定序列中。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("示例 3")]),s._v("（按设备对齐）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IoTDB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1, s2 into root.sg_copy.d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1, t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", root.sg_copy.d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1, t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from root.sg.d1, root.sg.d2 align by device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d1.t1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d1.t2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d2.t1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+-------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg_copy.d2.t2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+-------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".625s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("该语句同样是将 "),t("code",[s._v("root.sg")]),s._v(" database 下四条序列的查询结果写入到 "),t("code",[s._v("root.sg_copy")]),s._v(" database 下指定的四条序列中。但在按设备对齐中，"),t("code",[s._v("intoItem")]),s._v(" 的数量必须和查询的设备数量一致，每个查询设备对应一个 "),t("code",[s._v("intoItem")]),s._v("。")]),s._v(" "),t("blockquote",[t("p",[s._v("按设备对齐查询时，"),t("code",[s._v("CLI")]),s._v(" 展示的结果集多出一列 "),t("code",[s._v("source device")]),s._v(" 列表示查询的设备。")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("示例 4")]),s._v("（按设备对齐）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IoTDB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1 + s2 into root.expr.add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d1s1_d1s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", root.expr.add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d2s1_d2s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from root.sg.d1, root.sg.d2 align by device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------+--------------+------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       s1 + s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.expr.add.d1s1_d1s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    root.sg.d2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       s1 + s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.expr.add.d2s1_d2s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+--------------+------------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".532s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("该语句将表达式计算的结果存储到指定序列中。")]),s._v(" "),t("h3",{attrs:{id:"使用变量占位符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用变量占位符"}},[s._v("#")]),s._v(" 使用变量占位符")]),s._v(" "),t("p",[s._v("特别地，可以使用变量占位符描述目标序列与查询序列之间的对应规律，简化语句书写。目前支持以下两种变量占位符：")]),s._v(" "),t("ul",[t("li",[s._v("后缀复制符 "),t("code",[s._v("::")]),s._v("：复制查询设备后缀（或物理量），表示从该层开始一直到设备的最后一层（或物理量），目标设备的节点名（或物理量名）与查询的设备对应的节点名（或物理量名）相同。")]),s._v(" "),t("li",[s._v("单层节点匹配符 "),t("code",[s._v("${i}")]),s._v("：表示目标序列当前层节点名与查询序列的第"),t("code",[s._v("i")]),s._v("层节点名相同。比如，对于路径"),t("code",[s._v("root.sg1.d1.s1")]),s._v("而言，"),t("code",[s._v("${1}")]),s._v("表示"),t("code",[s._v("sg1")]),s._v("，"),t("code",[s._v("${2}")]),s._v("表示"),t("code",[s._v("d1")]),s._v("，"),t("code",[s._v("${3}")]),s._v("表示"),t("code",[s._v("s1")]),s._v("。")])]),s._v(" "),t("p",[s._v("在使用变量占位符时，"),t("code",[s._v("intoItem")]),s._v("与查询结果集列的对应关系不能存在歧义，具体情况分类讨论如下：")]),s._v(" "),t("h4",{attrs:{id:"按时间对齐-默认"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#按时间对齐-默认"}},[s._v("#")]),s._v(" 按时间对齐（默认）")]),s._v(" "),t("blockquote",[t("p",[s._v("注：变量占位符"),t("strong",[s._v("只能描述序列与序列之间的对应关系")]),s._v("，如果查询中包含聚合、表达式计算，此时查询结果中的列无法与某个序列对应，因此目标设备和目标物理量都不能使用变量占位符。")])]),s._v(" "),t("h5",{attrs:{id:"_1-目标设备不使用变量占位符-目标物理量列表使用变量占位符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-目标设备不使用变量占位符-目标物理量列表使用变量占位符"}},[s._v("#")]),s._v(" （1）目标设备不使用变量占位符 & 目标物理量列表使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")])]),s._v(" "),t("ol",[t("li",[s._v("每个 "),t("code",[s._v("intoItem")]),s._v(" 中，物理量列表的长度必须为 1。"),t("br"),s._v("（如果长度可以大于1，例如 "),t("code",[s._v("root.sg1.d1(::, s1)")]),s._v("，无法确定具体哪些列与"),t("code",[s._v("::")]),s._v("匹配）")]),s._v(" "),t("li",[t("code",[s._v("intoItem")]),s._v(" 数量为 1，或与查询结果集列数一致。"),t("br"),s._v("（在每个目标物理量列表长度均为 1 的情况下，若 "),t("code",[s._v("intoItem")]),s._v(" 只有 1 个，此时表示全部查询序列写入相同设备；若 "),t("code",[s._v("intoItem")]),s._v(" 数量与查询序列一致，则表示为每个查询序列指定一个目标设备；若 "),t("code",[s._v("intoItem")]),s._v(" 大于 1 小于查询序列数，此时无法与查询序列一一对应）")])]),s._v(" "),t("p",[t("strong",[s._v("匹配方法：")]),s._v(" 每个查询序列指定目标设备，而目标物理量根据变量占位符生成。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("${"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("}"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("该语句等价于：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("可以看到，在这种情况下，语句并不能得到很好地简化。")]),s._v(" "),t("h5",{attrs:{id:"_2-目标设备使用变量占位符-目标物理量列表不使用变量占位符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-目标设备使用变量占位符-目标物理量列表不使用变量占位符"}},[s._v("#")]),s._v(" （2）目标设备使用变量占位符 & 目标物理量列表不使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")]),s._v(" 全部 "),t("code",[s._v("intoItem")]),s._v(" 中目标物理量的数量与查询结果集列数一致。")]),s._v(" "),t("p",[t("strong",[s._v("匹配方式：")]),s._v(" 为每个查询序列指定了目标物理量，目标设备根据对应目标物理量所在 "),t("code",[s._v("intoItem")]),s._v(" 的目标设备占位符生成。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s4 \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" ::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1_1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2_2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2_2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s3_3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("${"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("}_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"_3-目标设备使用变量占位符-目标物理量列表使用变量占位符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-目标设备使用变量占位符-目标物理量列表使用变量占位符"}},[s._v("#")]),s._v(" （3）目标设备使用变量占位符 & 目标物理量列表使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")]),s._v(" "),t("code",[s._v("intoItem")]),s._v(" 只有一个且物理量列表的长度为 1。")]),s._v(" "),t("p",[t("strong",[s._v("匹配方式：")]),s._v(" 每个查询序列根据变量占位符可以得到一个目标序列。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_bk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将 "),t("code",[s._v("root.sg")]),s._v(" 下全部序列的查询结果写到 "),t("code",[s._v("root.sg_bk")]),s._v("，设备名后缀和物理量名保持不变。")]),s._v(" "),t("h4",{attrs:{id:"按设备对齐-使用-align-by-device"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#按设备对齐-使用-align-by-device"}},[s._v("#")]),s._v(" 按设备对齐（使用 "),t("code",[s._v("ALIGN BY DEVICE")]),s._v("）")]),s._v(" "),t("blockquote",[t("p",[s._v("注：变量占位符"),t("strong",[s._v("只能描述序列与序列之间的对应关系")]),s._v("，如果查询中包含聚合、表达式计算，此时查询结果中的列无法与某个物理量对应，因此目标物理量不能使用变量占位符。")])]),s._v(" "),t("h5",{attrs:{id:"_1-目标设备不使用变量占位符-目标物理量列表使用变量占位符-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-目标设备不使用变量占位符-目标物理量列表使用变量占位符-2"}},[s._v("#")]),s._v(" （1）目标设备不使用变量占位符 & 目标物理量列表使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")]),s._v(" 每个 "),t("code",[s._v("intoItem")]),s._v(" 中，如果物理量列表使用了变量占位符，则列表的长度必须为 1。")]),s._v(" "),t("p",[t("strong",[s._v("匹配方法：")]),s._v(" 每个查询序列指定目标设备，而目标物理量根据变量占位符生成。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s4\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backup_sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backup_sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("backup_${"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("}"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d3\nalign "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"_2-目标设备使用变量占位符-目标物理量列表不使用变量占位符-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-目标设备使用变量占位符-目标物理量列表不使用变量占位符-2"}},[s._v("#")]),s._v(" （2）目标设备使用变量占位符 & 目标物理量列表不使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")]),s._v(" "),t("code",[s._v("intoItem")]),s._v(" 只有一个。（如果出现多个带占位符的 "),t("code",[s._v("intoItem")]),s._v("，我们将无法得知每个 "),t("code",[s._v("intoItem")]),s._v(" 需要匹配哪几个源设备）")]),s._v(" "),t("p",[t("strong",[s._v("匹配方式：")]),s._v(" 每个查询设备根据变量占位符得到一个目标设备，每个设备下结果集各列写入的目标物理量由目标物理量列表指定。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("avg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("agg_${"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("}"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("avg_s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sum_s2_add_s3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count_s4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nalign "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"_3-目标设备使用变量占位符-目标物理量列表使用变量占位符-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-目标设备使用变量占位符-目标物理量列表使用变量占位符-2"}},[s._v("#")]),s._v(" （3）目标设备使用变量占位符 & 目标物理量列表使用变量占位符")]),s._v(" "),t("p",[t("strong",[s._v("限制：")]),s._v(" "),t("code",[s._v("intoItem")]),s._v(" 只有一个且物理量列表的长度为 1。")]),s._v(" "),t("p",[t("strong",[s._v("匹配方式：")]),s._v(" 每个查询序列根据变量占位符可以得到一个目标序列。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" ::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("backup_${"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("}"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" align "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将 "),t("code",[s._v("root.sg")]),s._v(" 下每条序列的查询结果写到相同设备下，物理量名前加"),t("code",[s._v("backup_")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"指定目标序列为对齐序列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定目标序列为对齐序列"}},[s._v("#")]),s._v(" 指定目标序列为对齐序列")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("ALIGNED")]),s._v(" 关键词可以指定写入的目标设备为对齐写入，每个 "),t("code",[s._v("intoItem")]),s._v(" 可以独立设置。")]),s._v(" "),t("p",[t("strong",[s._v("示例：")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" aligned root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d2 align "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("该语句指定了 "),t("code",[s._v("root.sg_copy.d1")]),s._v(" 是非对齐设备，"),t("code",[s._v("root.sg_copy.d2")]),s._v("是对齐设备。")]),s._v(" "),t("h3",{attrs:{id:"不支持使用的查询子句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不支持使用的查询子句"}},[s._v("#")]),s._v(" 不支持使用的查询子句")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("SLIMIT")]),s._v("、"),t("code",[s._v("SOFFSET")]),s._v("：查询出来的列不确定，功能不清晰，因此不支持。")]),s._v(" "),t("li",[t("code",[s._v("LAST")]),s._v("查询、"),t("code",[s._v("GROUP BY TAGS")]),s._v("、"),t("code",[s._v("DISABLE ALIGN")]),s._v("：表结构和写入结构不一致，因此不支持。")])]),s._v(" "),t("h3",{attrs:{id:"其他要注意的点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他要注意的点"}},[s._v("#")]),s._v(" 其他要注意的点")]),s._v(" "),t("ul",[t("li",[s._v("对于一般的聚合查询，时间戳是无意义的，约定使用 0 来存储。")]),s._v(" "),t("li",[s._v("当目标序列存在时，需要保证源序列和目标时间序列的数据类型、压缩和编码方式、是否属于对齐设备等元数据信息一致。")]),s._v(" "),t("li",[s._v("当目标序列不存在时，系统将自动创建目标序列（包括 database）。")]),s._v(" "),t("li",[s._v("当查询的序列不存在或查询的序列不存在数据，则不会自动创建目标序列。")])]),s._v(" "),t("h2",{attrs:{id:"应用举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用举例"}},[s._v("#")]),s._v(" 应用举例")]),s._v(" "),t("h3",{attrs:{id:"实现-iotdb-内部-etl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现-iotdb-内部-etl"}},[s._v("#")]),s._v(" 实现 IoTDB 内部 ETL")]),s._v(" "),t("p",[s._v("对原始数据进行 ETL 处理后写入新序列。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IOTDB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT preprocess_udf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INTO ::"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("preprocessed_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${3}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM root.sg.*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-------------------------------+---------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+---------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  preprocess_udf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d1.preprocessed_s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+---------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  preprocess_udf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d1.preprocessed_s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+---------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  preprocess_udf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d2.s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d2.preprocessed_s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+---------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  preprocess_udf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d2.s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.d2.preprocessed_s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+---------------------------+--------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("以上语句使用自定义函数对数据进行预处理，将预处理后的结果持久化存储到新序列中。")]),s._v(" "),t("h3",{attrs:{id:"查询结果存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询结果存储"}},[s._v("#")]),s._v(" 查询结果存储")]),s._v(" "),t("p",[s._v("将查询结果进行持久化存储，起到类似物化视图的作用。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IOTDB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" INTO root.sg.agg_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${2}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count_s1, last_value_s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM root.sg1.d1 GROUP BY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", 10ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------------+-----------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+-----------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      root.sg.agg_d1.count_s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+-----------------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" last_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root.sg.d1.s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg.agg_d1.last_value_s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+-----------------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".115s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("以上语句将降采样查询的结果持久化存储到新序列中。")]),s._v(" "),t("h3",{attrs:{id:"非对齐序列转对齐序列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非对齐序列转对齐序列"}},[s._v("#")]),s._v(" 非对齐序列转对齐序列")]),s._v(" "),t("p",[s._v("对齐序列从 0.13 版本开始支持，可以通过该功能将非对齐序列的数据写入新的对齐序列中。")]),s._v(" "),t("p",[t("strong",[s._v("注意：")]),s._v(" 建议配合使用 "),t("code",[s._v("LIMIT & OFFSET")]),s._v(" 子句或 "),t("code",[s._v("WHERE")]),s._v(" 子句（时间过滤条件）对数据进行分批，防止单次操作的数据量过大。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("IOTDB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT s1, s2 INTO ALIGNED root.sg1.aligned_d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s1, s2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM root.sg1.non_aligned_d WHERE "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" and "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------------+----------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     target timeseries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" written"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+----------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg1.non_aligned_d.s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg1.aligned_d.s1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+----------------------+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg1.non_aligned_d.s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root.sg1.aligned_d.s2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------+----------------------+--------+\nTotal line number "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nIt costs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".375s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("以上语句将一组非对齐的序列的数据迁移到一组对齐序列。")]),s._v(" "),t("h2",{attrs:{id:"相关用户权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关用户权限"}},[s._v("#")]),s._v(" 相关用户权限")]),s._v(" "),t("p",[s._v("用户必须有下列权限才能正常执行查询写回语句：")]),s._v(" "),t("ul",[t("li",[s._v("所有 "),t("code",[s._v("SELECT")]),s._v(" 子句中源序列的 "),t("code",[s._v("READ_TIMESERIES")]),s._v(" 权限。")]),s._v(" "),t("li",[s._v("所有 "),t("code",[s._v("INTO")]),s._v(" 子句中目标序列 "),t("code",[s._v("INSERT_TIMESERIES")]),s._v(" 权限。")])]),s._v(" "),t("p",[s._v("更多用户权限相关的内容，请参考"),t("RouterLink",{attrs:{to:"/zh/UserGuide/Master/Administration-Management/Administration.html"}},[s._v("权限管理语句")]),s._v("。")],1),s._v(" "),t("h2",{attrs:{id:"相关配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关配置参数"}},[s._v("#")]),s._v(" 相关配置参数")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("select_into_insert_tablet_plan_row_limit")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数名")]),s._v(" "),t("th",[s._v("select_into_insert_tablet_plan_row_limit")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("描述")]),s._v(" "),t("td",[s._v("写入过程中每一批 "),t("code",[s._v("Tablet")]),s._v(" 的最大行数")])]),s._v(" "),t("tr",[t("td",[s._v("类型")]),s._v(" "),t("td",[s._v("int32")])]),s._v(" "),t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("10000")])]),s._v(" "),t("tr",[t("td",[s._v("改后生效方式")]),s._v(" "),t("td",[s._v("重启后生效")])])])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);