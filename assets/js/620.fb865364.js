(window.webpackJsonp=window.webpackJsonp||[]).push([[620],{1029:function(t,s,a){"use strict";a.r(s);var n=a(19),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#聚合函数"}},[t._v("#")]),t._v(" 聚合函数")]),t._v(" "),s("p",[t._v("聚合函数是多对一函数。它们对一组值进行聚合计算，得到单个聚合结果。")]),t._v(" "),s("p",[t._v("除了 "),s("code",[t._v("COUNT()")]),t._v(", "),s("code",[t._v("COUNT_IF()")]),t._v("之外，其他所有聚合函数都忽略空值，并在没有输入行或所有值为空时返回空值。 例如，"),s("code",[t._v("SUM()")]),t._v(" 返回 null 而不是零，而 "),s("code",[t._v("AVG()")]),t._v(" 在计数中不包括 null 值。")]),t._v(" "),s("p",[t._v("IoTDB 支持的聚合函数如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("函数名")]),t._v(" "),s("th",[t._v("功能描述")]),t._v(" "),s("th",[t._v("允许的输入类型")]),t._v(" "),s("th",[t._v("必要的属性参数")]),t._v(" "),s("th",[t._v("输出类型")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("SUM")]),t._v(" "),s("td",[t._v("求和。")]),t._v(" "),s("td",[t._v("INT32 INT64 FLOAT DOUBLE")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("DOUBLE")])]),t._v(" "),s("tr",[s("td",[t._v("COUNT")]),t._v(" "),s("td",[t._v("计算数据点数。")]),t._v(" "),s("td",[t._v("所有类型")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("INT64")])]),t._v(" "),s("tr",[s("td",[t._v("AVG")]),t._v(" "),s("td",[t._v("求平均值。")]),t._v(" "),s("td",[t._v("INT32 INT64 FLOAT DOUBLE")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("DOUBLE")])]),t._v(" "),s("tr",[s("td",[t._v("EXTREME")]),t._v(" "),s("td",[t._v("求具有最大绝对值的值。如果正值和负值的最大绝对值相等，则返回正值。")]),t._v(" "),s("td",[t._v("INT32 INT64 FLOAT DOUBLE")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("与输入类型一致")])]),t._v(" "),s("tr",[s("td",[t._v("MAX_VALUE")]),t._v(" "),s("td",[t._v("求最大值。")]),t._v(" "),s("td",[t._v("INT32 INT64 FLOAT DOUBLE")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("与输入类型一致")])]),t._v(" "),s("tr",[s("td",[t._v("MIN_VALUE")]),t._v(" "),s("td",[t._v("求最小值。")]),t._v(" "),s("td",[t._v("INT32 INT64 FLOAT DOUBLE")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("与输入类型一致")])]),t._v(" "),s("tr",[s("td",[t._v("FIRST_VALUE")]),t._v(" "),s("td",[t._v("求时间戳最小的值。")]),t._v(" "),s("td",[t._v("所有类型")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("与输入类型一致")])]),t._v(" "),s("tr",[s("td",[t._v("LAST_VALUE")]),t._v(" "),s("td",[t._v("求时间戳最大的值。")]),t._v(" "),s("td",[t._v("所有类型")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("与输入类型一致")])]),t._v(" "),s("tr",[s("td",[t._v("MAX_TIME")]),t._v(" "),s("td",[t._v("求最大时间戳。")]),t._v(" "),s("td",[t._v("所有类型")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("Timestamp")])]),t._v(" "),s("tr",[s("td",[t._v("MIN_TIME")]),t._v(" "),s("td",[t._v("求最小时间戳。")]),t._v(" "),s("td",[t._v("所有类型")]),t._v(" "),s("td",[t._v("无")]),t._v(" "),s("td",[t._v("Timestamp")])]),t._v(" "),s("tr",[s("td",[t._v("COUNT_IF")]),t._v(" "),s("td",[t._v("求数据点连续满足某一给定条件，且满足条件的数据点个数（用keep表示）满足指定阈值的次数。")]),t._v(" "),s("td",[t._v("BOOLEAN")]),t._v(" "),s("td",[s("code",[t._v("[keep >=/>/=/!=/</<=]threshold")]),t._v("：被指定的阈值或阈值条件，若只使用"),s("code",[t._v("threshold")]),t._v("则等价于"),s("code",[t._v("keep >= threshold")]),t._v(","),s("code",[t._v("threshold")]),t._v("类型为"),s("code",[t._v("INT64")]),s("br"),t._v(" "),s("code",[t._v("ignoreNull")]),t._v("：可选，默认为"),s("code",[t._v("true")]),t._v("；为"),s("code",[t._v("true")]),t._v("表示忽略null值，即如果中间出现null值，直接忽略，不会打断连续性；为"),s("code",[t._v("false")]),t._v("表示不忽略null值，即如果中间出现null值，会打断连续性")]),t._v(" "),s("td",[t._v("INT64")])])])]),t._v(" "),s("h2",{attrs:{id:"count-if"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#count-if"}},[t._v("#")]),t._v(" COUNT_IF")]),t._v(" "),s("h3",{attrs:{id:"语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[t._v("#")]),t._v(" 语法")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[t._v("count_if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predicate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("keep "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("threshold"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ignoreNull'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true/false'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("predicate: 返回类型为"),s("code",[t._v("BOOLEAN")]),t._v("的合法表达式")]),t._v(" "),s("p",[t._v("threshold 及 ignoreNull 用法见上表")]),t._v(" "),s("blockquote",[s("p",[t._v("注意: count_if 当前暂不支持与 group by time 的 SlidingWindow 一起使用")])]),t._v(" "),s("h3",{attrs:{id:"使用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[t._v("#")]),t._v(" 使用示例")]),t._v(" "),s("h4",{attrs:{id:"原始数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原始数据"}},[t._v("#")]),t._v(" 原始数据")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("+-----------------------------+-------------+-------------+\n|                         Time|root.db.d1.s1|root.db.d1.s2|\n+-----------------------------+-------------+-------------+\n|1970-01-01T08:00:00.001+08:00|            0|            0|\n|1970-01-01T08:00:00.002+08:00|         null|            0|\n|1970-01-01T08:00:00.003+08:00|            0|            0|\n|1970-01-01T08:00:00.004+08:00|            0|            0|\n|1970-01-01T08:00:00.005+08:00|            1|            0|\n|1970-01-01T08:00:00.006+08:00|            1|            0|\n|1970-01-01T08:00:00.007+08:00|            1|            0|\n|1970-01-01T08:00:00.008+08:00|            0|            0|\n|1970-01-01T08:00:00.009+08:00|            0|            0|\n|1970-01-01T08:00:00.010+08:00|            0|            0|\n+-----------------------------+-------------+-------------+\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("h4",{attrs:{id:"不使用ignorenull参数-忽略null"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不使用ignorenull参数-忽略null"}},[t._v("#")]),t._v(" 不使用ignoreNull参数(忽略null)")]),t._v(" "),s("p",[t._v("SQL:")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" count_if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count_if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("输出:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("+--------------------------------------------------+--------------------------------------------------+\n|count_if(root.db.d1.s1 = 0 & root.db.d1.s2 = 0, 3)|count_if(root.db.d1.s1 = 1 & root.db.d1.s2 = 0, 3)|\n+--------------------------------------------------+--------------------------------------------------+\n|                                                 2|                                                 1|\n+--------------------------------------------------+--------------------------------------------------\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h4",{attrs:{id:"使用ignorenull参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用ignorenull参数"}},[t._v("#")]),t._v(" 使用ignoreNull参数")]),t._v(" "),s("p",[t._v("SQL:")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" count_if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ignoreNull'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'false'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count_if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ignoreNull'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'false'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("输出:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('+------------------------------------------------------------------------+------------------------------------------------------------------------+\n|count_if(root.db.d1.s1 = 0 & root.db.d1.s2 = 0, 3, "ignoreNull"="false")|count_if(root.db.d1.s1 = 1 & root.db.d1.s2 = 0, 3, "ignoreNull"="false")|\n+------------------------------------------------------------------------+------------------------------------------------------------------------+\n|                                                                       1|                                                                       1|\n+------------------------------------------------------------------------+------------------------------------------------------------------------+\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);