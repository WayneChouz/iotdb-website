(window.webpackJsonp=window.webpackJsonp||[]).push([[447],{1060:function(e,t,r){"use strict";r.r(t);var s=r(82),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"metric-工具"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#metric-工具"}},[e._v("#")]),e._v(" Metric 工具")]),e._v(" "),r("p",[e._v("IoTDB Server 提供了监控模块，可以在需要地方的引入变量监控，目前提供Jmx和Prometheus两种监控方式，可以引入counter等5种指标。关于接口的更多说明请参考"),r("a",{attrs:{href:"https://github.com/apache/iotdb/tree/master/metrics"}},[e._v("metric部分说明文档")])]),e._v(" "),r("h2",{attrs:{id:"使用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),r("p",[e._v("第一步：获得 IoTDB-server。")]),e._v(" "),r("p",[e._v("第二步：编辑配置文件"),r("code",[e._v("iotdb-metric.yml")])]),e._v(" "),r("ul",[r("li",[e._v("可以选择使用获取指标的方式，修改"),r("code",[e._v("metricReporterList")]),e._v("：可选参数"),r("code",[e._v("jmx")]),e._v("、"),r("code",[e._v("prometheus")])]),e._v(" "),r("li",[e._v("可以选择监控框架的类型，修改"),r("code",[e._v("monitortype")]),e._v("：可选参数"),r("code",[e._v("dropwizard")]),e._v("、"),r("code",[e._v("micrometer")]),e._v("，同时在IoTDB Server的配置文件中引入对应监控框架的依赖。")])]),e._v(" "),r("p",[e._v("第三步：在 IoTDB Server 中的对应位置埋点。")]),e._v(" "),r("ul",[r("li",[e._v("首先通过"),r("code",[e._v("MetricsService.getInstance().getMetricManager()")]),e._v("获取到对应的监控管理器，之后调用对应方法即可获取到对应指标。")]),e._v(" "),r("li",[e._v("之后对获取到的指标进行操作即可，监控框架会自动将指标通过选定方式发布。")]),e._v(" "),r("li",[e._v("需要注意的是，所有getOrCreate方法提供的tag均应为偶数，组成对应的key-value。")])]),e._v(" "),r("p",[e._v("第三步：启动 IoTDB-server。")]),e._v(" "),r("p",[e._v("第四步：查看具体的指标参数，根据选择的获取的指标的方式分别查看即可，即"),r("code",[e._v("jmx")]),e._v("或"),r("code",[e._v("prometheus")])]),e._v(" "),r("ul",[r("li",[e._v("对于jmx，请连接后查看"),r("code",[e._v("org.apache.iotdb.metrics")])]),e._v(" "),r("li",[e._v("对于prometheus进行如下的配置（部分参数可以自行调整，从而获取监控数据），需要注意的是，如果使用docker方式运行iotdb-server，则需要在使用"),r("code",[e._v("docker run")]),e._v("的时候使用"),r("code",[e._v("-p 9091:9091")]),e._v("参数来暴露对应端口。")])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("job_name: push-metrics\nhonor_labels: true\nhonor_timestamps: true\nscrape_interval: 15s\nscrape_timeout: 10s\nmetrics_path: /metrics\nscheme: http\nfollow_redirects: true\nstatic_configs:\n- targets:\n  - localhost:9091\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);