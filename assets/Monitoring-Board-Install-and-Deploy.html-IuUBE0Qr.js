import{_ as n,r,o as s,c as l,a as d,d as e,e as t,b as i,f as o}from"./app-1A4W01qe.js";const c={},h=o('<h1 id="_1-monitoring-board-install-and-deploy" tabindex="-1"><a class="header-anchor" href="#_1-monitoring-board-install-and-deploy" aria-hidden="true">#</a> 1 Monitoring Board Install and Deploy</h1><p>From the IoTDB 1.0 version, we introduced the system monitoring module, you can complete the IoTDB important operational indicators for monitoring, this article describes how to open the system monitoring module in the IoTDB distribution, and the use of Prometheus + Grafana way to complete the visualisation of the system monitoring indicators.</p><h2 id="_1-1-pre-preparation" tabindex="-1"><a class="header-anchor" href="#_1-1-pre-preparation" aria-hidden="true">#</a> 1.1 pre-preparation</h2><h3 id="_1-1-1-software-requirement" tabindex="-1"><a class="header-anchor" href="#_1-1-1-software-requirement" aria-hidden="true">#</a> 1.1.1 software requirement</h3>',4),g=e("li",null,"IoTDB: version 1.0 and above, you may contact your sales for the relevant installer",-1),u={href:"https://prometheus.io/download/",target:"_blank",rel:"noopener noreferrer"},p={href:"https://grafana.com/grafana/download",target:"_blank",rel:"noopener noreferrer"},m=e("li",null,"IoTDB Dashboards: IoTDB Dashboard is a tool for Enterprise IoTDB, and you may contact your sales for the relevant installer.",-1),f=o(`<h3 id="_1-1-2-start-confignode" tabindex="-1"><a class="header-anchor" href="#_1-1-2-start-confignode" aria-hidden="true">#</a> 1.1.2 Start ConfigNode</h3><ol><li>Enter the <code>iotdb-enterprise-1.x.x.x-bin</code> package</li><li>Modify the configuration file <code>conf/iotdb-confignode.properties</code> and modify the following configuration. Other configurations remain unchanged:</li></ol><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">cn_metric_reporter_list</span><span class="token punctuation">=</span><span class="token value attr-value">PROMETHEUS</span>
<span class="token key attr-name">cn_metric_level</span><span class="token punctuation">=</span><span class="token value attr-value">IMPORTANT</span>
<span class="token key attr-name">cn_metric_prometheus_reporter_port</span><span class="token punctuation">=</span><span class="token value attr-value">9091</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Run the script to start ConfigNode: <code>./sbin/start-confignode.sh</code>. If the following prompt appears, the startup is successful:</li></ol><figure><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/Apache IoTDB/metric/cluster-introduce/1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,5),b={start:"4"},v={href:"http://localhost:9091/metrics",target:"_blank",rel:"noopener noreferrer"},_=o(`<figure><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/Apache IoTDB/metric/cluster-introduce/2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="5"><li>Similarly, the other two ConfigNode nodes can be configured to ports 9092 and 9093 respectively.</li></ol><h3 id="_1-1-3-start-datanode" tabindex="-1"><a class="header-anchor" href="#_1-1-3-start-datanode" aria-hidden="true">#</a> 1.1.3 Start DataNode</h3><ol><li>Enter the <code>iotdb-enterprise-1.x.x.x-bin</code> package</li><li>Modify the configuration file <code>conf/iotdb-datanode.properties</code> and modify the following configuration. Other configurations remain unchanged:</li></ol><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">dn_metric_reporter_list</span><span class="token punctuation">=</span><span class="token value attr-value">PROMETHEUS</span>
<span class="token key attr-name">dn_metric_level</span><span class="token punctuation">=</span><span class="token value attr-value">IMPORTANT</span>
<span class="token key attr-name">dn_metric_prometheus_reporter_port</span><span class="token punctuation">=</span><span class="token value attr-value">9094</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Run the script to start DataNode: <code>./sbin/start-datanode.sh</code>. If the following prompt appears, the startup is successful:</li></ol><figure><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/Apache IoTDB/metric/cluster-introduce/3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="4"><li>Enter the <code>http://localhost:9094/metrics</code> URL in the browser, and you can view the following monitoring item information:</li></ol><figure><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/Apache IoTDB/metric/cluster-introduce/4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="5"><li>Similarly, the other two DataNodes can be configured to ports 9095 and 9096.</li></ol><h3 id="_1-1-4-clarification" tabindex="-1"><a class="header-anchor" href="#_1-1-4-clarification" aria-hidden="true">#</a> 1.1.4 clarification</h3><p>Please confirm that the IoTDB cluster has been started before performing the following operations.</p><p>This doc will build the monitoring dashboard on one machine (1 ConfigNode and 1 DataNode) environment, other cluster configurations are similar, users can adjust the configuration according to their own cluster situation (the number of ConfigNode and DataNode). The basic configuration information of the cluster built in this paper is shown in the table below.</p><table><thead><tr><th>NODETYPE</th><th>NODEIP</th><th>Monitor Pusher</th><th>Monitor Level</th><th>Monitor Port</th></tr></thead><tbody><tr><td>ConfigNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9091</td></tr><tr><td>ConfigNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9092</td></tr><tr><td>ConfigNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9093</td></tr><tr><td>DataNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9094</td></tr><tr><td>DataNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9095</td></tr><tr><td>DataNode</td><td>127.0.0.1</td><td>PROMETHEUS</td><td>IMPORTANT</td><td>9096</td></tr></tbody></table><h2 id="_1-2-configure-prometheus-capture-monitoring-metrics" tabindex="-1"><a class="header-anchor" href="#_1-2-configure-prometheus-capture-monitoring-metrics" aria-hidden="true">#</a> 1.2 configure Prometheus capture monitoring metrics</h2><ol><li>Download the installation package. Download the Prometheus binary package locally, unzip it and go to the corresponding folder:</li></ol><div class="language-Shell line-numbers-mode" data-ext="Shell"><pre class="language-Shell"><code>tar xvfz prometheus-*.tar.gz
cd prometheus-*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Modify the configuration. Modify the Prometheus configuration file prometheus.yml as follows:<br> a. Added confignode task to collect monitoring data from ConfigNode<br> b. Add datanode task to collect monitoring data from DataNode</li></ol><div class="language-YAML line-numbers-mode" data-ext="YAML"><pre class="language-YAML"><code>global:
  scrape_interval: 15s

scrape_configs:
  - job_name: &quot;prometheus&quot;
    static_configs:
    - targets: [&quot;localhost:9090&quot;]
  - job_name: &quot;confignode&quot;
    static_configs:
    - targets: [&quot;localhost:9091&quot;, &quot;localhost:9092&quot;, &quot;localhost:9093&quot;]
    honor_labels: true
  - job_name: &quot;datanode&quot;
    static_configs:
    - targets: [&quot;localhost:9094&quot;, &quot;localhost:9095&quot;, &quot;localhost:9096&quot;]
    honor_labels: true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Start Promethues. the default expiration time for Prometheus monitoring data is 15d. in production environments, it is recommended to adjust the expiration time to 180d or more in order to track historical monitoring data for a longer period of time, as shown in the following startup command:</li></ol><div class="language-Shell line-numbers-mode" data-ext="Shell"><pre class="language-Shell"><code>./prometheus --config.file=prometheus.yml --storage.tsdb.retention.time=180d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,21),y={start:"4"},w={href:"http://localhost:9090",target:"_blank",rel:"noopener noreferrer"},S=o(`<p><img src="https://alioss.timecho.com/docs/img/1a.PNG" alt="" loading="lazy"><br><img src="https://alioss.timecho.com/docs/img/2a.PNG" alt="" loading="lazy"></p><h2 id="_1-3-using-grafana-to-view-monitoring-data" tabindex="-1"><a class="header-anchor" href="#_1-3-using-grafana-to-view-monitoring-data" aria-hidden="true">#</a> 1.3 Using Grafana to View Monitoring Data</h2><h3 id="_1-3-1-step1-grafana-installation-configuration-and-startup" tabindex="-1"><a class="header-anchor" href="#_1-3-1-step1-grafana-installation-configuration-and-startup" aria-hidden="true">#</a> 1.3.1 Step1ï¼šGrafana Installation, Configuration and Startup</h3><ol><li>Download the binary package of Grafana locally, unzip it and go to the corresponding folder:</li></ol><div class="language-Shell line-numbers-mode" data-ext="Shell"><pre class="language-Shell"><code>tar -zxvf grafana-*.tar.gz
cd grafana-*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Start Grafana and enter:</li></ol><div class="language-Shell line-numbers-mode" data-ext="Shell"><pre class="language-Shell"><code>./bin/grafana-server web 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,7),x={start:"3"},D={href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer"},k=e("li",null,"First we configure the Data Source in Configuration to be Prometheus.",-1),T=o('<figure><img src="https://alioss.timecho.com/docs/img/3a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="5"><li>When configuring the Data Source, pay attention to the URL where Prometheus is located, and click Save &amp; Test after configuration, the Data source is working prompt appears, then the configuration is successful.</li></ol><figure><img src="https://alioss.timecho.com/docs/img/4a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_1-3-2-step2-import-the-iotdb-dashboards" tabindex="-1"><a class="header-anchor" href="#_1-3-2-step2-import-the-iotdb-dashboards" aria-hidden="true">#</a> 1.3.2 Step2ï¼šImport the IoTDB Dashboards</h3><ol><li>Enter Grafanaï¼Œclick Browse of Dashboards</li></ol><figure><img src="https://alioss.timecho.com/docs/img/5a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="2"><li>Click the Import button on the right</li></ol><figure><img src="https://alioss.timecho.com/docs/img/6a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="3"><li>Select a way to import Dashboard<br> a. Upload the Json file of the downloaded Dashboard locally<br> b. Paste the contents of the Dashboard&#39;s Json file</li></ol><figure><img src="https://alioss.timecho.com/docs/img/7a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol><li>Select Prometheus in the Dashboard as the Data Source you just configured and click Import</li></ol><figure><img src="https://alioss.timecho.com/docs/img/8a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="5"><li>Then enter the Apache ConfigNode Dashboard and see the following monitoring panel</li></ol><figure><img src="https://alioss.timecho.com/docs/img/confignode.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="6"><li>Similarly, we can import Apache DataNode Dashboard and see the following monitoring panel:</li></ol><figure><img src="https://alioss.timecho.com/docs/img/datanode.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="7"><li>Similarly, we can import the Apache Performance Overview Dashboard and see the following monitoring panel:</li></ol><figure><img src="https://alioss.timecho.com/docs/img/performance.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="8"><li>Similarly, we can import the Apache System Overview Dashboard and see the following monitoring panel:</li></ol><figure><img src="https://alioss.timecho.com/docs/img/system.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_1-3-3-step3-creating-a-new-dashboard-for-data-visualisation" tabindex="-1"><a class="header-anchor" href="#_1-3-3-step3-creating-a-new-dashboard-for-data-visualisation" aria-hidden="true">#</a> 1.3.3 Step3ï¼šCreating a new Dashboard for data visualisation</h3><ol><li>First create the Dashboard, then create the Panel.</li></ol><figure><img src="https://alioss.timecho.com/docs/img/11a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="2"><li>After that, you can visualize the monitoring-related data in the panel according to your needs (all relevant monitoring metrics can be filtered by selecting confignode/datanode in the job first).</li></ol><figure><img src="https://alioss.timecho.com/docs/img/12a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="3"><li>Once the visualisation of the monitoring metrics selected for attention is complete, we get a panel like this:</li></ol><figure><img src="https://alioss.timecho.com/docs/img/13a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',27);function N(I,P){const a=r("ExternalLinkIcon");return s(),l("div",null,[d(`

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at
    
        http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

`),h,e("ol",null,[g,e("li",null,[t("Prometheus: version 2.30.3 and above, download from the official website: "),e("a",u,[t("https://prometheus.io/download/"),i(a)])]),e("li",null,[t("Grafana: version 8.4.2 and above, download from the official website: "),e("a",p,[t("https://grafana.com/grafana/download"),i(a)])]),m]),f,e("ol",b,[e("li",null,[t("Enter the "),e("a",v,[t("http://localhost:9091/metrics"),i(a)]),t(" URL in the browser, and you can view the following monitoring item information:")])]),_,e("ol",y,[e("li",null,[t("Confirm the startup is successful. Enter "),e("a",w,[t("http://localhost:9090"),i(a)]),t(" in the browser to enter Prometheus, click to enter the Target interface under Status (Figure 1 below), when you see State are Up, it means the configuration is successful and connected (Figure 2 below), click the link on the left side to jump to the webpage monitoring.")])]),S,e("ol",x,[e("li",null,[t("Enter "),e("a",D,[t("http://localhost:3000"),i(a)]),t(" in your browser to access Grafana, the default initial username and password are both admin.")]),k]),T])}const A=n(c,[["render",N],["__file","Monitoring-Board-Install-and-Deploy.html.vue"]]);export{A as default};
